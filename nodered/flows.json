[{"id":"ff4de0da.c8d7d","type":"tab","label":"Dashboard","disabled":false,"info":""},{"id":"aa7daa87.f23d38","type":"tab","label":"API","disabled":false,"info":""},{"id":"b8bbfb03.fd1c08","type":"tab","label":"Initialize CA","disabled":false,"info":""},{"id":"39dca28.bd9835e","type":"subflow","name":"Directory structure","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"2d7e761cac43c783"}]}],"out":[{"x":700,"y":380,"wires":[{"id":"41c65446.c832cc","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"cb4dbdca.4ada08","type":"subflow","name":"Client CSR","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"72984aee.bfdbd4"}]}],"out":[{"x":1160,"y":80,"wires":[{"id":"c82859d5.59537","port":0}]},{"x":1160,"y":200,"wires":[{"id":"6ab79ce2.e29d74","port":0},{"id":"72984aee.bfdbd4","port":1}]},{"x":1160,"y":320,"wires":[{"id":"535c5ee0.30c368","port":0},{"id":"2150cbce.eb2c6c","port":0},{"id":"2150cbce.eb2c6c","port":1}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"475018df.6c4cb","type":"subflow","name":"Server CSR","info":"","category":"","in":[{"x":60,"y":80,"wires":[{"id":"b45f250e.c9b098"}]}],"out":[{"x":1220,"y":80,"wires":[{"id":"e0c307ce.343fd","port":0}]},{"x":1220,"y":220,"wires":[{"id":"c4446ed0.b6a","port":0},{"id":"b45f250e.c9b098","port":1}]},{"x":1220,"y":320,"wires":[{"id":"400cd8da.b3fae","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"b440cd08.e1ad9","type":"subflow","name":"Sign CSR","info":"","category":"","in":[{"x":60,"y":80,"wires":[{"id":"836fe412.ed356"}]}],"out":[{"x":1240,"y":80,"wires":[{"id":"e1841280.2a112","port":0}]},{"x":1240,"y":220,"wires":[{"id":"8d6702db.fcbf78","port":0},{"id":"836fe412.ed356","port":1}]},{"x":1240,"y":280,"wires":[{"id":"6dda127.b8fabec","port":0},{"id":"430fe72a.b04d58","port":0},{"id":"430fe72a.b04d58","port":1}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"f582f9d1.fd1e8","type":"subflow","name":"Generate P12","info":"","category":"","in":[{"x":60,"y":100,"wires":[{"id":"cb71dc41.e28f4"}]}],"out":[{"x":1120,"y":100,"wires":[{"id":"7dfb1f3c.b19b7","port":0}]},{"x":1120,"y":240,"wires":[{"id":"bd02d6a0.b2c26","port":0},{"id":"cb71dc41.e28f4","port":1}]},{"x":1120,"y":300,"wires":[{"id":"d5352873.6d44d","port":0},{"id":"715ffb01.84c0b4","port":0},{"id":"715ffb01.84c0b4","port":1}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"d3b910d5.d5f0c","type":"subflow","name":"Gen Key","info":"","category":"","in":[{"x":80,"y":80,"wires":[{"id":"2774a13.8bf5ede"}]}],"out":[{"x":1160,"y":80,"wires":[{"id":"e21f76a.7edbf08","port":0}]},{"x":1140,"y":240,"wires":[{"id":"d07eee8f.53d5e8","port":0},{"id":"2774a13.8bf5ede","port":1}]},{"x":1140,"y":300,"wires":[{"id":"cf8ac8de.04237","port":0},{"id":"22729399.2b7b6c","port":1},{"id":"22729399.2b7b6c","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"8e3aead0.242ca8","type":"subflow","name":"Cleaneup files","info":"","category":"","in":[{"x":160,"y":100,"wires":[{"id":"f528b57c.82f12"}]}],"out":[{"x":970,"y":180,"wires":[{"id":"71eb3b61.7af06c","port":0},{"id":"79a0aa48.0f5234","port":1},{"id":"79a0aa48.0f5234","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"55102cd0.770394","type":"group","z":"aa7daa87.f23d38","name":"API to get CA (root) Certificate","style":{"fill":"#bfdbef","label":true,"color":"#000000"},"nodes":["526ebf8d.89a0e","89a0f31e.3326f","d28bce12.b952b","774c8e59.57f15","41b75fc9.9ee39","9331503d.968f6","598d89f5.11ab78"],"x":94,"y":59,"w":852,"h":122},{"id":"2a982168.c36dfe","type":"group","z":"aa7daa87.f23d38","name":"API to reqest issued certificates","style":{"fill":"#bfdbef","label":true,"color":"#000000"},"nodes":["8b2cb158.09c71","b1fc5e20.df417","249f923d.7a207e","a58633f.6d72cd","97e23772.b3bfe8","6c6005e4.47de9c","5b031341.a7b4fc","914ced4c.ce73a","6025f955.749eb8","b1663c80.6d3a2"],"x":94,"y":219,"w":872,"h":162},{"id":"405924b7.935dbc","type":"group","z":"ff4de0da.c8d7d","name":"Dashboard for issued certificates","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["805196d5.3bc168","34dea3ea.7804ac","d5d0dec2.e9928","e0f2f004.19084"],"x":74,"y":19,"w":802,"h":82},{"id":"e56328a8.640fa8","type":"group","z":"ff4de0da.c8d7d","name":"Dashboard for signing CSR","style":{"label":true,"fill":"#e3f3d3","color":"#000000"},"nodes":["e42e962d.7aa998","8c30ff1b.6e51","e8c06901.d3a7c8","71e30a2a.b579d4","12a37d17.ee01e3","aa50b392.77996","f8121681.caf688","6a8cf616.b536a8","79d9b8de.f74c18","2abddc74.a67834","4be0fa31.bd8d44","7dde5a39.88bb24","e4c609a6.0c9f48","9ba22a05.d8c828","1d7dce1f.16fff2","3e677556.7fde7a","3729ea29.2f57d6","a5c37159.7611a","ae89d30.f9b593","8597b255.f27ba","f96da6ec.2c2e78","f306e720.0694d8","a8022545.2ac148","b0a17bd7.9a86c8","dcfef388.de43d"],"x":74,"y":559,"w":1332,"h":422},{"id":"2690e83f.0acfd8","type":"group","z":"ff4de0da.c8d7d","name":"Dashboard for certificate inspection","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["b691dfe3.c35ab","8bfc3e38.6e874","aaa05f2f.f0a07","57a6bcee.9df424","8f88f2e5.8d567","b56d1a7.e6905e8","dd296cb4.10f1c","a7cd82e3.bcdc7","2ce78f1.528977","ab277c1c.9e819","84190c5c.5c9fc","561af0f2.f3132","e4f6fb9.8ba4908","e613ab7c.a61c88","426d5355.2159ac","bac27a3d.beddf8","d8fadeb.346242","631bcda9.4967e4"],"x":74,"y":1019,"w":1112,"h":322},{"id":"ad383299.8831c","type":"group","z":"ff4de0da.c8d7d","name":"Request Server Certificate","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["7a39ee73.8854f8","1fce3c23.7eae24","70753fd1.8973a","60dbfc46.565ca4","48aaab65.59ed64","c198279b.0b83b","8a6fc4ca.205ad"],"x":74,"y":379,"w":1072,"h":142},{"id":"8a14ff03.e2db8","type":"group","z":"aa7daa87.f23d38","name":"POST /sign {csr:\"PEM Data\",\"type\":\"server | client\",\"passphrase\":\"if required\"}","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["799340a9.cd055","71b84b.52dec7b4","95df5177.2a3ba","e979afd7.e6c83","81420aad.8b1ce","9e770f62.36b8a8","d18eeabb.74f5e","9c178499.cde37","ab09a480.b77f9","e6d0a0b0.c0f0a8","f334c172.2a687"],"x":94,"y":1131.5,"w":1432,"h":129.5},{"id":"b3c6283f7ba82db4","type":"group","z":"b8bbfb03.fd1c08","name":"You only need to initialize your CA once.  You need to remove nodered/openssl directory to re-initialize","style":{"fill":"#ffffbf","label":true,"color":"#000000"},"nodes":["cc643a42c4742946","f23bd66ba634570b","22dc0b8e9f5d8950","e80dea3a51bf8b49","4ad2632439f4acde","3e96719861d5510d","4f081d53b54e5d2c","392047c5814e5a13","a2c8629b835d2f77","d3bcdb93213ca90b","913e0af566da68f5","175908e83609a23d","5826abfe25abecac","4c43a7be2ec76a85","25057281122106d1","889f8c15c3454c10","f47af38f8f7622e6","4327e77f54b2b844","7263d63a43c61768","04eee688ac936b74"],"x":124,"y":79,"w":1162,"h":422},{"id":"e4bc446fc30ed565","type":"group","z":"aa7daa87.f23d38","name":"POST /revoce {\"serial\":\"ID\",\"passphrase\":\"if required\"}","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["dc570bb213923dd5","f3deae11855b12e1","599c5a507439722b","0cc290d7ae2fe6e7","344b59c6d0b6f990","c5b01886ac659660","6af15129bfa6b964","887fc545a407d4eb"],"x":94,"y":1299,"w":1112,"h":142},{"id":"de58220e46cf4265","type":"group","z":"aa7daa87.f23d38","name":"GET /cert/client {\"cn\":some CN\",\"passphrase\":\"if required\"}","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["0c0690210ab0fd5b","58a821cdd46a2390","ffd9dca1.691da","9205a13d.38d388","ca2ad37e.46e378","4aa6ee81.a28cd8","6456c0dd.7ce0a8","802111da.e11618","403f4f60.449728","f15bad68.c119a8","25a1916f.2b8ba6","5a44a275.d96914","64f4a277.350c64","f0742953.d6ec7","c6f6538c.c1d0c8","46e1e06d.fb8518","509cf9ac.f3fdb","aeb5f2b85ac371b0","ab8854a5a2973bfd","1bafacb0793e06d3","a9ab631ca61e4d2f","e31c659d9f025fb9","84f2a8e188a58c28","1d415502c0eff8f1","43167ca43a9951a1","d4cd9d43a08877dd","c529bd4c5834149f"],"x":94,"y":471.5,"w":1772,"h":329.5},{"id":"a8d6de16ed6cade1","type":"group","z":"aa7daa87.f23d38","name":"GET /cert/server {\"cn\":some.server.com\",\"passphrase\":\"if required\"}","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["463fa04.2662e6","33f56c99.3ea84c","435cc217.8c169c","5e432832.e8bf8","e43b8b6.750b378","2a89df2f.24f228","371ed654.d3965a","a17041b7.3f2fa","95cbb01b.d7a1e","472f07cb.5ef28","9e5ccfb2.19c098","2f77af65.904188","39a13919.625a56","f75c5d31.f8f4d8","be23ef2b.be374","1ae7f992.0fe28e","996fbb93.cbfa2","0ca9e5934ba74b82","67f86e70761b4f06","56ac6aef76929a33","b4eeaea64e9293e3","d9d58e4a5ceb4e03"],"x":94,"y":831.5,"w":1772,"h":269.5},{"id":"4998ef70.b87a68","type":"group","z":"ff4de0da.c8d7d","name":"Request Client Certificate","style":{"fill":"#e3f3d3","label":true,"color":"#000000"},"nodes":["a0f0ff4.558c78","3c792827.82069","1e29ce86.ac6829","a1d4ccf4.ee6f98","ee96bcea.a0c2e","e6af7825.95bb78","b7f274d1.0150b8","9a22ab97.3798d","99ce6317.08dc08"],"x":74,"y":139,"w":1072,"h":202},{"id":"72929af4.8afe14","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey","palette":"light"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"a0c4ae64.075c4","type":"ui_link","name":"Download CA certificte","link":"/certificate/file","icon":"open_in_browser","target":"thistab","order":6},{"id":"e6b607ff.55b2e8","type":"ui_tab","name":"Certificates","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"b39f2f66.e3c7","type":"ui_tab","name":"Inspect","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"28dd68a.bd8d198","type":"ui_tab","name":"Sign CSR","icon":"dashboard","order":5,"disabled":false,"hidden":false},{"id":"5eead11f.c36f28","type":"ui_tab","name":"API","icon":"dashboard","disabled":false,"hidden":false},{"id":"e24c90b2.e4155","type":"ui_tab","name":"Legacy Request","icon":"dashboard","disabled":false,"hidden":false},{"id":"cc904cd6.fb4d","type":"ui_tab","name":"Client Certificate","icon":"dashboard","disabled":false,"hidden":false},{"id":"a4dc3656.5518a","type":"ui_group","name":"Issued certificates","tab":"e6b607ff.55b2e8","order":1,"disp":true,"width":"12","collapse":false},{"id":"cefd5b5f.924ec","type":"ui_group","name":"Dropzone inspect","tab":"b39f2f66.e3c7","order":1,"disp":false,"width":"4","collapse":false},{"id":"5781adce.06a5d4","type":"ui_group","name":"Certificate info","tab":"b39f2f66.e3c7","order":2,"disp":true,"width":"16","collapse":false},{"id":"4aff7dde.b12e74","type":"ui_group","name":"Signed certificate","tab":"28dd68a.bd8d198","order":4,"disp":true,"width":"12","collapse":false},{"id":"788715bd.13bec4","type":"ui_group","name":"Signing Request","tab":"28dd68a.bd8d198","order":3,"disp":true,"width":"12","collapse":false},{"id":"96aefdbe.7216d","type":"ui_group","name":"Legacy Form","tab":"e24c90b2.e4155","order":1,"disp":true,"width":"6","collapse":false},{"id":"7bf6d005.8e4e58","type":"ui_group","name":"Client Certificate Form","tab":"cc904cd6.fb4d","order":1,"disp":true,"width":"6","collapse":false},{"id":"92e30b3d.582da8","type":"template","z":"39dca28.bd9835e","name":"openssl.conf","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"HOME\t\t\t= /data/openssl\nRANDFILE\t\t= /data/openssl/.rnd\n#oid_file\t\t= /data/openssl/.oid\noid_section\t\t= new_oids\n\n[ new_oids ]\ntsa_policy1 = 1.2.3.4.1\ntsa_policy2 = 1.2.3.4.5.6\ntsa_policy3 = 1.2.3.4.5.7\n\n[ ca ]\ndefault_ca\t= CA_default\n\n[ CA_default ]\ndir\t\t\t\t= /data/openssl\ncerts\t\t\t= $dir/certs\ncrl_dir\t\t\t= $dir/crl\ndatabase\t\t= $dir/index.txt\nnew_certs_dir\t= $dir/newcerts\nunique_subject\t= no\n\ncertificate\t\t= $dir/root.crt\nserial\t\t\t= $dir/serial\ncrlnumber\t\t= $dir/crlnumber\ncrl\t\t\t\t= $dir/crl.pem\nprivate_key\t\t= $dir/root.key\nRANDFILE\t\t= $dir/.rand\nx509_extensions\t= v3_ca\n\nname_opt = ca_default\t\t# Subject Name options\ncert_opt= ca_default\t\t# Certificate field options\n\n# Extension copying option: use with caution.\ncopy_extensions = copy\n\ndefault_days\t= 365\ndefault_crl_days= 5\ndefault_md\t\t= default\npreserve\t\t= no\n\npolicy\t\t\t= policy_match\n# For the CA policy\n[ policy_match ]\ncountryName\t\t\t\t= optional\nstateOrProvinceName\t\t= optional\norganizationName\t\t= optional\norganizationalUnitName\t= optional\ncommonName\t\t\t\t= supplied\nemailAddress\t\t\t= optional\n\n####################################################################\n[ req ]\ndefault_bits\t\t=  2048\ndistinguished_name\t= req_distinguished_name\nattributes\t\t\t= req_attributes\nx509_extensions\t\t= v3_ca\nstring_mask         = utf8only\nstring_mask\t\t\t= utf8only\n\n[ req_distinguished_name ]\ncommonName\t\t\t\t= Common Name\ncommonName_max\t\t\t= 64\nemailAddress\t\t\t= Email Address\nemailAddress_max\t\t= 64\n\n[ req_attributes ]\n\n[ server_cert ]\nbasicConstraints\t= CA:FALSE\nnsCertType\t\t\t= server\nextendedKeyUsage\t= serverAuth\n#authorityInfoAccess     = OCSP;URI:http://ocsp.\n\n# PKIX recommendations harmless if included in all certificates.\nsubjectKeyIdentifier\t=hash\nauthorityKeyIdentifier\t=keyid,issuer\n\n[ client_cert ]\nbasicConstraints\t\t= CA:FALSE\nnsCertType\t\t\t\t= client\nkeyUsage\t\t\t\t= nonRepudiation, digitalSignature, keyEncipherment\nextendedKeyUsage\t\t= clientAuth\n#authorityInfoAccess     = OCSP;URI:http://ocsp.\n\n[ v3_OCSP ]\nbasicConstraints\t\t= CA:FALSE\nkeyUsage\t\t\t\t= nonRepudiation, digitalSignature, keyEncipherment\nextendedKeyUsage\t\t= OCSPSigning\n\n[ v3_req ]\nbasicConstraints\t= CA:FALSE\nkeyUsage\t\t\t= nonRepudiation, digitalSignature, keyEncipherment\n\n[ v3_ca ]\nbasicConstraints\t\t= CA:true\nsubjectKeyIdentifier\t= hash\nauthorityKeyIdentifier\t= keyid:always,issuer\n# Key usage: this is typical for a CA certificate. However since it will\n# prevent it being used as an test self-signed certificate it is best\n# left out by default.\n# keyUsage = cRLSign, keyCertSign\nnsCertType = sslCA, emailCA\n\n[ v3_intermediate_ca ]\nsubjectKeyIdentifier\t= hash\nauthorityKeyIdentifier\t= keyid:always,issuer\nbasicConstraints\t\t= critical, CA:true, pathlen:1\nkeyUsage\t\t\t\t= critical, digitalSignature, cRLSign, keyCertSign\n\n[ crl_ext ]\nauthorityKeyIdentifier=keyid:always\n\n[ proxy_cert_ext ]\nbasicConstraints\t= CA:FALSE\n#nsComment\t\t\t= \"OpenSSL Generated Certificate\"\n\n# This really needs to be in place for it to be a proxy certificate.\nproxyCertInfo=critical,language:id-ppl-anyLanguage,pathlen:3,policy:foo\n","output":"str","x":450,"y":140,"wires":[["fb73de92.0149a"]]},{"id":"fb73de92.0149a","type":"file","z":"39dca28.bd9835e","name":"","filename":"/data/openssl/openssl.conf","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"none","x":680,"y":140,"wires":[["41f3d2d8c57ce6fc"]]},{"id":"48fef2aa.0c920c","type":"template","z":"39dca28.bd9835e","name":"index.txt","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"","output":"str","x":440,"y":200,"wires":[["9ab9da5f.a03868"]]},{"id":"9ab9da5f.a03868","type":"file","z":"39dca28.bd9835e","name":"","filename":"/data/openssl/index.txt","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"none","x":660,"y":200,"wires":[["b2be335889a9bdc5"]]},{"id":"2279910c.e4dc2e","type":"template","z":"39dca28.bd9835e","name":"serial","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"100000","output":"str","x":430,"y":260,"wires":[["1f9a8c30.6b5bf4"]]},{"id":"1f9a8c30.6b5bf4","type":"file","z":"39dca28.bd9835e","name":"","filename":"/data/openssl/serial","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"none","x":650,"y":260,"wires":[["52ea51c4e33b735c"]]},{"id":"501ec58a.4441fc","type":"template","z":"39dca28.bd9835e","name":"index.txt.attr","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"unique_subject = no","output":"str","x":190,"y":380,"wires":[["41c65446.c832cc"]]},{"id":"41c65446.c832cc","type":"file","z":"39dca28.bd9835e","name":"","filename":"/data/openssl/index.txt.attr","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"none","x":490,"y":380,"wires":[[]]},{"id":"40a874bd.a0907c","type":"template","z":"39dca28.bd9835e","name":"crlnumber","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"01","output":"str","x":440,"y":320,"wires":[["aaf5210d.02914"]]},{"id":"aaf5210d.02914","type":"file","z":"39dca28.bd9835e","name":"","filename":"/data/openssl/crlnumber","appendNewline":false,"createDir":false,"overwriteFile":"true","encoding":"none","x":670,"y":320,"wires":[["501ec58a.4441fc"]]},{"id":"526ebf8d.89a0e","type":"http in","z":"aa7daa87.f23d38","g":"55102cd0.770394","name":"","url":"/certificate/file","method":"get","upload":false,"swaggerDoc":"","x":210,"y":100,"wires":[["89a0f31e.3326f"]]},{"id":"89a0f31e.3326f","type":"file in","z":"aa7daa87.f23d38","g":"55102cd0.770394","name":"","filename":"/data/openssl/root.crt","format":"","chunk":false,"sendError":false,"encoding":"none","x":440,"y":100,"wires":[["d28bce12.b952b"]]},{"id":"d28bce12.b952b","type":"function","z":"aa7daa87.f23d38","g":"55102cd0.770394","name":"Headers","func":"msg.headers = {};\nmsg.headers['Content-Disposition'] = \"attachment; filename=CA_Certificate.crt\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":660,"y":100,"wires":[["774c8e59.57f15"]]},{"id":"774c8e59.57f15","type":"http response","z":"aa7daa87.f23d38","g":"55102cd0.770394","name":"","statusCode":"","headers":{},"x":870,"y":100,"wires":[]},{"id":"41b75fc9.9ee39","type":"http in","z":"aa7daa87.f23d38","g":"55102cd0.770394","name":"","url":"/certificate/pem","method":"get","upload":false,"swaggerDoc":"","x":210,"y":140,"wires":[["9331503d.968f6"]]},{"id":"9331503d.968f6","type":"file in","z":"aa7daa87.f23d38","g":"55102cd0.770394","name":"","filename":"/data/openssl/root.crt","format":"","chunk":false,"sendError":false,"encoding":"none","x":440,"y":140,"wires":[["598d89f5.11ab78"]]},{"id":"598d89f5.11ab78","type":"http response","z":"aa7daa87.f23d38","g":"55102cd0.770394","name":"","statusCode":"","headers":{},"x":650,"y":140,"wires":[]},{"id":"8b2cb158.09c71","type":"http in","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"","url":"/certificates/:id","method":"get","upload":false,"swaggerDoc":"","x":210,"y":300,"wires":[["a58633f.6d72cd","97e23772.b3bfe8"]]},{"id":"b1fc5e20.df417","type":"http in","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"","url":"/certificates","method":"get","upload":false,"swaggerDoc":"","x":200,"y":260,"wires":[["5b031341.a7b4fc"]]},{"id":"249f923d.7a207e","type":"http response","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"","statusCode":"","headers":{},"x":890,"y":260,"wires":[]},{"id":"a58633f.6d72cd","type":"function","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"No filename","func":"if( msg.payload.hasOwnProperty(\"filename\") )\n    return;\nmsg.filename = \"/data/openssl/newcerts/\" + msg.req.params.id + \".pem\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":300,"wires":[["6c6005e4.47de9c"]]},{"id":"97e23772.b3bfe8","type":"function","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"Has filename","func":"if( !msg.payload.hasOwnProperty(\"filename\") )\n    return;\nmsg.requestedFilename = msg.payload.filename;\nmsg.filename = \"/data/openssl/newcerts/\" + msg.req.params.id + \".pem\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":340,"wires":[["6025f955.749eb8"]]},{"id":"6c6005e4.47de9c","type":"file in","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":730,"y":300,"wires":[["249f923d.7a207e"]]},{"id":"5b031341.a7b4fc","type":"file in","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"","filename":"/data/openssl/index.txt","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":440,"y":260,"wires":[["914ced4c.ce73a"]]},{"id":"914ced4c.ce73a","type":"function","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"Parser","func":"rows = msg.payload.split(\"\\n\");\nlist = [];\nrows.forEach(function(row){\n    var items = row.split(\"\\t\");\n    if( items.length > 4 ) {\n        var timeparts = items[1].match(/.{1,2}/g);\n        var date = \"20\" + timeparts[0] + \"-\" + timeparts[1] + \"-\" + timeparts[2] + \" \" + timeparts[3] + \":\" + timeparts[4];\n        var cn = \"Undefined\";\n        var posCN = items[5].indexOf(\"/CN=\");\n        if( posCN > -1 )\n            cn = items[5].substr(posCN+4,items[5].length)\n        var filename = cn.replace(/\\s/g, '.').toLowerCase();\n        list.push({\n            id: items[3],\n            cn: cn,\n            status: items[0]===\"V\"?\"Valid\":items[0]===\"R\"?\"Revoked\":\"Undefined\",\n            expiration: date,\n            fileURL: '/certificates/' + items[3] +'?filename=' + filename + '.crt',\n            pemURL: '/certificates/' + items[3]\n        });\n    }\n})\n\n\n//Merger common names\nvar merger = {};\nlist.forEach(function(item){\n    merger[item.cn] = item;\n})\n\nmsg.payload = [];\nfor( var cn in merger )\n    msg.payload.push(merger[cn]);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":730,"y":260,"wires":[["249f923d.7a207e"]]},{"id":"6025f955.749eb8","type":"file in","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":570,"y":340,"wires":[["b1663c80.6d3a2"]]},{"id":"b1663c80.6d3a2","type":"function","z":"aa7daa87.f23d38","g":"2a982168.c36dfe","name":"Headers","func":"msg.headers = {};\nmsg.headers['Content-Type'] = \"application/octet-stream\";\nmsg.headers['Content-Disposition'] = \"attachment; filename=\" + msg.requestedFilename;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":340,"wires":[["249f923d.7a207e"]]},{"id":"805196d5.3bc168","type":"file in","z":"ff4de0da.c8d7d","g":"405924b7.935dbc","name":"","filename":"/data/openssl/index.txt","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":380,"y":60,"wires":[["34dea3ea.7804ac"]]},{"id":"34dea3ea.7804ac","type":"function","z":"ff4de0da.c8d7d","g":"405924b7.935dbc","name":"Parse","func":"rows = msg.payload.split(\"\\n\");\nlist = [];\nrows.forEach(function(row){\n    var items = row.split(\"\\t\");\n    if( items.length > 4 ) {\n        var timeparts = items[1].match(/.{1,2}/g);\n        var date = \"20\" + timeparts[0] + \"-\" + timeparts[1] + \"-\" + timeparts[2] + \" \" + timeparts[3] + \":\" + timeparts[4];\n        var cn = \"Undefined\";\n        var posCN = items[5].indexOf(\"/CN=\");\n        if( posCN > -1 )\n            cn = items[5].substr(posCN+4,items[5].length)\n        var filename = cn.replace(/\\s/g, '.').toLowerCase();\n        list.push({\n            id: items[3],\n            cn: cn,\n            status: items[0]===\"V\"?\"Valid\":items[0]===\"R\"?\"Revoked\":\"Undefined\",\n            expiration: date,\n            link: '<a href=\"/certificates/' + items[3] +'?filename=' + filename + '.crt\">' + cn + '</a>',\n            filename: filename\n        });\n    }\n})\n\n//Merger common names\nvar merger = {};\nlist.forEach(function(item){\n    merger[item.cn] = item;\n})\n\nmsg.payload = [];\nfor( var cn in merger )\n    msg.payload.push(merger[cn]);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":60,"wires":[["d5d0dec2.e9928"]]},{"id":"e42e962d.7aa998","type":"http in","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","url":"/dropzone/sign","method":"get","upload":false,"swaggerDoc":"","x":410,"y":600,"wires":[["71e30a2a.b579d4"]]},{"id":"8c30ff1b.6e51","type":"http response","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","x":1040,"y":600,"wires":[]},{"id":"71e30a2a.b579d4","type":"template","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"dropzone.js","field":"dropzonejs","fieldType":"msg","format":"javascript","syntax":"mustache","template":"\n/*\n *\n * More info at [www.dropzonejs.com](http://www.dropzonejs.com)\n *\n * Copyright (c) 2012, Matias Meno\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n\n(function() {\n  var Dropzone, Emitter, camelize, contentLoaded, detectVerticalSquash, drawImageIOSFix, noop, without,\n    __slice = [].slice,\n    __hasProp = {}.hasOwnProperty,\n    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\n  noop = function() {};\n\n  Emitter = (function() {\n    function Emitter() {}\n\n    Emitter.prototype.addEventListener = Emitter.prototype.on;\n\n    Emitter.prototype.on = function(event, fn) {\n      this._callbacks = this._callbacks || {};\n      if (!this._callbacks[event]) {\n        this._callbacks[event] = [];\n      }\n      this._callbacks[event].push(fn);\n      return this;\n    };\n\n    Emitter.prototype.emit = function() {\n      var args, callback, callbacks, event, _i, _len;\n      event = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      this._callbacks = this._callbacks || {};\n      callbacks = this._callbacks[event];\n      if (callbacks) {\n        for (_i = 0, _len = callbacks.length; _i < _len; _i++) {\n          callback = callbacks[_i];\n          callback.apply(this, args);\n        }\n      }\n      return this;\n    };\n\n    Emitter.prototype.removeListener = Emitter.prototype.off;\n\n    Emitter.prototype.removeAllListeners = Emitter.prototype.off;\n\n    Emitter.prototype.removeEventListener = Emitter.prototype.off;\n\n    Emitter.prototype.off = function(event, fn) {\n      var callback, callbacks, i, _i, _len;\n      if (!this._callbacks || arguments.length === 0) {\n        this._callbacks = {};\n        return this;\n      }\n      callbacks = this._callbacks[event];\n      if (!callbacks) {\n        return this;\n      }\n      if (arguments.length === 1) {\n        delete this._callbacks[event];\n        return this;\n      }\n      for (i = _i = 0, _len = callbacks.length; _i < _len; i = ++_i) {\n        callback = callbacks[i];\n        if (callback === fn) {\n          callbacks.splice(i, 1);\n          break;\n        }\n      }\n      return this;\n    };\n\n    return Emitter;\n\n  })();\n\n  Dropzone = (function(_super) {\n    var extend, resolveOption;\n\n    __extends(Dropzone, _super);\n\n    Dropzone.prototype.Emitter = Emitter;\n\n\n    /*\n    This is a list of all available events you can register on a dropzone object.\n    \n    You can register an event handler like this:\n    \n        dropzone.on(\"dragEnter\", function() { });\n     */\n\n    Dropzone.prototype.events = [\"drop\", \"dragstart\", \"dragend\", \"dragenter\", \"dragover\", \"dragleave\", \"addedfile\", \"addedfiles\", \"removedfile\", \"thumbnail\", \"error\", \"errormultiple\", \"processing\", \"processingmultiple\", \"uploadprogress\", \"totaluploadprogress\", \"sending\", \"sendingmultiple\", \"success\", \"successmultiple\", \"canceled\", \"canceledmultiple\", \"complete\", \"completemultiple\", \"reset\", \"maxfilesexceeded\", \"maxfilesreached\", \"queuecomplete\"];\n\n    Dropzone.prototype.defaultOptions = {\n      url: null,\n      method: \"post\",\n      withCredentials: false,\n      parallelUploads: 2,\n      uploadMultiple: false,\n      maxFilesize: 256,\n      paramName: \"file\",\n      createImageThumbnails: true,\n      maxThumbnailFilesize: 10,\n      thumbnailWidth: 120,\n      thumbnailHeight: 120,\n      filesizeBase: 1000,\n      maxFiles: null,\n      params: {},\n      clickable: true,\n      ignoreHiddenFiles: true,\n      acceptedFiles: null,\n      acceptedMimeTypes: null,\n      autoProcessQueue: true,\n      autoQueue: true,\n      addRemoveLinks: false,\n      previewsContainer: null,\n      hiddenInputContainer: \"body\",\n      capture: null,\n      renameFilename: null,\n      dictDefaultMessage: \"Drop CSR file here\",\n      dictFallbackMessage: \"Your browser does not support drag'n'drop file uploads.\",\n      dictFallbackText: \"Please use the fallback form below to upload your files like in the olden days.\",\n      dictFileTooBig: \"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.\",\n      dictInvalidFileType: \"You can't upload files of this type.\",\n      dictResponseError: \"Server responded with {{statusCode}} code.\",\n      dictCancelUpload: \"Cancel upload\",\n      dictCancelUploadConfirmation: \"Are you sure you want to cancel this upload?\",\n      dictRemoveFile: \"Remove file\",\n      dictRemoveFileConfirmation: null,\n      dictMaxFilesExceeded: \"You can not upload any more files.\",\n      accept: function(file, done) {\n        return done();\n      },\n      init: function() {\n        return noop;\n      },\n      forceFallback: false,\n      fallback: function() {\n        var child, messageElement, span, _i, _len, _ref;\n        this.element.className = \"\" + this.element.className + \" dz-browser-not-supported\";\n        _ref = this.element.getElementsByTagName(\"div\");\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          child = _ref[_i];\n          if (/(^| )dz-message($| )/.test(child.className)) {\n            messageElement = child;\n            child.className = \"dz-message\";\n            continue;\n          }\n        }\n        if (!messageElement) {\n          messageElement = Dropzone.createElement(\"<div class=\\\"dz-message\\\"><span></span></div>\");\n          this.element.appendChild(messageElement);\n        }\n        span = messageElement.getElementsByTagName(\"span\")[0];\n        if (span) {\n          if (span.textContent !== null) {\n            span.textContent = this.options.dictFallbackMessage;\n          } else if (span.innerText !== null) {\n            span.innerText = this.options.dictFallbackMessage;\n          }\n        }\n        return this.element.appendChild(this.getFallbackForm());\n      },\n      resize: function(file) {\n        var info, srcRatio, trgRatio;\n        info = {\n          srcX: 0,\n          srcY: 0,\n          srcWidth: file.width,\n          srcHeight: file.height\n        };\n        srcRatio = file.width / file.height;\n        info.optWidth = this.options.thumbnailWidth;\n        info.optHeight = this.options.thumbnailHeight;\n        if ((info.optWidth === null) && (info.optHeight === null)) {\n          info.optWidth = info.srcWidth;\n          info.optHeight = info.srcHeight;\n        } else if (info.optWidth === null) {\n          info.optWidth = srcRatio * info.optHeight;\n        } else if (info.optHeight === null) {\n          info.optHeight = (1 / srcRatio) * info.optWidth;\n        }\n        trgRatio = info.optWidth / info.optHeight;\n        if (file.height < info.optHeight || file.width < info.optWidth) {\n          info.trgHeight = info.srcHeight;\n          info.trgWidth = info.srcWidth;\n        } else {\n          if (srcRatio > trgRatio) {\n            info.srcHeight = file.height;\n            info.srcWidth = info.srcHeight * trgRatio;\n          } else {\n            info.srcWidth = file.width;\n            info.srcHeight = info.srcWidth / trgRatio;\n          }\n        }\n        info.srcX = (file.width - info.srcWidth) / 2;\n        info.srcY = (file.height - info.srcHeight) / 2;\n        return info;\n      },\n\n      /*\n      Those functions register themselves to the events on init and handle all\n      the user interface specific stuff. Overwriting them won't break the upload\n      but can break the way it's displayed.\n      You can overwrite them if you don't like the default behavior. If you just\n      want to add an additional event handler, register it on the dropzone object\n      and don't overwrite those options.\n       */\n      drop: function(e) {\n        return this.element.classList.remove(\"dz-drag-hover\");\n      },\n      dragstart: noop,\n      dragend: function(e) {\n        return this.element.classList.remove(\"dz-drag-hover\");\n      },\n      dragenter: function(e) {\n        return this.element.classList.add(\"dz-drag-hover\");\n      },\n      dragover: function(e) {\n        return this.element.classList.add(\"dz-drag-hover\");\n      },\n      dragleave: function(e) {\n        return this.element.classList.remove(\"dz-drag-hover\");\n      },\n      paste: noop,\n      reset: function() {\n        return this.element.classList.remove(\"dz-started\");\n      },\n      addedfile: function(file) {\n        var node, removeFileEvent, removeLink, _i, _j, _k, _len, _len1, _len2, _ref, _ref1, _ref2, _results;\n        if (this.element === this.previewsContainer) {\n          this.element.classList.add(\"dz-started\");\n        }\n        if (this.previewsContainer) {\n          file.previewElement = Dropzone.createElement(this.options.previewTemplate.trim());\n          file.previewTemplate = file.previewElement;\n          this.previewsContainer.appendChild(file.previewElement);\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-name]\");\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            node = _ref[_i];\n            node.textContent = this._renameFilename(file.name);\n          }\n          _ref1 = file.previewElement.querySelectorAll(\"[data-dz-size]\");\n          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {\n            node = _ref1[_j];\n            node.innerHTML = this.filesize(file.size);\n          }\n          if (this.options.addRemoveLinks) {\n            file._removeLink = Dropzone.createElement(\"<a class=\\\"dz-remove\\\" href=\\\"javascript:undefined;\\\" data-dz-remove>\" + this.options.dictRemoveFile + \"</a>\");\n            file.previewElement.appendChild(file._removeLink);\n          }\n          removeFileEvent = (function(_this) {\n            return function(e) {\n              e.preventDefault();\n              e.stopPropagation();\n              if (file.status === Dropzone.UPLOADING) {\n                return Dropzone.confirm(_this.options.dictCancelUploadConfirmation, function() {\n                  return _this.removeFile(file);\n                });\n              } else {\n                if (_this.options.dictRemoveFileConfirmation) {\n                  return Dropzone.confirm(_this.options.dictRemoveFileConfirmation, function() {\n                    return _this.removeFile(file);\n                  });\n                } else {\n                  return _this.removeFile(file);\n                }\n              }\n            };\n          })(this);\n          _ref2 = file.previewElement.querySelectorAll(\"[data-dz-remove]\");\n          _results = [];\n          for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {\n            removeLink = _ref2[_k];\n            _results.push(removeLink.addEventListener(\"click\", removeFileEvent));\n          }\n          return _results;\n        }\n      },\n      removedfile: function(file) {\n        var _ref;\n        if (file.previewElement) {\n          if ((_ref = file.previewElement) != null) {\n            _ref.parentNode.removeChild(file.previewElement);\n          }\n        }\n        return this._updateMaxFilesReachedClass();\n      },\n      thumbnail: function(file, dataUrl) {\n        var thumbnailElement, _i, _len, _ref;\n        if (file.previewElement) {\n          file.previewElement.classList.remove(\"dz-file-preview\");\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-thumbnail]\");\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            thumbnailElement = _ref[_i];\n            thumbnailElement.alt = file.name;\n            thumbnailElement.src = dataUrl;\n          }\n          return setTimeout(((function(_this) {\n            return function() {\n              return file.previewElement.classList.add(\"dz-image-preview\");\n            };\n          })(this)), 1);\n        }\n      },\n      error: function(file, message) {\n        var node, _i, _len, _ref, _results;\n        if (file.previewElement) {\n          file.previewElement.classList.add(\"dz-error\");\n          if (typeof message !== \"String\" && message.error) {\n            message = message.error;\n          }\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-errormessage]\");\n          _results = [];\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            node = _ref[_i];\n            _results.push(node.textContent = message);\n          }\n          return _results;\n        }\n      },\n      errormultiple: noop,\n      processing: function(file) {\n        if (file.previewElement) {\n          file.previewElement.classList.add(\"dz-processing\");\n          if (file._removeLink) {\n            return file._removeLink.textContent = this.options.dictCancelUpload;\n          }\n        }\n      },\n      processingmultiple: noop,\n      uploadprogress: function(file, progress, bytesSent) {\n        var node, _i, _len, _ref, _results;\n        if (file.previewElement) {\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-uploadprogress]\");\n          _results = [];\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            node = _ref[_i];\n            if (node.nodeName === 'PROGRESS') {\n              _results.push(node.value = progress);\n            } else {\n              _results.push(node.style.width = \"\" + progress + \"%\");\n            }\n          }\n          return _results;\n        }\n      },\n      totaluploadprogress: noop,\n      sending: noop,\n      sendingmultiple: noop,\n      success: function(file) {\n        if (file.previewElement) {\n          return file.previewElement.classList.add(\"dz-success\");\n        }\n      },\n      successmultiple: noop,\n      canceled: function(file) {\n        return this.emit(\"error\", file, \"Upload canceled.\");\n      },\n      canceledmultiple: noop,\n      complete: function(file) {\n        if (file._removeLink) {\n          file._removeLink.textContent = this.options.dictRemoveFile;\n        }\n        if (file.previewElement) {\n          return file.previewElement.classList.add(\"dz-complete\");\n        }\n      },\n      completemultiple: noop,\n      maxfilesexceeded: noop,\n      maxfilesreached: noop,\n      queuecomplete: noop,\n      addedfiles: noop,\n      previewTemplate: \"<div class=\\\"dz-preview dz-file-preview\\\">\\n  <div class=\\\"dz-image\\\"><img data-dz-thumbnail /></div>\\n  <div class=\\\"dz-details\\\">\\n    <div class=\\\"dz-size\\\"><span data-dz-size></span></div>\\n    <div class=\\\"dz-filename\\\"><span data-dz-name></span></div>\\n  </div>\\n  <div class=\\\"dz-progress\\\"><span class=\\\"dz-upload\\\" data-dz-uploadprogress></span></div>\\n  <div class=\\\"dz-error-message\\\"><span data-dz-errormessage></span></div>\\n  <div class=\\\"dz-success-mark\\\">\\n    <svg width=\\\"54px\\\" height=\\\"54px\\\" viewBox=\\\"0 0 54 54\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xmlns:sketch=\\\"http://www.bohemiancoding.com/sketch/ns\\\">\\n      <title>Check</title>\\n      <defs></defs>\\n      <g id=\\\"Page-1\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" sketch:type=\\\"MSPage\\\">\\n        <path d=\\\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\\\" id=\\\"Oval-2\\\" stroke-opacity=\\\"0.198794158\\\" stroke=\\\"#747474\\\" fill-opacity=\\\"0.816519475\\\" fill=\\\"#FFFFFF\\\" sketch:type=\\\"MSShapeGroup\\\"></path>\\n      </g>\\n    </svg>\\n  </div>\\n  <div class=\\\"dz-error-mark\\\">\\n    <svg width=\\\"54px\\\" height=\\\"54px\\\" viewBox=\\\"0 0 54 54\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xmlns:sketch=\\\"http://www.bohemiancoding.com/sketch/ns\\\">\\n      <title>Error</title>\\n      <defs></defs>\\n      <g id=\\\"Page-1\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" sketch:type=\\\"MSPage\\\">\\n        <g id=\\\"Check-+-Oval-2\\\" sketch:type=\\\"MSLayerGroup\\\" stroke=\\\"#747474\\\" stroke-opacity=\\\"0.198794158\\\" fill=\\\"#FFFFFF\\\" fill-opacity=\\\"0.816519475\\\">\\n          <path d=\\\"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\\\" id=\\\"Oval-2\\\" sketch:type=\\\"MSShapeGroup\\\"></path>\\n        </g>\\n      </g>\\n    </svg>\\n  </div>\\n</div>\"\n    };\n\n    extend = function() {\n      var key, object, objects, target, val, _i, _len;\n      target = arguments[0], objects = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      for (_i = 0, _len = objects.length; _i < _len; _i++) {\n        object = objects[_i];\n        for (key in object) {\n          val = object[key];\n          target[key] = val;\n        }\n      }\n      return target;\n    };\n\n    function Dropzone(element, options) {\n      var elementOptions, fallback, _ref;\n      this.element = element;\n      this.version = Dropzone.version;\n      this.defaultOptions.previewTemplate = this.defaultOptions.previewTemplate.replace(/\\n*/g, \"\");\n      this.clickableElements = [];\n      this.listeners = [];\n      this.files = [];\n      if (typeof this.element === \"string\") {\n        this.element = document.querySelector(this.element);\n      }\n      if (!(this.element && (this.element.nodeType != null))) {\n        throw new Error(\"Invalid dropzone element.\");\n      }\n      if (this.element.dropzone) {\n        throw new Error(\"Dropzone already attached.\");\n      }\n      Dropzone.instances.push(this);\n      this.element.dropzone = this;\n      elementOptions = (_ref = Dropzone.optionsForElement(this.element)) != null ? _ref : {};\n      this.options = extend({}, this.defaultOptions, elementOptions, options != null ? options : {});\n      if (this.options.forceFallback || !Dropzone.isBrowserSupported()) {\n        return this.options.fallback.call(this);\n      }\n      if (this.options.url == null) {\n        this.options.url = this.element.getAttribute(\"action\");\n      }\n      if (!this.options.url) {\n        throw new Error(\"No URL provided.\");\n      }\n      if (this.options.acceptedFiles && this.options.acceptedMimeTypes) {\n        throw new Error(\"You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.\");\n      }\n      if (this.options.acceptedMimeTypes) {\n        this.options.acceptedFiles = this.options.acceptedMimeTypes;\n        delete this.options.acceptedMimeTypes;\n      }\n      this.options.method = this.options.method.toUpperCase();\n      if ((fallback = this.getExistingFallback()) && fallback.parentNode) {\n        fallback.parentNode.removeChild(fallback);\n      }\n      if (this.options.previewsContainer !== false) {\n        if (this.options.previewsContainer) {\n          this.previewsContainer = Dropzone.getElement(this.options.previewsContainer, \"previewsContainer\");\n        } else {\n          this.previewsContainer = this.element;\n        }\n      }\n      if (this.options.clickable) {\n        if (this.options.clickable === true) {\n          this.clickableElements = [this.element];\n        } else {\n          this.clickableElements = Dropzone.getElements(this.options.clickable, \"clickable\");\n        }\n      }\n      this.init();\n    }\n\n    Dropzone.prototype.getAcceptedFiles = function() {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.accepted) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.getRejectedFiles = function() {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (!file.accepted) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.getFilesWithStatus = function(status) {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.status === status) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.getQueuedFiles = function() {\n      return this.getFilesWithStatus(Dropzone.QUEUED);\n    };\n\n    Dropzone.prototype.getUploadingFiles = function() {\n      return this.getFilesWithStatus(Dropzone.UPLOADING);\n    };\n\n    Dropzone.prototype.getAddedFiles = function() {\n      return this.getFilesWithStatus(Dropzone.ADDED);\n    };\n\n    Dropzone.prototype.getActiveFiles = function() {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.status === Dropzone.UPLOADING || file.status === Dropzone.QUEUED) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.init = function() {\n      var eventName, noPropagation, setupHiddenFileInput, _i, _len, _ref, _ref1;\n      if (this.element.tagName === \"form\") {\n        this.element.setAttribute(\"enctype\", \"multipart/form-data\");\n      }\n      if (this.element.classList.contains(\"dropzone\") && !this.element.querySelector(\".dz-message\")) {\n        this.element.appendChild(Dropzone.createElement(\"<div class=\\\"dz-default dz-message\\\"><span>\" + this.options.dictDefaultMessage + \"</span></div>\"));\n      }\n      if (this.clickableElements.length) {\n        setupHiddenFileInput = (function(_this) {\n          return function() {\n            if (_this.hiddenFileInput) {\n              _this.hiddenFileInput.parentNode.removeChild(_this.hiddenFileInput);\n            }\n            _this.hiddenFileInput = document.createElement(\"input\");\n            _this.hiddenFileInput.setAttribute(\"type\", \"file\");\n            if ((_this.options.maxFiles == null) || _this.options.maxFiles > 1) {\n              _this.hiddenFileInput.setAttribute(\"multiple\", \"multiple\");\n            }\n            _this.hiddenFileInput.className = \"dz-hidden-input\";\n            if (_this.options.acceptedFiles != null) {\n              _this.hiddenFileInput.setAttribute(\"accept\", _this.options.acceptedFiles);\n            }\n            if (_this.options.capture != null) {\n              _this.hiddenFileInput.setAttribute(\"capture\", _this.options.capture);\n            }\n            _this.hiddenFileInput.style.visibility = \"hidden\";\n            _this.hiddenFileInput.style.position = \"absolute\";\n            _this.hiddenFileInput.style.top = \"0\";\n            _this.hiddenFileInput.style.left = \"0\";\n            _this.hiddenFileInput.style.height = \"0\";\n            _this.hiddenFileInput.style.width = \"0\";\n            document.querySelector(_this.options.hiddenInputContainer).appendChild(_this.hiddenFileInput);\n            return _this.hiddenFileInput.addEventListener(\"change\", function() {\n              var file, files, _i, _len;\n              files = _this.hiddenFileInput.files;\n              if (files.length) {\n                for (_i = 0, _len = files.length; _i < _len; _i++) {\n                  file = files[_i];\n                  _this.addFile(file);\n                }\n              }\n              _this.emit(\"addedfiles\", files);\n              return setupHiddenFileInput();\n            });\n          };\n        })(this);\n        setupHiddenFileInput();\n      }\n      this.URL = (_ref = window.URL) != null ? _ref : window.webkitURL;\n      _ref1 = this.events;\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        eventName = _ref1[_i];\n        this.on(eventName, this.options[eventName]);\n      }\n      this.on(\"uploadprogress\", (function(_this) {\n        return function() {\n          return _this.updateTotalUploadProgress();\n        };\n      })(this));\n      this.on(\"removedfile\", (function(_this) {\n        return function() {\n          return _this.updateTotalUploadProgress();\n        };\n      })(this));\n      this.on(\"canceled\", (function(_this) {\n        return function(file) {\n          return _this.emit(\"complete\", file);\n        };\n      })(this));\n      this.on(\"complete\", (function(_this) {\n        return function(file) {\n          if (_this.getAddedFiles().length === 0 && _this.getUploadingFiles().length === 0 && _this.getQueuedFiles().length === 0) {\n            return setTimeout((function() {\n              return _this.emit(\"queuecomplete\");\n            }), 0);\n          }\n        };\n      })(this));\n      noPropagation = function(e) {\n        e.stopPropagation();\n        if (e.preventDefault) {\n          return e.preventDefault();\n        } else {\n          return e.returnValue = false;\n        }\n      };\n      this.listeners = [\n        {\n          element: this.element,\n          events: {\n            \"dragstart\": (function(_this) {\n              return function(e) {\n                return _this.emit(\"dragstart\", e);\n              };\n            })(this),\n            \"dragenter\": (function(_this) {\n              return function(e) {\n                noPropagation(e);\n                return _this.emit(\"dragenter\", e);\n              };\n            })(this),\n            \"dragover\": (function(_this) {\n              return function(e) {\n                var efct;\n                try {\n                  efct = e.dataTransfer.effectAllowed;\n                } catch (_error) {}\n                e.dataTransfer.dropEffect = 'move' === efct || 'linkMove' === efct ? 'move' : 'copy';\n                noPropagation(e);\n                return _this.emit(\"dragover\", e);\n              };\n            })(this),\n            \"dragleave\": (function(_this) {\n              return function(e) {\n                return _this.emit(\"dragleave\", e);\n              };\n            })(this),\n            \"drop\": (function(_this) {\n              return function(e) {\n                noPropagation(e);\n                return _this.drop(e);\n              };\n            })(this),\n            \"dragend\": (function(_this) {\n              return function(e) {\n                return _this.emit(\"dragend\", e);\n              };\n            })(this)\n          }\n        }\n      ];\n      this.clickableElements.forEach((function(_this) {\n        return function(clickableElement) {\n          return _this.listeners.push({\n            element: clickableElement,\n            events: {\n              \"click\": function(evt) {\n                if ((clickableElement !== _this.element) || (evt.target === _this.element || Dropzone.elementInside(evt.target, _this.element.querySelector(\".dz-message\")))) {\n                  _this.hiddenFileInput.click();\n                }\n                return true;\n              }\n            }\n          });\n        };\n      })(this));\n      this.enable();\n      return this.options.init.call(this);\n    };\n\n    Dropzone.prototype.destroy = function() {\n      var _ref;\n      this.disable();\n      this.removeAllFiles(true);\n      if ((_ref = this.hiddenFileInput) != null ? _ref.parentNode : void 0) {\n        this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput);\n        this.hiddenFileInput = null;\n      }\n      delete this.element.dropzone;\n      return Dropzone.instances.splice(Dropzone.instances.indexOf(this), 1);\n    };\n\n    Dropzone.prototype.updateTotalUploadProgress = function() {\n      var activeFiles, file, totalBytes, totalBytesSent, totalUploadProgress, _i, _len, _ref;\n      totalBytesSent = 0;\n      totalBytes = 0;\n      activeFiles = this.getActiveFiles();\n      if (activeFiles.length) {\n        _ref = this.getActiveFiles();\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          file = _ref[_i];\n          totalBytesSent += file.upload.bytesSent;\n          totalBytes += file.upload.total;\n        }\n        totalUploadProgress = 100 * totalBytesSent / totalBytes;\n      } else {\n        totalUploadProgress = 100;\n      }\n      return this.emit(\"totaluploadprogress\", totalUploadProgress, totalBytes, totalBytesSent);\n    };\n\n    Dropzone.prototype._getParamName = function(n) {\n      if (typeof this.options.paramName === \"function\") {\n        return this.options.paramName(n);\n      } else {\n        return \"\" + this.options.paramName + (this.options.uploadMultiple ? \"[\" + n + \"]\" : \"\");\n      }\n    };\n\n    Dropzone.prototype._renameFilename = function(name) {\n      if (typeof this.options.renameFilename !== \"function\") {\n        return name;\n      }\n      return this.options.renameFilename(name);\n    };\n\n    Dropzone.prototype.getFallbackForm = function() {\n      var existingFallback, fields, fieldsString, form;\n      if (existingFallback = this.getExistingFallback()) {\n        return existingFallback;\n      }\n      fieldsString = \"<div class=\\\"dz-fallback\\\">\";\n      if (this.options.dictFallbackText) {\n        fieldsString += \"<p>\" + this.options.dictFallbackText + \"</p>\";\n      }\n      fieldsString += \"<input type=\\\"file\\\" name=\\\"\" + (this._getParamName(0)) + \"\\\" \" + (this.options.uploadMultiple ? 'multiple=\"multiple\"' : void 0) + \" /><input type=\\\"submit\\\" value=\\\"Upload!\\\"></div>\";\n      fields = Dropzone.createElement(fieldsString);\n      if (this.element.tagName !== \"FORM\") {\n        form = Dropzone.createElement(\"<form action=\\\"\" + this.options.url + \"\\\" enctype=\\\"multipart/form-data\\\" method=\\\"\" + this.options.method + \"\\\"></form>\");\n        form.appendChild(fields);\n      } else {\n        this.element.setAttribute(\"enctype\", \"multipart/form-data\");\n        this.element.setAttribute(\"method\", this.options.method);\n      }\n      return form != null ? form : fields;\n    };\n\n    Dropzone.prototype.getExistingFallback = function() {\n      var fallback, getFallback, tagName, _i, _len, _ref;\n      getFallback = function(elements) {\n        var el, _i, _len;\n        for (_i = 0, _len = elements.length; _i < _len; _i++) {\n          el = elements[_i];\n          if (/(^| )fallback($| )/.test(el.className)) {\n            return el;\n          }\n        }\n      };\n      _ref = [\"div\", \"form\"];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        tagName = _ref[_i];\n        if (fallback = getFallback(this.element.getElementsByTagName(tagName))) {\n          return fallback;\n        }\n      }\n    };\n\n    Dropzone.prototype.setupEventListeners = function() {\n      var elementListeners, event, listener, _i, _len, _ref, _results;\n      _ref = this.listeners;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        elementListeners = _ref[_i];\n        _results.push((function() {\n          var _ref1, _results1;\n          _ref1 = elementListeners.events;\n          _results1 = [];\n          for (event in _ref1) {\n            listener = _ref1[event];\n            _results1.push(elementListeners.element.addEventListener(event, listener, false));\n          }\n          return _results1;\n        })());\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.removeEventListeners = function() {\n      var elementListeners, event, listener, _i, _len, _ref, _results;\n      _ref = this.listeners;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        elementListeners = _ref[_i];\n        _results.push((function() {\n          var _ref1, _results1;\n          _ref1 = elementListeners.events;\n          _results1 = [];\n          for (event in _ref1) {\n            listener = _ref1[event];\n            _results1.push(elementListeners.element.removeEventListener(event, listener, false));\n          }\n          return _results1;\n        })());\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.disable = function() {\n      var file, _i, _len, _ref, _results;\n      this.clickableElements.forEach(function(element) {\n        return element.classList.remove(\"dz-clickable\");\n      });\n      this.removeEventListeners();\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        _results.push(this.cancelUpload(file));\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.enable = function() {\n      this.clickableElements.forEach(function(element) {\n        return element.classList.add(\"dz-clickable\");\n      });\n      return this.setupEventListeners();\n    };\n\n    Dropzone.prototype.filesize = function(size) {\n      var cutoff, i, selectedSize, selectedUnit, unit, units, _i, _len;\n      selectedSize = 0;\n      selectedUnit = \"b\";\n      if (size > 0) {\n        units = ['TB', 'GB', 'MB', 'KB', 'b'];\n        for (i = _i = 0, _len = units.length; _i < _len; i = ++_i) {\n          unit = units[i];\n          cutoff = Math.pow(this.options.filesizeBase, 4 - i) / 10;\n          if (size >= cutoff) {\n            selectedSize = size / Math.pow(this.options.filesizeBase, 4 - i);\n            selectedUnit = unit;\n            break;\n          }\n        }\n        selectedSize = Math.round(10 * selectedSize) / 10;\n      }\n      return \"<strong>\" + selectedSize + \"</strong> \" + selectedUnit;\n    };\n\n    Dropzone.prototype._updateMaxFilesReachedClass = function() {\n      if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {\n        if (this.getAcceptedFiles().length === this.options.maxFiles) {\n          this.emit('maxfilesreached', this.files);\n        }\n        return this.element.classList.add(\"dz-max-files-reached\");\n      } else {\n        return this.element.classList.remove(\"dz-max-files-reached\");\n      }\n    };\n\n    Dropzone.prototype.drop = function(e) {\n      var files, items;\n      if (!e.dataTransfer) {\n        return;\n      }\n      this.emit(\"drop\", e);\n      files = e.dataTransfer.files;\n      this.emit(\"addedfiles\", files);\n      if (files.length) {\n        items = e.dataTransfer.items;\n        if (items && items.length && (items[0].webkitGetAsEntry != null)) {\n          this._addFilesFromItems(items);\n        } else {\n          this.handleFiles(files);\n        }\n      }\n    };\n\n    Dropzone.prototype.paste = function(e) {\n      var items, _ref;\n      if ((e != null ? (_ref = e.clipboardData) != null ? _ref.items : void 0 : void 0) == null) {\n        return;\n      }\n      this.emit(\"paste\", e);\n      items = e.clipboardData.items;\n      if (items.length) {\n        return this._addFilesFromItems(items);\n      }\n    };\n\n    Dropzone.prototype.handleFiles = function(files) {\n      var file, _i, _len, _results;\n      _results = [];\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        _results.push(this.addFile(file));\n      }\n      return _results;\n    };\n\n    Dropzone.prototype._addFilesFromItems = function(items) {\n      var entry, item, _i, _len, _results;\n      _results = [];\n      for (_i = 0, _len = items.length; _i < _len; _i++) {\n        item = items[_i];\n        if ((item.webkitGetAsEntry != null) && (entry = item.webkitGetAsEntry())) {\n          if (entry.isFile) {\n            _results.push(this.addFile(item.getAsFile()));\n          } else if (entry.isDirectory) {\n            _results.push(this._addFilesFromDirectory(entry, entry.name));\n          } else {\n            _results.push(void 0);\n          }\n        } else if (item.getAsFile != null) {\n          if ((item.kind == null) || item.kind === \"file\") {\n            _results.push(this.addFile(item.getAsFile()));\n          } else {\n            _results.push(void 0);\n          }\n        } else {\n          _results.push(void 0);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype._addFilesFromDirectory = function(directory, path) {\n      var dirReader, errorHandler, readEntries;\n      dirReader = directory.createReader();\n      errorHandler = function(error) {\n        return typeof console !== \"undefined\" && console !== null ? typeof console.log === \"function\" ? console.log(error) : void 0 : void 0;\n      };\n      readEntries = (function(_this) {\n        return function() {\n          return dirReader.readEntries(function(entries) {\n            var entry, _i, _len;\n            if (entries.length > 0) {\n              for (_i = 0, _len = entries.length; _i < _len; _i++) {\n                entry = entries[_i];\n                if (entry.isFile) {\n                  entry.file(function(file) {\n                    if (_this.options.ignoreHiddenFiles && file.name.substring(0, 1) === '.') {\n                      return;\n                    }\n                    file.fullPath = \"\" + path + \"/\" + file.name;\n                    return _this.addFile(file);\n                  });\n                } else if (entry.isDirectory) {\n                  _this._addFilesFromDirectory(entry, \"\" + path + \"/\" + entry.name);\n                }\n              }\n              readEntries();\n            }\n            return null;\n          }, errorHandler);\n        };\n      })(this);\n      return readEntries();\n    };\n\n    Dropzone.prototype.accept = function(file, done) {\n      if (file.size > this.options.maxFilesize * 1024 * 1024) {\n        return done(this.options.dictFileTooBig.replace(\"{{filesize}}\", Math.round(file.size / 1024 / 10.24) / 100).replace(\"{{maxFilesize}}\", this.options.maxFilesize));\n      } else if (!Dropzone.isValidFile(file, this.options.acceptedFiles)) {\n        return done(this.options.dictInvalidFileType);\n      } else if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {\n        done(this.options.dictMaxFilesExceeded.replace(\"{{maxFiles}}\", this.options.maxFiles));\n        return this.emit(\"maxfilesexceeded\", file);\n      } else {\n        return this.options.accept.call(this, file, done);\n      }\n    };\n\n    Dropzone.prototype.addFile = function(file) {\n      file.upload = {\n        progress: 0,\n        total: file.size,\n        bytesSent: 0\n      };\n      this.files.push(file);\n      file.status = Dropzone.ADDED;\n      this.emit(\"addedfile\", file);\n      this._enqueueThumbnail(file);\n      return this.accept(file, (function(_this) {\n        return function(error) {\n          if (error) {\n            file.accepted = false;\n            _this._errorProcessing([file], error);\n          } else {\n            file.accepted = true;\n            if (_this.options.autoQueue) {\n              _this.enqueueFile(file);\n            }\n          }\n          return _this._updateMaxFilesReachedClass();\n        };\n      })(this));\n    };\n\n    Dropzone.prototype.enqueueFiles = function(files) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        this.enqueueFile(file);\n      }\n      return null;\n    };\n\n    Dropzone.prototype.enqueueFile = function(file) {\n      if (file.status === Dropzone.ADDED && file.accepted === true) {\n        file.status = Dropzone.QUEUED;\n        if (this.options.autoProcessQueue) {\n          return setTimeout(((function(_this) {\n            return function() {\n              return _this.processQueue();\n            };\n          })(this)), 0);\n        }\n      } else {\n        throw new Error(\"This file can't be queued because it has already been processed or was rejected.\");\n      }\n    };\n\n    Dropzone.prototype._thumbnailQueue = [];\n\n    Dropzone.prototype._processingThumbnail = false;\n\n    Dropzone.prototype._enqueueThumbnail = function(file) {\n      if (this.options.createImageThumbnails && file.type.match(/image.*/) && file.size <= this.options.maxThumbnailFilesize * 1024 * 1024) {\n        this._thumbnailQueue.push(file);\n        return setTimeout(((function(_this) {\n          return function() {\n            return _this._processThumbnailQueue();\n          };\n        })(this)), 0);\n      }\n    };\n\n    Dropzone.prototype._processThumbnailQueue = function() {\n      if (this._processingThumbnail || this._thumbnailQueue.length === 0) {\n        return;\n      }\n      this._processingThumbnail = true;\n      return this.createThumbnail(this._thumbnailQueue.shift(), (function(_this) {\n        return function() {\n          _this._processingThumbnail = false;\n          return _this._processThumbnailQueue();\n        };\n      })(this));\n    };\n\n    Dropzone.prototype.removeFile = function(file) {\n      if (file.status === Dropzone.UPLOADING) {\n        this.cancelUpload(file);\n      }\n      this.files = without(this.files, file);\n      this.emit(\"removedfile\", file);\n      if (this.files.length === 0) {\n        return this.emit(\"reset\");\n      }\n    };\n\n    Dropzone.prototype.removeAllFiles = function(cancelIfNecessary) {\n      var file, _i, _len, _ref;\n      if (cancelIfNecessary == null) {\n        cancelIfNecessary = false;\n      }\n      _ref = this.files.slice();\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.status !== Dropzone.UPLOADING || cancelIfNecessary) {\n          this.removeFile(file);\n        }\n      }\n      return null;\n    };\n\n    Dropzone.prototype.createThumbnail = function(file, callback) {\n      var fileReader;\n      fileReader = new FileReader;\n      fileReader.onload = (function(_this) {\n        return function() {\n          if (file.type === \"image/svg+xml\") {\n            _this.emit(\"thumbnail\", file, fileReader.result);\n            if (callback != null) {\n              callback();\n            }\n            return;\n          }\n          return _this.createThumbnailFromUrl(file, fileReader.result, callback);\n        };\n      })(this);\n      return fileReader.readAsDataURL(file);\n    };\n\n    Dropzone.prototype.createThumbnailFromUrl = function(file, imageUrl, callback, crossOrigin) {\n      var img;\n      img = document.createElement(\"img\");\n      if (crossOrigin) {\n        img.crossOrigin = crossOrigin;\n      }\n      img.onload = (function(_this) {\n        return function() {\n          var canvas, ctx, resizeInfo, thumbnail, _ref, _ref1, _ref2, _ref3;\n          file.width = img.width;\n          file.height = img.height;\n          resizeInfo = _this.options.resize.call(_this, file);\n          if (resizeInfo.trgWidth == null) {\n            resizeInfo.trgWidth = resizeInfo.optWidth;\n          }\n          if (resizeInfo.trgHeight == null) {\n            resizeInfo.trgHeight = resizeInfo.optHeight;\n          }\n          canvas = document.createElement(\"canvas\");\n          ctx = canvas.getContext(\"2d\");\n          canvas.width = resizeInfo.trgWidth;\n          canvas.height = resizeInfo.trgHeight;\n          drawImageIOSFix(ctx, img, (_ref = resizeInfo.srcX) != null ? _ref : 0, (_ref1 = resizeInfo.srcY) != null ? _ref1 : 0, resizeInfo.srcWidth, resizeInfo.srcHeight, (_ref2 = resizeInfo.trgX) != null ? _ref2 : 0, (_ref3 = resizeInfo.trgY) != null ? _ref3 : 0, resizeInfo.trgWidth, resizeInfo.trgHeight);\n          thumbnail = canvas.toDataURL(\"image/png\");\n          _this.emit(\"thumbnail\", file, thumbnail);\n          if (callback != null) {\n            return callback();\n          }\n        };\n      })(this);\n      if (callback != null) {\n        img.onerror = callback;\n      }\n      return img.src = imageUrl;\n    };\n\n    Dropzone.prototype.processQueue = function() {\n      var i, parallelUploads, processingLength, queuedFiles;\n      parallelUploads = this.options.parallelUploads;\n      processingLength = this.getUploadingFiles().length;\n      i = processingLength;\n      if (processingLength >= parallelUploads) {\n        return;\n      }\n      queuedFiles = this.getQueuedFiles();\n      if (!(queuedFiles.length > 0)) {\n        return;\n      }\n      if (this.options.uploadMultiple) {\n        return this.processFiles(queuedFiles.slice(0, parallelUploads - processingLength));\n      } else {\n        while (i < parallelUploads) {\n          if (!queuedFiles.length) {\n            return;\n          }\n          this.processFile(queuedFiles.shift());\n          i++;\n        }\n      }\n    };\n\n    Dropzone.prototype.processFile = function(file) {\n      return this.processFiles([file]);\n    };\n\n    Dropzone.prototype.processFiles = function(files) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.processing = true;\n        file.status = Dropzone.UPLOADING;\n        this.emit(\"processing\", file);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"processingmultiple\", files);\n      }\n      return this.uploadFiles(files);\n    };\n\n    Dropzone.prototype._getFilesWithXhr = function(xhr) {\n      var file, files;\n      return files = (function() {\n        var _i, _len, _ref, _results;\n        _ref = this.files;\n        _results = [];\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          file = _ref[_i];\n          if (file.xhr === xhr) {\n            _results.push(file);\n          }\n        }\n        return _results;\n      }).call(this);\n    };\n\n    Dropzone.prototype.cancelUpload = function(file) {\n      var groupedFile, groupedFiles, _i, _j, _len, _len1, _ref;\n      if (file.status === Dropzone.UPLOADING) {\n        groupedFiles = this._getFilesWithXhr(file.xhr);\n        for (_i = 0, _len = groupedFiles.length; _i < _len; _i++) {\n          groupedFile = groupedFiles[_i];\n          groupedFile.status = Dropzone.CANCELED;\n        }\n        file.xhr.abort();\n        for (_j = 0, _len1 = groupedFiles.length; _j < _len1; _j++) {\n          groupedFile = groupedFiles[_j];\n          this.emit(\"canceled\", groupedFile);\n        }\n        if (this.options.uploadMultiple) {\n          this.emit(\"canceledmultiple\", groupedFiles);\n        }\n      } else if ((_ref = file.status) === Dropzone.ADDED || _ref === Dropzone.QUEUED) {\n        file.status = Dropzone.CANCELED;\n        this.emit(\"canceled\", file);\n        if (this.options.uploadMultiple) {\n          this.emit(\"canceledmultiple\", [file]);\n        }\n      }\n      if (this.options.autoProcessQueue) {\n        return this.processQueue();\n      }\n    };\n\n    resolveOption = function() {\n      var args, option;\n      option = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      if (typeof option === 'function') {\n        return option.apply(this, args);\n      }\n      return option;\n    };\n\n    Dropzone.prototype.uploadFile = function(file) {\n      return this.uploadFiles([file]);\n    };\n\n    Dropzone.prototype.uploadFiles = function(files) {\n      var file, formData, handleError, headerName, headerValue, headers, i, input, inputName, inputType, key, method, option, progressObj, response, updateProgress, url, value, xhr, _i, _j, _k, _l, _len, _len1, _len2, _len3, _m, _ref, _ref1, _ref2, _ref3, _ref4, _ref5;\n      xhr = new XMLHttpRequest();\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.xhr = xhr;\n      }\n      method = resolveOption(this.options.method, files);\n      url = resolveOption(this.options.url, files);\n      xhr.open(method, url, true);\n      xhr.withCredentials = !!this.options.withCredentials;\n      response = null;\n      handleError = (function(_this) {\n        return function() {\n          var _j, _len1, _results;\n          _results = [];\n          for (_j = 0, _len1 = files.length; _j < _len1; _j++) {\n            file = files[_j];\n            _results.push(_this._errorProcessing(files, response || _this.options.dictResponseError.replace(\"{{statusCode}}\", xhr.status), xhr));\n          }\n          return _results;\n        };\n      })(this);\n      updateProgress = (function(_this) {\n        return function(e) {\n          var allFilesFinished, progress, _j, _k, _l, _len1, _len2, _len3, _results;\n          if (e != null) {\n            progress = 100 * e.loaded / e.total;\n            for (_j = 0, _len1 = files.length; _j < _len1; _j++) {\n              file = files[_j];\n              file.upload = {\n                progress: progress,\n                total: e.total,\n                bytesSent: e.loaded\n              };\n            }\n          } else {\n            allFilesFinished = true;\n            progress = 100;\n            for (_k = 0, _len2 = files.length; _k < _len2; _k++) {\n              file = files[_k];\n              if (!(file.upload.progress === 100 && file.upload.bytesSent === file.upload.total)) {\n                allFilesFinished = false;\n              }\n              file.upload.progress = progress;\n              file.upload.bytesSent = file.upload.total;\n            }\n            if (allFilesFinished) {\n              return;\n            }\n          }\n          _results = [];\n          for (_l = 0, _len3 = files.length; _l < _len3; _l++) {\n            file = files[_l];\n            _results.push(_this.emit(\"uploadprogress\", file, progress, file.upload.bytesSent));\n          }\n          return _results;\n        };\n      })(this);\n      xhr.onload = (function(_this) {\n        return function(e) {\n          var _ref;\n          if (files[0].status === Dropzone.CANCELED) {\n            return;\n          }\n          if (xhr.readyState !== 4) {\n            return;\n          }\n          response = xhr.responseText;\n          if (xhr.getResponseHeader(\"content-type\") && ~xhr.getResponseHeader(\"content-type\").indexOf(\"application/json\")) {\n            try {\n              response = JSON.parse(response);\n            } catch (_error) {\n              e = _error;\n              response = \"Invalid JSON response from server.\";\n            }\n          }\n          updateProgress();\n          if (!((200 <= (_ref = xhr.status) && _ref < 300))) {\n            return handleError();\n          } else {\n            return _this._finished(files, response, e);\n          }\n        };\n      })(this);\n      xhr.onerror = (function(_this) {\n        return function() {\n          if (files[0].status === Dropzone.CANCELED) {\n            return;\n          }\n          return handleError();\n        };\n      })(this);\n      progressObj = (_ref = xhr.upload) != null ? _ref : xhr;\n      progressObj.onprogress = updateProgress;\n      headers = {\n        \"Accept\": \"application/json\",\n        \"Cache-Control\": \"no-cache\",\n        \"X-Requested-With\": \"XMLHttpRequest\"\n      };\n      if (this.options.headers) {\n        extend(headers, this.options.headers);\n      }\n      for (headerName in headers) {\n        headerValue = headers[headerName];\n        if (headerValue) {\n          xhr.setRequestHeader(headerName, headerValue);\n        }\n      }\n      formData = new FormData();\n      if (this.options.params) {\n        _ref1 = this.options.params;\n        for (key in _ref1) {\n          value = _ref1[key];\n          formData.append(key, value);\n        }\n      }\n      for (_j = 0, _len1 = files.length; _j < _len1; _j++) {\n        file = files[_j];\n        this.emit(\"sending\", file, xhr, formData);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"sendingmultiple\", files, xhr, formData);\n      }\n      if (this.element.tagName === \"FORM\") {\n        _ref2 = this.element.querySelectorAll(\"input, textarea, select, button\");\n        for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {\n          input = _ref2[_k];\n          inputName = input.getAttribute(\"name\");\n          inputType = input.getAttribute(\"type\");\n          if (input.tagName === \"SELECT\" && input.hasAttribute(\"multiple\")) {\n            _ref3 = input.options;\n            for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {\n              option = _ref3[_l];\n              if (option.selected) {\n                formData.append(inputName, option.value);\n              }\n            }\n          } else if (!inputType || ((_ref4 = inputType.toLowerCase()) !== \"checkbox\" && _ref4 !== \"radio\") || input.checked) {\n            formData.append(inputName, input.value);\n          }\n        }\n      }\n      for (i = _m = 0, _ref5 = files.length - 1; 0 <= _ref5 ? _m <= _ref5 : _m >= _ref5; i = 0 <= _ref5 ? ++_m : --_m) {\n        formData.append(this._getParamName(i), files[i], this._renameFilename(files[i].name));\n      }\n      return this.submitRequest(xhr, formData, files);\n    };\n\n    Dropzone.prototype.submitRequest = function(xhr, formData, files) {\n      return xhr.send(formData);\n    };\n\n    Dropzone.prototype._finished = function(files, responseText, e) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.status = Dropzone.SUCCESS;\n        this.emit(\"success\", file, responseText, e);\n        this.emit(\"complete\", file);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"successmultiple\", files, responseText, e);\n        this.emit(\"completemultiple\", files);\n      }\n      if (this.options.autoProcessQueue) {\n        return this.processQueue();\n      }\n    };\n\n    Dropzone.prototype._errorProcessing = function(files, message, xhr) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.status = Dropzone.ERROR;\n        this.emit(\"error\", file, message, xhr);\n        this.emit(\"complete\", file);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"errormultiple\", files, message, xhr);\n        this.emit(\"completemultiple\", files);\n      }\n      if (this.options.autoProcessQueue) {\n        return this.processQueue();\n      }\n    };\n\n    return Dropzone;\n\n  })(Emitter);\n\n  Dropzone.version = \"4.3.0\";\n\n  Dropzone.options = {};\n\n  Dropzone.optionsForElement = function(element) {\n    if (element.getAttribute(\"id\")) {\n      return Dropzone.options[camelize(element.getAttribute(\"id\"))];\n    } else {\n      return void 0;\n    }\n  };\n\n  Dropzone.instances = [];\n\n  Dropzone.forElement = function(element) {\n    if (typeof element === \"string\") {\n      element = document.querySelector(element);\n    }\n    if ((element != null ? element.dropzone : void 0) == null) {\n      throw new Error(\"No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.\");\n    }\n    return element.dropzone;\n  };\n\n  Dropzone.autoDiscover = true;\n\n  Dropzone.discover = function() {\n    var checkElements, dropzone, dropzones, _i, _len, _results;\n    if (document.querySelectorAll) {\n      dropzones = document.querySelectorAll(\".dropzone\");\n    } else {\n      dropzones = [];\n      checkElements = function(elements) {\n        var el, _i, _len, _results;\n        _results = [];\n        for (_i = 0, _len = elements.length; _i < _len; _i++) {\n          el = elements[_i];\n          if (/(^| )dropzone($| )/.test(el.className)) {\n            _results.push(dropzones.push(el));\n          } else {\n            _results.push(void 0);\n          }\n        }\n        return _results;\n      };\n      checkElements(document.getElementsByTagName(\"div\"));\n      checkElements(document.getElementsByTagName(\"form\"));\n    }\n    _results = [];\n    for (_i = 0, _len = dropzones.length; _i < _len; _i++) {\n      dropzone = dropzones[_i];\n      if (Dropzone.optionsForElement(dropzone) !== false) {\n        _results.push(new Dropzone(dropzone));\n      } else {\n        _results.push(void 0);\n      }\n    }\n    return _results;\n  };\n\n  Dropzone.blacklistedBrowsers = [/opera.*Macintosh.*version\\/12/i];\n\n  Dropzone.isBrowserSupported = function() {\n    var capableBrowser, regex, _i, _len, _ref;\n    capableBrowser = true;\n    if (window.File && window.FileReader && window.FileList && window.Blob && window.FormData && document.querySelector) {\n      if (!(\"classList\" in document.createElement(\"a\"))) {\n        capableBrowser = false;\n      } else {\n        _ref = Dropzone.blacklistedBrowsers;\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          regex = _ref[_i];\n          if (regex.test(navigator.userAgent)) {\n            capableBrowser = false;\n            continue;\n          }\n        }\n      }\n    } else {\n      capableBrowser = false;\n    }\n    return capableBrowser;\n  };\n\n  without = function(list, rejectedItem) {\n    var item, _i, _len, _results;\n    _results = [];\n    for (_i = 0, _len = list.length; _i < _len; _i++) {\n      item = list[_i];\n      if (item !== rejectedItem) {\n        _results.push(item);\n      }\n    }\n    return _results;\n  };\n\n  camelize = function(str) {\n    return str.replace(/[\\-_](\\w)/g, function(match) {\n      return match.charAt(1).toUpperCase();\n    });\n  };\n\n  Dropzone.createElement = function(string) {\n    var div;\n    div = document.createElement(\"div\");\n    div.innerHTML = string;\n    return div.childNodes[0];\n  };\n\n  Dropzone.elementInside = function(element, container) {\n    if (element === container) {\n      return true;\n    }\n    while (element = element.parentNode) {\n      if (element === container) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  Dropzone.getElement = function(el, name) {\n    var element;\n    if (typeof el === \"string\") {\n      element = document.querySelector(el);\n    } else if (el.nodeType != null) {\n      element = el;\n    }\n    if (element == null) {\n      throw new Error(\"Invalid `\" + name + \"` option provided. Please provide a CSS selector or a plain HTML element.\");\n    }\n    return element;\n  };\n\n  Dropzone.getElements = function(els, name) {\n    var e, el, elements, _i, _j, _len, _len1, _ref;\n    if (els instanceof Array) {\n      elements = [];\n      try {\n        for (_i = 0, _len = els.length; _i < _len; _i++) {\n          el = els[_i];\n          elements.push(this.getElement(el, name));\n        }\n      } catch (_error) {\n        e = _error;\n        elements = null;\n      }\n    } else if (typeof els === \"string\") {\n      elements = [];\n      _ref = document.querySelectorAll(els);\n      for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {\n        el = _ref[_j];\n        elements.push(el);\n      }\n    } else if (els.nodeType != null) {\n      elements = [els];\n    }\n    if (!((elements != null) && elements.length)) {\n      throw new Error(\"Invalid `\" + name + \"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.\");\n    }\n    return elements;\n  };\n\n  Dropzone.confirm = function(question, accepted, rejected) {\n    if (window.confirm(question)) {\n      return accepted();\n    } else if (rejected != null) {\n      return rejected();\n    }\n  };\n\n  Dropzone.isValidFile = function(file, acceptedFiles) {\n    var baseMimeType, mimeType, validType, _i, _len;\n    if (!acceptedFiles) {\n      return true;\n    }\n    acceptedFiles = acceptedFiles.split(\",\");\n    mimeType = file.type;\n    baseMimeType = mimeType.replace(/\\/.*$/, \"\");\n    for (_i = 0, _len = acceptedFiles.length; _i < _len; _i++) {\n      validType = acceptedFiles[_i];\n      validType = validType.trim();\n      if (validType.charAt(0) === \".\") {\n        if (file.name.toLowerCase().indexOf(validType.toLowerCase(), file.name.length - validType.length) !== -1) {\n          return true;\n        }\n      } else if (/\\/\\*$/.test(validType)) {\n        if (baseMimeType === validType.replace(/\\/.*$/, \"\")) {\n          return true;\n        }\n      } else {\n        if (mimeType === validType) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n\n  if (typeof jQuery !== \"undefined\" && jQuery !== null) {\n    jQuery.fn.dropzone = function(options) {\n      return this.each(function() {\n        return new Dropzone(this, options);\n      });\n    };\n  }\n\n  if (typeof module !== \"undefined\" && module !== null) {\n    module.exports = Dropzone;\n  } else {\n    window.Dropzone = Dropzone;\n  }\n\n  Dropzone.ADDED = \"added\";\n\n  Dropzone.QUEUED = \"queued\";\n\n  Dropzone.ACCEPTED = Dropzone.QUEUED;\n\n  Dropzone.UPLOADING = \"uploading\";\n\n  Dropzone.PROCESSING = Dropzone.UPLOADING;\n\n  Dropzone.CANCELED = \"canceled\";\n\n  Dropzone.ERROR = \"error\";\n\n  Dropzone.SUCCESS = \"success\";\n\n\n  /*\n  \n  Bugfix for iOS 6 and 7\n  Source: http://stackoverflow.com/questions/11929099/html5-canvas-drawimage-ratio-bug-ios\n  based on the work of https://github.com/stomita/ios-imagefile-megapixel\n   */\n\n  detectVerticalSquash = function(img) {\n    var alpha, canvas, ctx, data, ey, ih, iw, py, ratio, sy;\n    iw = img.naturalWidth;\n    ih = img.naturalHeight;\n    canvas = document.createElement(\"canvas\");\n    canvas.width = 1;\n    canvas.height = ih;\n    ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(img, 0, 0);\n    data = ctx.getImageData(0, 0, 1, ih).data;\n    sy = 0;\n    ey = ih;\n    py = ih;\n    while (py > sy) {\n      alpha = data[(py - 1) * 4 + 3];\n      if (alpha === 0) {\n        ey = py;\n      } else {\n        sy = py;\n      }\n      py = (ey + sy) >> 1;\n    }\n    ratio = py / ih;\n    if (ratio === 0) {\n      return 1;\n    } else {\n      return ratio;\n    }\n  };\n\n  drawImageIOSFix = function(ctx, img, sx, sy, sw, sh, dx, dy, dw, dh) {\n    var vertSquashRatio;\n    vertSquashRatio = detectVerticalSquash(img);\n    return ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh / vertSquashRatio);\n  };\n\n\n  /*\n   * contentloaded.js\n   *\n   * Author: Diego Perini (diego.perini at gmail.com)\n   * Summary: cross-browser wrapper for DOMContentLoaded\n   * Updated: 20101020\n   * License: MIT\n   * Version: 1.2\n   *\n   * URL:\n   * http://javascript.nwbox.com/ContentLoaded/\n   * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE\n   */\n\n  contentLoaded = function(win, fn) {\n    var add, doc, done, init, poll, pre, rem, root, top;\n    done = false;\n    top = true;\n    doc = win.document;\n    root = doc.documentElement;\n    add = (doc.addEventListener ? \"addEventListener\" : \"attachEvent\");\n    rem = (doc.addEventListener ? \"removeEventListener\" : \"detachEvent\");\n    pre = (doc.addEventListener ? \"\" : \"on\");\n    init = function(e) {\n      if (e.type === \"readystatechange\" && doc.readyState !== \"complete\") {\n        return;\n      }\n      (e.type === \"load\" ? win : doc)[rem](pre + e.type, init, false);\n      if (!done && (done = true)) {\n        return fn.call(win, e.type || e);\n      }\n    };\n    poll = function() {\n      var e;\n      try {\n        root.doScroll(\"left\");\n      } catch (_error) {\n        e = _error;\n        setTimeout(poll, 50);\n        return;\n      }\n      return init(\"poll\");\n    };\n    if (doc.readyState !== \"complete\") {\n      if (doc.createEventObject && root.doScroll) {\n        try {\n          top = !win.frameElement;\n        } catch (_error) {}\n        if (top) {\n          poll();\n        }\n      }\n      doc[add](pre + \"DOMContentLoaded\", init, false);\n      doc[add](pre + \"readystatechange\", init, false);\n      return win[add](pre + \"load\", init, false);\n    }\n  };\n\n  Dropzone._autoDiscoverFunction = function() {\n    if (Dropzone.autoDiscover) {\n      return Dropzone.discover();\n    }\n  };\n\n  contentLoaded(window, Dropzone._autoDiscoverFunction);\n\n}).call(this);","output":"str","x":600,"y":600,"wires":[["aa50b392.77996"]]},{"id":"12a37d17.ee01e3","type":"template","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"html","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<script>\n    {{{dropzonejs}}}\n</script>\n<style>\n    {{{css}}}\n</style>\n\n<script>\n    // \"myAwesomeDropzone\" is the camelized version of the HTML element's ID\n    Dropzone.options.myDropzone = {\n      paramName: \"myFile\", // The name that will be used to transfer the file\n      maxFilesize: 2, // MB\n      accept: function(file, done) {\n        if (file.name == \"justinbieber.jpg\") {\n          done(\"Naha, you don't.\");\n        }\n        else { done(); }\n      }\n    };\n</script>\n\n<form action=\"/csr_input\" class=\"dropzone\" method=\"post\" enctype=\"multipart/form-data\" id=\"my-dropzone\">\n  <div class=\"fallback\">\n    <input name=\"myFile\" type=\"file\" />\n    <input type=\"submit\" value=\"Submit\">\n  </div>\n</form>","output":"str","x":920,"y":600,"wires":[["8c30ff1b.6e51"]]},{"id":"aa50b392.77996","type":"template","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","field":"css","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"/*\n * The MIT License\n * Copyright (c) 2012 Matias Meno <m@tias.me>\n */\n@-webkit-keyframes passing-through {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30%, 70% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); }\n  100% {\n    opacity: 0;\n    -webkit-transform: translateY(-40px);\n    -moz-transform: translateY(-40px);\n    -ms-transform: translateY(-40px);\n    -o-transform: translateY(-40px);\n    transform: translateY(-40px); } }\n@-moz-keyframes passing-through {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30%, 70% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); }\n  100% {\n    opacity: 0;\n    -webkit-transform: translateY(-40px);\n    -moz-transform: translateY(-40px);\n    -ms-transform: translateY(-40px);\n    -o-transform: translateY(-40px);\n    transform: translateY(-40px); } }\n@keyframes passing-through {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30%, 70% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); }\n  100% {\n    opacity: 0;\n    -webkit-transform: translateY(-40px);\n    -moz-transform: translateY(-40px);\n    -ms-transform: translateY(-40px);\n    -o-transform: translateY(-40px);\n    transform: translateY(-40px); } }\n@-webkit-keyframes slide-in {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); } }\n@-moz-keyframes slide-in {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); } }\n@keyframes slide-in {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); } }\n@-webkit-keyframes pulse {\n  0% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); }\n  10% {\n    -webkit-transform: scale(1.1);\n    -moz-transform: scale(1.1);\n    -ms-transform: scale(1.1);\n    -o-transform: scale(1.1);\n    transform: scale(1.1); }\n  20% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); } }\n@-moz-keyframes pulse {\n  0% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); }\n  10% {\n    -webkit-transform: scale(1.1);\n    -moz-transform: scale(1.1);\n    -ms-transform: scale(1.1);\n    -o-transform: scale(1.1);\n    transform: scale(1.1); }\n  20% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); } }\n@keyframes pulse {\n  0% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); }\n  10% {\n    -webkit-transform: scale(1.1);\n    -moz-transform: scale(1.1);\n    -ms-transform: scale(1.1);\n    -o-transform: scale(1.1);\n    transform: scale(1.1); }\n  20% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); } }\n.dropzone, .dropzone * {\n  box-sizing: border-box; }\n\n.dropzone {\n  min-height: 150px;\n  border: 2px solid rgba(0, 0, 0, 0.3);\n  background: white;\n  padding: 20px 20px; }\n  .dropzone.dz-clickable {\n    cursor: pointer; }\n    .dropzone.dz-clickable * {\n      cursor: default; }\n    .dropzone.dz-clickable .dz-message, .dropzone.dz-clickable .dz-message * {\n      cursor: pointer; }\n  .dropzone.dz-started .dz-message {\n    display: none; }\n  .dropzone.dz-drag-hover {\n    border-style: solid; }\n    .dropzone.dz-drag-hover .dz-message {\n      opacity: 0.5; }\n  .dropzone .dz-message {\n    text-align: center;\n    margin: 2em 0; }\n  .dropzone .dz-preview {\n    position: relative;\n    display: inline-block;\n    vertical-align: top;\n    margin: 16px;\n    min-height: 100px; }\n    .dropzone .dz-preview:hover {\n      z-index: 1000; }\n      .dropzone .dz-preview:hover .dz-details {\n        opacity: 1; }\n    .dropzone .dz-preview.dz-file-preview .dz-image {\n      border-radius: 20px;\n      background: #999;\n      background: linear-gradient(to bottom, #eee, #ddd); }\n    .dropzone .dz-preview.dz-file-preview .dz-details {\n      opacity: 1; }\n    .dropzone .dz-preview.dz-image-preview {\n      background: white; }\n      .dropzone .dz-preview.dz-image-preview .dz-details {\n        -webkit-transition: opacity 0.2s linear;\n        -moz-transition: opacity 0.2s linear;\n        -ms-transition: opacity 0.2s linear;\n        -o-transition: opacity 0.2s linear;\n        transition: opacity 0.2s linear; }\n    .dropzone .dz-preview .dz-remove {\n      font-size: 14px;\n      text-align: center;\n      display: block;\n      cursor: pointer;\n      border: none; }\n      .dropzone .dz-preview .dz-remove:hover {\n        text-decoration: underline; }\n    .dropzone .dz-preview:hover .dz-details {\n      opacity: 1; }\n    .dropzone .dz-preview .dz-details {\n      z-index: 20;\n      position: absolute;\n      top: 0;\n      left: 0;\n      opacity: 0;\n      font-size: 13px;\n      min-width: 100%;\n      max-width: 100%;\n      padding: 2em 1em;\n      text-align: center;\n      color: rgba(0, 0, 0, 0.9);\n      line-height: 150%; }\n      .dropzone .dz-preview .dz-details .dz-size {\n        margin-bottom: 1em;\n        font-size: 16px; }\n      .dropzone .dz-preview .dz-details .dz-filename {\n        white-space: nowrap; }\n        .dropzone .dz-preview .dz-details .dz-filename:hover span {\n          border: 1px solid rgba(200, 200, 200, 0.8);\n          background-color: rgba(255, 255, 255, 0.8); }\n        .dropzone .dz-preview .dz-details .dz-filename:not(:hover) {\n          overflow: hidden;\n          text-overflow: ellipsis; }\n          .dropzone .dz-preview .dz-details .dz-filename:not(:hover) span {\n            border: 1px solid transparent; }\n      .dropzone .dz-preview .dz-details .dz-filename span, .dropzone .dz-preview .dz-details .dz-size span {\n        background-color: rgba(255, 255, 255, 0.4);\n        padding: 0 0.4em;\n        border-radius: 3px; }\n    .dropzone .dz-preview:hover .dz-image img {\n      -webkit-transform: scale(1.05, 1.05);\n      -moz-transform: scale(1.05, 1.05);\n      -ms-transform: scale(1.05, 1.05);\n      -o-transform: scale(1.05, 1.05);\n      transform: scale(1.05, 1.05);\n      -webkit-filter: blur(8px);\n      filter: blur(8px); }\n    .dropzone .dz-preview .dz-image {\n      border-radius: 20px;\n      overflow: hidden;\n      width: 120px;\n      height: 120px;\n      position: relative;\n      display: block;\n      z-index: 10; }\n      .dropzone .dz-preview .dz-image img {\n        display: block; }\n    .dropzone .dz-preview.dz-success .dz-success-mark {\n      -webkit-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -moz-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -ms-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -o-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1); }\n    .dropzone .dz-preview.dz-error .dz-error-mark {\n      opacity: 1;\n      -webkit-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -moz-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -ms-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -o-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1); }\n    .dropzone .dz-preview .dz-success-mark, .dropzone .dz-preview .dz-error-mark {\n      pointer-events: none;\n      opacity: 0;\n      z-index: 500;\n      position: absolute;\n      display: block;\n      top: 50%;\n      left: 50%;\n      margin-left: -27px;\n      margin-top: -27px; }\n      .dropzone .dz-preview .dz-success-mark svg, .dropzone .dz-preview .dz-error-mark svg {\n        display: block;\n        width: 54px;\n        height: 54px; }\n    .dropzone .dz-preview.dz-processing .dz-progress {\n      opacity: 1;\n      -webkit-transition: all 0.2s linear;\n      -moz-transition: all 0.2s linear;\n      -ms-transition: all 0.2s linear;\n      -o-transition: all 0.2s linear;\n      transition: all 0.2s linear; }\n    .dropzone .dz-preview.dz-complete .dz-progress {\n      opacity: 0;\n      -webkit-transition: opacity 0.4s ease-in;\n      -moz-transition: opacity 0.4s ease-in;\n      -ms-transition: opacity 0.4s ease-in;\n      -o-transition: opacity 0.4s ease-in;\n      transition: opacity 0.4s ease-in; }\n    .dropzone .dz-preview:not(.dz-processing) .dz-progress {\n      -webkit-animation: pulse 6s ease infinite;\n      -moz-animation: pulse 6s ease infinite;\n      -ms-animation: pulse 6s ease infinite;\n      -o-animation: pulse 6s ease infinite;\n      animation: pulse 6s ease infinite; }\n    .dropzone .dz-preview .dz-progress {\n      opacity: 1;\n      z-index: 1000;\n      pointer-events: none;\n      position: absolute;\n      height: 16px;\n      left: 50%;\n      top: 50%;\n      margin-top: -8px;\n      width: 80px;\n      margin-left: -40px;\n      background: rgba(255, 255, 255, 0.9);\n      -webkit-transform: scale(1);\n      border-radius: 8px;\n      overflow: hidden; }\n      .dropzone .dz-preview .dz-progress .dz-upload {\n        background: #333;\n        background: linear-gradient(to bottom, #666, #444);\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        width: 0;\n        -webkit-transition: width 300ms ease-in-out;\n        -moz-transition: width 300ms ease-in-out;\n        -ms-transition: width 300ms ease-in-out;\n        -o-transition: width 300ms ease-in-out;\n        transition: width 300ms ease-in-out; }\n    .dropzone .dz-preview.dz-error .dz-error-message {\n      display: block; }\n    .dropzone .dz-preview.dz-error:hover .dz-error-message {\n      opacity: 1;\n      pointer-events: auto; }\n    .dropzone .dz-preview .dz-error-message {\n      pointer-events: none;\n      z-index: 1000;\n      position: absolute;\n      display: block;\n      display: none;\n      opacity: 0;\n      -webkit-transition: opacity 0.3s ease;\n      -moz-transition: opacity 0.3s ease;\n      -ms-transition: opacity 0.3s ease;\n      -o-transition: opacity 0.3s ease;\n      transition: opacity 0.3s ease;\n      border-radius: 8px;\n      font-size: 13px;\n      top: 130px;\n      left: -10px;\n      width: 140px;\n      background: #be2626;\n      background: linear-gradient(to bottom, #be2626, #a92222);\n      padding: 0.5em 1.2em;\n      color: white; }\n      .dropzone .dz-preview .dz-error-message:after {\n        content: '';\n        position: absolute;\n        top: -6px;\n        left: 64px;\n        width: 0;\n        height: 0;\n        border-left: 6px solid transparent;\n        border-right: 6px solid transparent;\n        border-bottom: 6px solid #be2626; }","output":"str","x":770,"y":600,"wires":[["12a37d17.ee01e3"]]},{"id":"6a8cf616.b536a8","type":"change","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","rules":[{"t":"set","p":"passphrase","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":940,"wires":[[]]},{"id":"79d9b8de.f74c18","type":"link in","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"Clear","links":["80759e9.8c981e","ae89d30.f9b593"],"x":155,"y":940,"wires":[["2abddc74.a67834"]]},{"id":"2abddc74.a67834","type":"change","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":940,"wires":[["f8121681.caf688"]]},{"id":"9ba22a05.d8c828","type":"function","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"Request {csr,passphrase,days,type}","func":"msg.payload = {\n    csr: msg.payload,\n    passphrase: flow.get(\"passphrase\") || null,\n    days: flow.get(\"days\") || 365,\n    type: flow.get(\"type\") || \"server\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":870,"y":700,"wires":[[]]},{"id":"1d7dce1f.16fff2","type":"http in","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","url":"/csr_input","method":"post","upload":true,"swaggerDoc":"","x":180,"y":660,"wires":[["3e677556.7fde7a","a5c37159.7611a"]]},{"id":"3e677556.7fde7a","type":"function","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"Validate file","func":"if( !msg.req.files || msg.req.files.length === 0 ) {\n    msg.payload = \"Invalid file 1\";\n    return msg;\n}\n\nmsg.payload = msg.req.files[0].buffer.toString();\nif( msg.payload.length < 500 || msg.payload.length > 4000 ){\n    msg.payload = \"Invalid file 2\";\n    return msg;\n}\n\nif( msg.payload.search('-----BEGIN CERTIFICATE REQUEST-----') < 0 )  {\n    msg.payload = 'Invalid CSR';\n    return msg;\n}\n\nif( msg.payload.search('-----END CERTIFICATE REQUEST-----') < 0 )  {\n    msg.payload = 'Invalid CSR';\n    return msg;\n}\nmsg.topic = \"csr\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":700,"wires":[["7dde5a39.88bb24"]]},{"id":"3729ea29.2f57d6","type":"http response","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"OK","statusCode":"200","headers":{},"x":630,"y":660,"wires":[]},{"id":"a5c37159.7611a","type":"change","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"OK","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":660,"wires":[["3729ea29.2f57d6"]]},{"id":"ae89d30.f9b593","type":"link out","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","links":["79d9b8de.f74c18","f96da6ec.2c2e78"],"x":1215,"y":740,"wires":[]},{"id":"8597b255.f27ba","type":"change","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"csr","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":780,"wires":[["7dde5a39.88bb24"]]},{"id":"f96da6ec.2c2e78","type":"link in","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","links":["ae89d30.f9b593"],"x":275,"y":780,"wires":[["8597b255.f27ba"]]},{"id":"b0a17bd7.9a86c8","type":"change","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","rules":[{"t":"set","p":"type","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":820,"wires":[[]]},{"id":"dcfef388.de43d","type":"change","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","rules":[{"t":"set","p":"days","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":860,"wires":[[]]},{"id":"b691dfe3.c35ab","type":"http in","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"","url":"/inspect","method":"post","upload":true,"swaggerDoc":"","x":170,"y":1060,"wires":[["561af0f2.f3132"]]},{"id":"8bfc3e38.6e874","type":"function","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"Check Input","func":"if( msg.payload.search('-----BEGIN CERTIFICATE-----') < 0 )  {\n    msg.statusCode = 400;\n    msg.payload = \"Invalid certificate\";\n    node.send([msg,null]);\n    return;\n}\n\nif( msg.payload.search('-----END CERTIFICATE-----') < 0 )  {\n    msg.statusCode = 400;\n    msg.payload = \"Invalid certificate\";\n    node.send([msg,null]);\n    return;\n}\n\nmsg.uid = new Date().getTime();\nmsg.filename = '/data/files/' + msg.uid + \".crt\"\nnode.send([null,msg]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":550,"y":1060,"wires":[["aaa05f2f.f0a07"],["57a6bcee.9df424"]]},{"id":"aaa05f2f.f0a07","type":"http response","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"Response error","statusCode":"","headers":{},"x":820,"y":1060,"wires":[]},{"id":"57a6bcee.9df424","type":"file","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"Temporary xxxxx.crt","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":370,"y":1160,"wires":[["8f88f2e5.8d567"]]},{"id":"8f88f2e5.8d567","type":"function","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"Open CRT","func":"msg.payload = \"x509 -in \" + msg.filename + \" -text\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":1160,"wires":[["b56d1a7.e6905e8"]]},{"id":"b56d1a7.e6905e8","type":"exec","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","command":"openssl","addpay":true,"append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"","x":740,"y":1160,"wires":[["dd296cb4.10f1c"],[],["a7cd82e3.bcdc7"]]},{"id":"dd296cb4.10f1c","type":"function","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"OK","func":"if(msg.payload.length > 50 ) \n    return msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1160,"wires":[["ab277c1c.9e819","84190c5c.5c9fc"]]},{"id":"a7cd82e3.bcdc7","type":"function","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"Error","func":"if(msg.payload.code !== 0) {\n    msg.statusCode = 400;\n    msg.payload = '{\"error\":\"Unable to parse CRT\"}';\n    return msg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":1240,"wires":[["2ce78f1.528977"]]},{"id":"2ce78f1.528977","type":"http response","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"Response error","statusCode":"","headers":{},"x":1080,"y":1240,"wires":[]},{"id":"ab277c1c.9e819","type":"http response","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"Response","statusCode":"","headers":{},"x":1070,"y":1160,"wires":[]},{"id":"561af0f2.f3132","type":"function","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"Convert if file","func":"if( msg.req.files && msg.req.files.length > 0 )\n    msg.payload = msg.req.files[0].buffer.toString();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":1060,"wires":[["8bfc3e38.6e874"]]},{"id":"e4f6fb9.8ba4908","type":"http in","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"","url":"/dropzone/inspect","method":"get","upload":false,"swaggerDoc":"","x":420,"y":1300,"wires":[["bac27a3d.beddf8"]]},{"id":"e613ab7c.a61c88","type":"http response","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"","x":1030,"y":1300,"wires":[]},{"id":"bac27a3d.beddf8","type":"template","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"dropzone.js","field":"dropzonejs","fieldType":"msg","format":"javascript","syntax":"mustache","template":"\n/*\n *\n * More info at [www.dropzonejs.com](http://www.dropzonejs.com)\n *\n * Copyright (c) 2012, Matias Meno\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n\n(function() {\n  var Dropzone, Emitter, camelize, contentLoaded, detectVerticalSquash, drawImageIOSFix, noop, without,\n    __slice = [].slice,\n    __hasProp = {}.hasOwnProperty,\n    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\n  noop = function() {};\n\n  Emitter = (function() {\n    function Emitter() {}\n\n    Emitter.prototype.addEventListener = Emitter.prototype.on;\n\n    Emitter.prototype.on = function(event, fn) {\n      this._callbacks = this._callbacks || {};\n      if (!this._callbacks[event]) {\n        this._callbacks[event] = [];\n      }\n      this._callbacks[event].push(fn);\n      return this;\n    };\n\n    Emitter.prototype.emit = function() {\n      var args, callback, callbacks, event, _i, _len;\n      event = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      this._callbacks = this._callbacks || {};\n      callbacks = this._callbacks[event];\n      if (callbacks) {\n        for (_i = 0, _len = callbacks.length; _i < _len; _i++) {\n          callback = callbacks[_i];\n          callback.apply(this, args);\n        }\n      }\n      return this;\n    };\n\n    Emitter.prototype.removeListener = Emitter.prototype.off;\n\n    Emitter.prototype.removeAllListeners = Emitter.prototype.off;\n\n    Emitter.prototype.removeEventListener = Emitter.prototype.off;\n\n    Emitter.prototype.off = function(event, fn) {\n      var callback, callbacks, i, _i, _len;\n      if (!this._callbacks || arguments.length === 0) {\n        this._callbacks = {};\n        return this;\n      }\n      callbacks = this._callbacks[event];\n      if (!callbacks) {\n        return this;\n      }\n      if (arguments.length === 1) {\n        delete this._callbacks[event];\n        return this;\n      }\n      for (i = _i = 0, _len = callbacks.length; _i < _len; i = ++_i) {\n        callback = callbacks[i];\n        if (callback === fn) {\n          callbacks.splice(i, 1);\n          break;\n        }\n      }\n      return this;\n    };\n\n    return Emitter;\n\n  })();\n\n  Dropzone = (function(_super) {\n    var extend, resolveOption;\n\n    __extends(Dropzone, _super);\n\n    Dropzone.prototype.Emitter = Emitter;\n\n\n    /*\n    This is a list of all available events you can register on a dropzone object.\n    \n    You can register an event handler like this:\n    \n        dropzone.on(\"dragEnter\", function() { });\n     */\n\n    Dropzone.prototype.events = [\"drop\", \"dragstart\", \"dragend\", \"dragenter\", \"dragover\", \"dragleave\", \"addedfile\", \"addedfiles\", \"removedfile\", \"thumbnail\", \"error\", \"errormultiple\", \"processing\", \"processingmultiple\", \"uploadprogress\", \"totaluploadprogress\", \"sending\", \"sendingmultiple\", \"success\", \"successmultiple\", \"canceled\", \"canceledmultiple\", \"complete\", \"completemultiple\", \"reset\", \"maxfilesexceeded\", \"maxfilesreached\", \"queuecomplete\"];\n\n    Dropzone.prototype.defaultOptions = {\n      url: null,\n      method: \"post\",\n      withCredentials: false,\n      parallelUploads: 2,\n      uploadMultiple: false,\n      maxFilesize: 256,\n      paramName: \"file\",\n      createImageThumbnails: true,\n      maxThumbnailFilesize: 10,\n      thumbnailWidth: 120,\n      thumbnailHeight: 120,\n      filesizeBase: 1000,\n      maxFiles: null,\n      params: {},\n      clickable: true,\n      ignoreHiddenFiles: true,\n      acceptedFiles: null,\n      acceptedMimeTypes: null,\n      autoProcessQueue: true,\n      autoQueue: true,\n      addRemoveLinks: false,\n      previewsContainer: null,\n      hiddenInputContainer: \"body\",\n      capture: null,\n      renameFilename: null,\n      dictDefaultMessage: \"Drop files here\",\n      dictFallbackMessage: \"Your browser does not support drag'n'drop file uploads.\",\n      dictFallbackText: \"Please use the fallback form below to upload your files like in the olden days.\",\n      dictFileTooBig: \"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.\",\n      dictInvalidFileType: \"You can't upload files of this type.\",\n      dictResponseError: \"Server responded with {{statusCode}} code.\",\n      dictCancelUpload: \"Cancel upload\",\n      dictCancelUploadConfirmation: \"Are you sure you want to cancel this upload?\",\n      dictRemoveFile: \"Remove file\",\n      dictRemoveFileConfirmation: null,\n      dictMaxFilesExceeded: \"You can not upload any more files.\",\n      accept: function(file, done) {\n        return done();\n      },\n      init: function() {\n        return noop;\n      },\n      forceFallback: false,\n      fallback: function() {\n        var child, messageElement, span, _i, _len, _ref;\n        this.element.className = \"\" + this.element.className + \" dz-browser-not-supported\";\n        _ref = this.element.getElementsByTagName(\"div\");\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          child = _ref[_i];\n          if (/(^| )dz-message($| )/.test(child.className)) {\n            messageElement = child;\n            child.className = \"dz-message\";\n            continue;\n          }\n        }\n        if (!messageElement) {\n          messageElement = Dropzone.createElement(\"<div class=\\\"dz-message\\\"><span></span></div>\");\n          this.element.appendChild(messageElement);\n        }\n        span = messageElement.getElementsByTagName(\"span\")[0];\n        if (span) {\n          if (span.textContent !== null) {\n            span.textContent = this.options.dictFallbackMessage;\n          } else if (span.innerText !== null) {\n            span.innerText = this.options.dictFallbackMessage;\n          }\n        }\n        return this.element.appendChild(this.getFallbackForm());\n      },\n      resize: function(file) {\n        var info, srcRatio, trgRatio;\n        info = {\n          srcX: 0,\n          srcY: 0,\n          srcWidth: file.width,\n          srcHeight: file.height\n        };\n        srcRatio = file.width / file.height;\n        info.optWidth = this.options.thumbnailWidth;\n        info.optHeight = this.options.thumbnailHeight;\n        if ((info.optWidth === null) && (info.optHeight === null)) {\n          info.optWidth = info.srcWidth;\n          info.optHeight = info.srcHeight;\n        } else if (info.optWidth === null) {\n          info.optWidth = srcRatio * info.optHeight;\n        } else if (info.optHeight === null) {\n          info.optHeight = (1 / srcRatio) * info.optWidth;\n        }\n        trgRatio = info.optWidth / info.optHeight;\n        if (file.height < info.optHeight || file.width < info.optWidth) {\n          info.trgHeight = info.srcHeight;\n          info.trgWidth = info.srcWidth;\n        } else {\n          if (srcRatio > trgRatio) {\n            info.srcHeight = file.height;\n            info.srcWidth = info.srcHeight * trgRatio;\n          } else {\n            info.srcWidth = file.width;\n            info.srcHeight = info.srcWidth / trgRatio;\n          }\n        }\n        info.srcX = (file.width - info.srcWidth) / 2;\n        info.srcY = (file.height - info.srcHeight) / 2;\n        return info;\n      },\n\n      /*\n      Those functions register themselves to the events on init and handle all\n      the user interface specific stuff. Overwriting them won't break the upload\n      but can break the way it's displayed.\n      You can overwrite them if you don't like the default behavior. If you just\n      want to add an additional event handler, register it on the dropzone object\n      and don't overwrite those options.\n       */\n      drop: function(e) {\n        return this.element.classList.remove(\"dz-drag-hover\");\n      },\n      dragstart: noop,\n      dragend: function(e) {\n        return this.element.classList.remove(\"dz-drag-hover\");\n      },\n      dragenter: function(e) {\n        return this.element.classList.add(\"dz-drag-hover\");\n      },\n      dragover: function(e) {\n        return this.element.classList.add(\"dz-drag-hover\");\n      },\n      dragleave: function(e) {\n        return this.element.classList.remove(\"dz-drag-hover\");\n      },\n      paste: noop,\n      reset: function() {\n        return this.element.classList.remove(\"dz-started\");\n      },\n      addedfile: function(file) {\n        var node, removeFileEvent, removeLink, _i, _j, _k, _len, _len1, _len2, _ref, _ref1, _ref2, _results;\n        if (this.element === this.previewsContainer) {\n          this.element.classList.add(\"dz-started\");\n        }\n        if (this.previewsContainer) {\n          file.previewElement = Dropzone.createElement(this.options.previewTemplate.trim());\n          file.previewTemplate = file.previewElement;\n          this.previewsContainer.appendChild(file.previewElement);\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-name]\");\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            node = _ref[_i];\n            node.textContent = this._renameFilename(file.name);\n          }\n          _ref1 = file.previewElement.querySelectorAll(\"[data-dz-size]\");\n          for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {\n            node = _ref1[_j];\n            node.innerHTML = this.filesize(file.size);\n          }\n          if (this.options.addRemoveLinks) {\n            file._removeLink = Dropzone.createElement(\"<a class=\\\"dz-remove\\\" href=\\\"javascript:undefined;\\\" data-dz-remove>\" + this.options.dictRemoveFile + \"</a>\");\n            file.previewElement.appendChild(file._removeLink);\n          }\n          removeFileEvent = (function(_this) {\n            return function(e) {\n              e.preventDefault();\n              e.stopPropagation();\n              if (file.status === Dropzone.UPLOADING) {\n                return Dropzone.confirm(_this.options.dictCancelUploadConfirmation, function() {\n                  return _this.removeFile(file);\n                });\n              } else {\n                if (_this.options.dictRemoveFileConfirmation) {\n                  return Dropzone.confirm(_this.options.dictRemoveFileConfirmation, function() {\n                    return _this.removeFile(file);\n                  });\n                } else {\n                  return _this.removeFile(file);\n                }\n              }\n            };\n          })(this);\n          _ref2 = file.previewElement.querySelectorAll(\"[data-dz-remove]\");\n          _results = [];\n          for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {\n            removeLink = _ref2[_k];\n            _results.push(removeLink.addEventListener(\"click\", removeFileEvent));\n          }\n          return _results;\n        }\n      },\n      removedfile: function(file) {\n        var _ref;\n        if (file.previewElement) {\n          if ((_ref = file.previewElement) != null) {\n            _ref.parentNode.removeChild(file.previewElement);\n          }\n        }\n        return this._updateMaxFilesReachedClass();\n      },\n      thumbnail: function(file, dataUrl) {\n        var thumbnailElement, _i, _len, _ref;\n        if (file.previewElement) {\n          file.previewElement.classList.remove(\"dz-file-preview\");\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-thumbnail]\");\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            thumbnailElement = _ref[_i];\n            thumbnailElement.alt = file.name;\n            thumbnailElement.src = dataUrl;\n          }\n          return setTimeout(((function(_this) {\n            return function() {\n              return file.previewElement.classList.add(\"dz-image-preview\");\n            };\n          })(this)), 1);\n        }\n      },\n      error: function(file, message) {\n        var node, _i, _len, _ref, _results;\n        if (file.previewElement) {\n          file.previewElement.classList.add(\"dz-error\");\n          if (typeof message !== \"String\" && message.error) {\n            message = message.error;\n          }\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-errormessage]\");\n          _results = [];\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            node = _ref[_i];\n            _results.push(node.textContent = message);\n          }\n          return _results;\n        }\n      },\n      errormultiple: noop,\n      processing: function(file) {\n        if (file.previewElement) {\n          file.previewElement.classList.add(\"dz-processing\");\n          if (file._removeLink) {\n            return file._removeLink.textContent = this.options.dictCancelUpload;\n          }\n        }\n      },\n      processingmultiple: noop,\n      uploadprogress: function(file, progress, bytesSent) {\n        var node, _i, _len, _ref, _results;\n        if (file.previewElement) {\n          _ref = file.previewElement.querySelectorAll(\"[data-dz-uploadprogress]\");\n          _results = [];\n          for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n            node = _ref[_i];\n            if (node.nodeName === 'PROGRESS') {\n              _results.push(node.value = progress);\n            } else {\n              _results.push(node.style.width = \"\" + progress + \"%\");\n            }\n          }\n          return _results;\n        }\n      },\n      totaluploadprogress: noop,\n      sending: noop,\n      sendingmultiple: noop,\n      success: function(file) {\n        if (file.previewElement) {\n          return file.previewElement.classList.add(\"dz-success\");\n        }\n      },\n      successmultiple: noop,\n      canceled: function(file) {\n        return this.emit(\"error\", file, \"Upload canceled.\");\n      },\n      canceledmultiple: noop,\n      complete: function(file) {\n        if (file._removeLink) {\n          file._removeLink.textContent = this.options.dictRemoveFile;\n        }\n        if (file.previewElement) {\n          return file.previewElement.classList.add(\"dz-complete\");\n        }\n      },\n      completemultiple: noop,\n      maxfilesexceeded: noop,\n      maxfilesreached: noop,\n      queuecomplete: noop,\n      addedfiles: noop,\n      previewTemplate: \"<div class=\\\"dz-preview dz-file-preview\\\">\\n  <div class=\\\"dz-image\\\"><img data-dz-thumbnail /></div>\\n  <div class=\\\"dz-details\\\">\\n    <div class=\\\"dz-size\\\"><span data-dz-size></span></div>\\n    <div class=\\\"dz-filename\\\"><span data-dz-name></span></div>\\n  </div>\\n  <div class=\\\"dz-progress\\\"><span class=\\\"dz-upload\\\" data-dz-uploadprogress></span></div>\\n  <div class=\\\"dz-error-message\\\"><span data-dz-errormessage></span></div>\\n  <div class=\\\"dz-success-mark\\\">\\n    <svg width=\\\"54px\\\" height=\\\"54px\\\" viewBox=\\\"0 0 54 54\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xmlns:sketch=\\\"http://www.bohemiancoding.com/sketch/ns\\\">\\n      <title>Check</title>\\n      <defs></defs>\\n      <g id=\\\"Page-1\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" sketch:type=\\\"MSPage\\\">\\n        <path d=\\\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\\\" id=\\\"Oval-2\\\" stroke-opacity=\\\"0.198794158\\\" stroke=\\\"#747474\\\" fill-opacity=\\\"0.816519475\\\" fill=\\\"#FFFFFF\\\" sketch:type=\\\"MSShapeGroup\\\"></path>\\n      </g>\\n    </svg>\\n  </div>\\n  <div class=\\\"dz-error-mark\\\">\\n    <svg width=\\\"54px\\\" height=\\\"54px\\\" viewBox=\\\"0 0 54 54\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xmlns:sketch=\\\"http://www.bohemiancoding.com/sketch/ns\\\">\\n      <title>Error</title>\\n      <defs></defs>\\n      <g id=\\\"Page-1\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" sketch:type=\\\"MSPage\\\">\\n        <g id=\\\"Check-+-Oval-2\\\" sketch:type=\\\"MSLayerGroup\\\" stroke=\\\"#747474\\\" stroke-opacity=\\\"0.198794158\\\" fill=\\\"#FFFFFF\\\" fill-opacity=\\\"0.816519475\\\">\\n          <path d=\\\"M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\\\" id=\\\"Oval-2\\\" sketch:type=\\\"MSShapeGroup\\\"></path>\\n        </g>\\n      </g>\\n    </svg>\\n  </div>\\n</div>\"\n    };\n\n    extend = function() {\n      var key, object, objects, target, val, _i, _len;\n      target = arguments[0], objects = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      for (_i = 0, _len = objects.length; _i < _len; _i++) {\n        object = objects[_i];\n        for (key in object) {\n          val = object[key];\n          target[key] = val;\n        }\n      }\n      return target;\n    };\n\n    function Dropzone(element, options) {\n      var elementOptions, fallback, _ref;\n      this.element = element;\n      this.version = Dropzone.version;\n      this.defaultOptions.previewTemplate = this.defaultOptions.previewTemplate.replace(/\\n*/g, \"\");\n      this.clickableElements = [];\n      this.listeners = [];\n      this.files = [];\n      if (typeof this.element === \"string\") {\n        this.element = document.querySelector(this.element);\n      }\n      if (!(this.element && (this.element.nodeType != null))) {\n        throw new Error(\"Invalid dropzone element.\");\n      }\n      if (this.element.dropzone) {\n        throw new Error(\"Dropzone already attached.\");\n      }\n      Dropzone.instances.push(this);\n      this.element.dropzone = this;\n      elementOptions = (_ref = Dropzone.optionsForElement(this.element)) != null ? _ref : {};\n      this.options = extend({}, this.defaultOptions, elementOptions, options != null ? options : {});\n      if (this.options.forceFallback || !Dropzone.isBrowserSupported()) {\n        return this.options.fallback.call(this);\n      }\n      if (this.options.url == null) {\n        this.options.url = this.element.getAttribute(\"action\");\n      }\n      if (!this.options.url) {\n        throw new Error(\"No URL provided.\");\n      }\n      if (this.options.acceptedFiles && this.options.acceptedMimeTypes) {\n        throw new Error(\"You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.\");\n      }\n      if (this.options.acceptedMimeTypes) {\n        this.options.acceptedFiles = this.options.acceptedMimeTypes;\n        delete this.options.acceptedMimeTypes;\n      }\n      this.options.method = this.options.method.toUpperCase();\n      if ((fallback = this.getExistingFallback()) && fallback.parentNode) {\n        fallback.parentNode.removeChild(fallback);\n      }\n      if (this.options.previewsContainer !== false) {\n        if (this.options.previewsContainer) {\n          this.previewsContainer = Dropzone.getElement(this.options.previewsContainer, \"previewsContainer\");\n        } else {\n          this.previewsContainer = this.element;\n        }\n      }\n      if (this.options.clickable) {\n        if (this.options.clickable === true) {\n          this.clickableElements = [this.element];\n        } else {\n          this.clickableElements = Dropzone.getElements(this.options.clickable, \"clickable\");\n        }\n      }\n      this.init();\n    }\n\n    Dropzone.prototype.getAcceptedFiles = function() {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.accepted) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.getRejectedFiles = function() {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (!file.accepted) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.getFilesWithStatus = function(status) {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.status === status) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.getQueuedFiles = function() {\n      return this.getFilesWithStatus(Dropzone.QUEUED);\n    };\n\n    Dropzone.prototype.getUploadingFiles = function() {\n      return this.getFilesWithStatus(Dropzone.UPLOADING);\n    };\n\n    Dropzone.prototype.getAddedFiles = function() {\n      return this.getFilesWithStatus(Dropzone.ADDED);\n    };\n\n    Dropzone.prototype.getActiveFiles = function() {\n      var file, _i, _len, _ref, _results;\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.status === Dropzone.UPLOADING || file.status === Dropzone.QUEUED) {\n          _results.push(file);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.init = function() {\n      var eventName, noPropagation, setupHiddenFileInput, _i, _len, _ref, _ref1;\n      if (this.element.tagName === \"form\") {\n        this.element.setAttribute(\"enctype\", \"multipart/form-data\");\n      }\n      if (this.element.classList.contains(\"dropzone\") && !this.element.querySelector(\".dz-message\")) {\n        this.element.appendChild(Dropzone.createElement(\"<div class=\\\"dz-default dz-message\\\"><span>\" + this.options.dictDefaultMessage + \"</span></div>\"));\n      }\n      if (this.clickableElements.length) {\n        setupHiddenFileInput = (function(_this) {\n          return function() {\n            if (_this.hiddenFileInput) {\n              _this.hiddenFileInput.parentNode.removeChild(_this.hiddenFileInput);\n            }\n            _this.hiddenFileInput = document.createElement(\"input\");\n            _this.hiddenFileInput.setAttribute(\"type\", \"file\");\n            if ((_this.options.maxFiles == null) || _this.options.maxFiles > 1) {\n              _this.hiddenFileInput.setAttribute(\"multiple\", \"multiple\");\n            }\n            _this.hiddenFileInput.className = \"dz-hidden-input\";\n            if (_this.options.acceptedFiles != null) {\n              _this.hiddenFileInput.setAttribute(\"accept\", _this.options.acceptedFiles);\n            }\n            if (_this.options.capture != null) {\n              _this.hiddenFileInput.setAttribute(\"capture\", _this.options.capture);\n            }\n            _this.hiddenFileInput.style.visibility = \"hidden\";\n            _this.hiddenFileInput.style.position = \"absolute\";\n            _this.hiddenFileInput.style.top = \"0\";\n            _this.hiddenFileInput.style.left = \"0\";\n            _this.hiddenFileInput.style.height = \"0\";\n            _this.hiddenFileInput.style.width = \"0\";\n            document.querySelector(_this.options.hiddenInputContainer).appendChild(_this.hiddenFileInput);\n            return _this.hiddenFileInput.addEventListener(\"change\", function() {\n              var file, files, _i, _len;\n              files = _this.hiddenFileInput.files;\n              if (files.length) {\n                for (_i = 0, _len = files.length; _i < _len; _i++) {\n                  file = files[_i];\n                  _this.addFile(file);\n                }\n              }\n              _this.emit(\"addedfiles\", files);\n              return setupHiddenFileInput();\n            });\n          };\n        })(this);\n        setupHiddenFileInput();\n      }\n      this.URL = (_ref = window.URL) != null ? _ref : window.webkitURL;\n      _ref1 = this.events;\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        eventName = _ref1[_i];\n        this.on(eventName, this.options[eventName]);\n      }\n      this.on(\"uploadprogress\", (function(_this) {\n        return function() {\n          return _this.updateTotalUploadProgress();\n        };\n      })(this));\n      this.on(\"removedfile\", (function(_this) {\n        return function() {\n          return _this.updateTotalUploadProgress();\n        };\n      })(this));\n      this.on(\"canceled\", (function(_this) {\n        return function(file) {\n          return _this.emit(\"complete\", file);\n        };\n      })(this));\n      this.on(\"complete\", (function(_this) {\n        return function(file) {\n          if (_this.getAddedFiles().length === 0 && _this.getUploadingFiles().length === 0 && _this.getQueuedFiles().length === 0) {\n            return setTimeout((function() {\n              return _this.emit(\"queuecomplete\");\n            }), 0);\n          }\n        };\n      })(this));\n      noPropagation = function(e) {\n        e.stopPropagation();\n        if (e.preventDefault) {\n          return e.preventDefault();\n        } else {\n          return e.returnValue = false;\n        }\n      };\n      this.listeners = [\n        {\n          element: this.element,\n          events: {\n            \"dragstart\": (function(_this) {\n              return function(e) {\n                return _this.emit(\"dragstart\", e);\n              };\n            })(this),\n            \"dragenter\": (function(_this) {\n              return function(e) {\n                noPropagation(e);\n                return _this.emit(\"dragenter\", e);\n              };\n            })(this),\n            \"dragover\": (function(_this) {\n              return function(e) {\n                var efct;\n                try {\n                  efct = e.dataTransfer.effectAllowed;\n                } catch (_error) {}\n                e.dataTransfer.dropEffect = 'move' === efct || 'linkMove' === efct ? 'move' : 'copy';\n                noPropagation(e);\n                return _this.emit(\"dragover\", e);\n              };\n            })(this),\n            \"dragleave\": (function(_this) {\n              return function(e) {\n                return _this.emit(\"dragleave\", e);\n              };\n            })(this),\n            \"drop\": (function(_this) {\n              return function(e) {\n                noPropagation(e);\n                return _this.drop(e);\n              };\n            })(this),\n            \"dragend\": (function(_this) {\n              return function(e) {\n                return _this.emit(\"dragend\", e);\n              };\n            })(this)\n          }\n        }\n      ];\n      this.clickableElements.forEach((function(_this) {\n        return function(clickableElement) {\n          return _this.listeners.push({\n            element: clickableElement,\n            events: {\n              \"click\": function(evt) {\n                if ((clickableElement !== _this.element) || (evt.target === _this.element || Dropzone.elementInside(evt.target, _this.element.querySelector(\".dz-message\")))) {\n                  _this.hiddenFileInput.click();\n                }\n                return true;\n              }\n            }\n          });\n        };\n      })(this));\n      this.enable();\n      return this.options.init.call(this);\n    };\n\n    Dropzone.prototype.destroy = function() {\n      var _ref;\n      this.disable();\n      this.removeAllFiles(true);\n      if ((_ref = this.hiddenFileInput) != null ? _ref.parentNode : void 0) {\n        this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput);\n        this.hiddenFileInput = null;\n      }\n      delete this.element.dropzone;\n      return Dropzone.instances.splice(Dropzone.instances.indexOf(this), 1);\n    };\n\n    Dropzone.prototype.updateTotalUploadProgress = function() {\n      var activeFiles, file, totalBytes, totalBytesSent, totalUploadProgress, _i, _len, _ref;\n      totalBytesSent = 0;\n      totalBytes = 0;\n      activeFiles = this.getActiveFiles();\n      if (activeFiles.length) {\n        _ref = this.getActiveFiles();\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          file = _ref[_i];\n          totalBytesSent += file.upload.bytesSent;\n          totalBytes += file.upload.total;\n        }\n        totalUploadProgress = 100 * totalBytesSent / totalBytes;\n      } else {\n        totalUploadProgress = 100;\n      }\n      return this.emit(\"totaluploadprogress\", totalUploadProgress, totalBytes, totalBytesSent);\n    };\n\n    Dropzone.prototype._getParamName = function(n) {\n      if (typeof this.options.paramName === \"function\") {\n        return this.options.paramName(n);\n      } else {\n        return \"\" + this.options.paramName + (this.options.uploadMultiple ? \"[\" + n + \"]\" : \"\");\n      }\n    };\n\n    Dropzone.prototype._renameFilename = function(name) {\n      if (typeof this.options.renameFilename !== \"function\") {\n        return name;\n      }\n      return this.options.renameFilename(name);\n    };\n\n    Dropzone.prototype.getFallbackForm = function() {\n      var existingFallback, fields, fieldsString, form;\n      if (existingFallback = this.getExistingFallback()) {\n        return existingFallback;\n      }\n      fieldsString = \"<div class=\\\"dz-fallback\\\">\";\n      if (this.options.dictFallbackText) {\n        fieldsString += \"<p>\" + this.options.dictFallbackText + \"</p>\";\n      }\n      fieldsString += \"<input type=\\\"file\\\" name=\\\"\" + (this._getParamName(0)) + \"\\\" \" + (this.options.uploadMultiple ? 'multiple=\"multiple\"' : void 0) + \" /><input type=\\\"submit\\\" value=\\\"Upload!\\\"></div>\";\n      fields = Dropzone.createElement(fieldsString);\n      if (this.element.tagName !== \"FORM\") {\n        form = Dropzone.createElement(\"<form action=\\\"\" + this.options.url + \"\\\" enctype=\\\"multipart/form-data\\\" method=\\\"\" + this.options.method + \"\\\"></form>\");\n        form.appendChild(fields);\n      } else {\n        this.element.setAttribute(\"enctype\", \"multipart/form-data\");\n        this.element.setAttribute(\"method\", this.options.method);\n      }\n      return form != null ? form : fields;\n    };\n\n    Dropzone.prototype.getExistingFallback = function() {\n      var fallback, getFallback, tagName, _i, _len, _ref;\n      getFallback = function(elements) {\n        var el, _i, _len;\n        for (_i = 0, _len = elements.length; _i < _len; _i++) {\n          el = elements[_i];\n          if (/(^| )fallback($| )/.test(el.className)) {\n            return el;\n          }\n        }\n      };\n      _ref = [\"div\", \"form\"];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        tagName = _ref[_i];\n        if (fallback = getFallback(this.element.getElementsByTagName(tagName))) {\n          return fallback;\n        }\n      }\n    };\n\n    Dropzone.prototype.setupEventListeners = function() {\n      var elementListeners, event, listener, _i, _len, _ref, _results;\n      _ref = this.listeners;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        elementListeners = _ref[_i];\n        _results.push((function() {\n          var _ref1, _results1;\n          _ref1 = elementListeners.events;\n          _results1 = [];\n          for (event in _ref1) {\n            listener = _ref1[event];\n            _results1.push(elementListeners.element.addEventListener(event, listener, false));\n          }\n          return _results1;\n        })());\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.removeEventListeners = function() {\n      var elementListeners, event, listener, _i, _len, _ref, _results;\n      _ref = this.listeners;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        elementListeners = _ref[_i];\n        _results.push((function() {\n          var _ref1, _results1;\n          _ref1 = elementListeners.events;\n          _results1 = [];\n          for (event in _ref1) {\n            listener = _ref1[event];\n            _results1.push(elementListeners.element.removeEventListener(event, listener, false));\n          }\n          return _results1;\n        })());\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.disable = function() {\n      var file, _i, _len, _ref, _results;\n      this.clickableElements.forEach(function(element) {\n        return element.classList.remove(\"dz-clickable\");\n      });\n      this.removeEventListeners();\n      _ref = this.files;\n      _results = [];\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        _results.push(this.cancelUpload(file));\n      }\n      return _results;\n    };\n\n    Dropzone.prototype.enable = function() {\n      this.clickableElements.forEach(function(element) {\n        return element.classList.add(\"dz-clickable\");\n      });\n      return this.setupEventListeners();\n    };\n\n    Dropzone.prototype.filesize = function(size) {\n      var cutoff, i, selectedSize, selectedUnit, unit, units, _i, _len;\n      selectedSize = 0;\n      selectedUnit = \"b\";\n      if (size > 0) {\n        units = ['TB', 'GB', 'MB', 'KB', 'b'];\n        for (i = _i = 0, _len = units.length; _i < _len; i = ++_i) {\n          unit = units[i];\n          cutoff = Math.pow(this.options.filesizeBase, 4 - i) / 10;\n          if (size >= cutoff) {\n            selectedSize = size / Math.pow(this.options.filesizeBase, 4 - i);\n            selectedUnit = unit;\n            break;\n          }\n        }\n        selectedSize = Math.round(10 * selectedSize) / 10;\n      }\n      return \"<strong>\" + selectedSize + \"</strong> \" + selectedUnit;\n    };\n\n    Dropzone.prototype._updateMaxFilesReachedClass = function() {\n      if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {\n        if (this.getAcceptedFiles().length === this.options.maxFiles) {\n          this.emit('maxfilesreached', this.files);\n        }\n        return this.element.classList.add(\"dz-max-files-reached\");\n      } else {\n        return this.element.classList.remove(\"dz-max-files-reached\");\n      }\n    };\n\n    Dropzone.prototype.drop = function(e) {\n      var files, items;\n      if (!e.dataTransfer) {\n        return;\n      }\n      this.emit(\"drop\", e);\n      files = e.dataTransfer.files;\n      this.emit(\"addedfiles\", files);\n      if (files.length) {\n        items = e.dataTransfer.items;\n        if (items && items.length && (items[0].webkitGetAsEntry != null)) {\n          this._addFilesFromItems(items);\n        } else {\n          this.handleFiles(files);\n        }\n      }\n    };\n\n    Dropzone.prototype.paste = function(e) {\n      var items, _ref;\n      if ((e != null ? (_ref = e.clipboardData) != null ? _ref.items : void 0 : void 0) == null) {\n        return;\n      }\n      this.emit(\"paste\", e);\n      items = e.clipboardData.items;\n      if (items.length) {\n        return this._addFilesFromItems(items);\n      }\n    };\n\n    Dropzone.prototype.handleFiles = function(files) {\n      var file, _i, _len, _results;\n      _results = [];\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        _results.push(this.addFile(file));\n      }\n      return _results;\n    };\n\n    Dropzone.prototype._addFilesFromItems = function(items) {\n      var entry, item, _i, _len, _results;\n      _results = [];\n      for (_i = 0, _len = items.length; _i < _len; _i++) {\n        item = items[_i];\n        if ((item.webkitGetAsEntry != null) && (entry = item.webkitGetAsEntry())) {\n          if (entry.isFile) {\n            _results.push(this.addFile(item.getAsFile()));\n          } else if (entry.isDirectory) {\n            _results.push(this._addFilesFromDirectory(entry, entry.name));\n          } else {\n            _results.push(void 0);\n          }\n        } else if (item.getAsFile != null) {\n          if ((item.kind == null) || item.kind === \"file\") {\n            _results.push(this.addFile(item.getAsFile()));\n          } else {\n            _results.push(void 0);\n          }\n        } else {\n          _results.push(void 0);\n        }\n      }\n      return _results;\n    };\n\n    Dropzone.prototype._addFilesFromDirectory = function(directory, path) {\n      var dirReader, errorHandler, readEntries;\n      dirReader = directory.createReader();\n      errorHandler = function(error) {\n        return typeof console !== \"undefined\" && console !== null ? typeof console.log === \"function\" ? console.log(error) : void 0 : void 0;\n      };\n      readEntries = (function(_this) {\n        return function() {\n          return dirReader.readEntries(function(entries) {\n            var entry, _i, _len;\n            if (entries.length > 0) {\n              for (_i = 0, _len = entries.length; _i < _len; _i++) {\n                entry = entries[_i];\n                if (entry.isFile) {\n                  entry.file(function(file) {\n                    if (_this.options.ignoreHiddenFiles && file.name.substring(0, 1) === '.') {\n                      return;\n                    }\n                    file.fullPath = \"\" + path + \"/\" + file.name;\n                    return _this.addFile(file);\n                  });\n                } else if (entry.isDirectory) {\n                  _this._addFilesFromDirectory(entry, \"\" + path + \"/\" + entry.name);\n                }\n              }\n              readEntries();\n            }\n            return null;\n          }, errorHandler);\n        };\n      })(this);\n      return readEntries();\n    };\n\n    Dropzone.prototype.accept = function(file, done) {\n      if (file.size > this.options.maxFilesize * 1024 * 1024) {\n        return done(this.options.dictFileTooBig.replace(\"{{filesize}}\", Math.round(file.size / 1024 / 10.24) / 100).replace(\"{{maxFilesize}}\", this.options.maxFilesize));\n      } else if (!Dropzone.isValidFile(file, this.options.acceptedFiles)) {\n        return done(this.options.dictInvalidFileType);\n      } else if ((this.options.maxFiles != null) && this.getAcceptedFiles().length >= this.options.maxFiles) {\n        done(this.options.dictMaxFilesExceeded.replace(\"{{maxFiles}}\", this.options.maxFiles));\n        return this.emit(\"maxfilesexceeded\", file);\n      } else {\n        return this.options.accept.call(this, file, done);\n      }\n    };\n\n    Dropzone.prototype.addFile = function(file) {\n      file.upload = {\n        progress: 0,\n        total: file.size,\n        bytesSent: 0\n      };\n      this.files.push(file);\n      file.status = Dropzone.ADDED;\n      this.emit(\"addedfile\", file);\n      this._enqueueThumbnail(file);\n      return this.accept(file, (function(_this) {\n        return function(error) {\n          if (error) {\n            file.accepted = false;\n            _this._errorProcessing([file], error);\n          } else {\n            file.accepted = true;\n            if (_this.options.autoQueue) {\n              _this.enqueueFile(file);\n            }\n          }\n          return _this._updateMaxFilesReachedClass();\n        };\n      })(this));\n    };\n\n    Dropzone.prototype.enqueueFiles = function(files) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        this.enqueueFile(file);\n      }\n      return null;\n    };\n\n    Dropzone.prototype.enqueueFile = function(file) {\n      if (file.status === Dropzone.ADDED && file.accepted === true) {\n        file.status = Dropzone.QUEUED;\n        if (this.options.autoProcessQueue) {\n          return setTimeout(((function(_this) {\n            return function() {\n              return _this.processQueue();\n            };\n          })(this)), 0);\n        }\n      } else {\n        throw new Error(\"This file can't be queued because it has already been processed or was rejected.\");\n      }\n    };\n\n    Dropzone.prototype._thumbnailQueue = [];\n\n    Dropzone.prototype._processingThumbnail = false;\n\n    Dropzone.prototype._enqueueThumbnail = function(file) {\n      if (this.options.createImageThumbnails && file.type.match(/image.*/) && file.size <= this.options.maxThumbnailFilesize * 1024 * 1024) {\n        this._thumbnailQueue.push(file);\n        return setTimeout(((function(_this) {\n          return function() {\n            return _this._processThumbnailQueue();\n          };\n        })(this)), 0);\n      }\n    };\n\n    Dropzone.prototype._processThumbnailQueue = function() {\n      if (this._processingThumbnail || this._thumbnailQueue.length === 0) {\n        return;\n      }\n      this._processingThumbnail = true;\n      return this.createThumbnail(this._thumbnailQueue.shift(), (function(_this) {\n        return function() {\n          _this._processingThumbnail = false;\n          return _this._processThumbnailQueue();\n        };\n      })(this));\n    };\n\n    Dropzone.prototype.removeFile = function(file) {\n      if (file.status === Dropzone.UPLOADING) {\n        this.cancelUpload(file);\n      }\n      this.files = without(this.files, file);\n      this.emit(\"removedfile\", file);\n      if (this.files.length === 0) {\n        return this.emit(\"reset\");\n      }\n    };\n\n    Dropzone.prototype.removeAllFiles = function(cancelIfNecessary) {\n      var file, _i, _len, _ref;\n      if (cancelIfNecessary == null) {\n        cancelIfNecessary = false;\n      }\n      _ref = this.files.slice();\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        file = _ref[_i];\n        if (file.status !== Dropzone.UPLOADING || cancelIfNecessary) {\n          this.removeFile(file);\n        }\n      }\n      return null;\n    };\n\n    Dropzone.prototype.createThumbnail = function(file, callback) {\n      var fileReader;\n      fileReader = new FileReader;\n      fileReader.onload = (function(_this) {\n        return function() {\n          if (file.type === \"image/svg+xml\") {\n            _this.emit(\"thumbnail\", file, fileReader.result);\n            if (callback != null) {\n              callback();\n            }\n            return;\n          }\n          return _this.createThumbnailFromUrl(file, fileReader.result, callback);\n        };\n      })(this);\n      return fileReader.readAsDataURL(file);\n    };\n\n    Dropzone.prototype.createThumbnailFromUrl = function(file, imageUrl, callback, crossOrigin) {\n      var img;\n      img = document.createElement(\"img\");\n      if (crossOrigin) {\n        img.crossOrigin = crossOrigin;\n      }\n      img.onload = (function(_this) {\n        return function() {\n          var canvas, ctx, resizeInfo, thumbnail, _ref, _ref1, _ref2, _ref3;\n          file.width = img.width;\n          file.height = img.height;\n          resizeInfo = _this.options.resize.call(_this, file);\n          if (resizeInfo.trgWidth == null) {\n            resizeInfo.trgWidth = resizeInfo.optWidth;\n          }\n          if (resizeInfo.trgHeight == null) {\n            resizeInfo.trgHeight = resizeInfo.optHeight;\n          }\n          canvas = document.createElement(\"canvas\");\n          ctx = canvas.getContext(\"2d\");\n          canvas.width = resizeInfo.trgWidth;\n          canvas.height = resizeInfo.trgHeight;\n          drawImageIOSFix(ctx, img, (_ref = resizeInfo.srcX) != null ? _ref : 0, (_ref1 = resizeInfo.srcY) != null ? _ref1 : 0, resizeInfo.srcWidth, resizeInfo.srcHeight, (_ref2 = resizeInfo.trgX) != null ? _ref2 : 0, (_ref3 = resizeInfo.trgY) != null ? _ref3 : 0, resizeInfo.trgWidth, resizeInfo.trgHeight);\n          thumbnail = canvas.toDataURL(\"image/png\");\n          _this.emit(\"thumbnail\", file, thumbnail);\n          if (callback != null) {\n            return callback();\n          }\n        };\n      })(this);\n      if (callback != null) {\n        img.onerror = callback;\n      }\n      return img.src = imageUrl;\n    };\n\n    Dropzone.prototype.processQueue = function() {\n      var i, parallelUploads, processingLength, queuedFiles;\n      parallelUploads = this.options.parallelUploads;\n      processingLength = this.getUploadingFiles().length;\n      i = processingLength;\n      if (processingLength >= parallelUploads) {\n        return;\n      }\n      queuedFiles = this.getQueuedFiles();\n      if (!(queuedFiles.length > 0)) {\n        return;\n      }\n      if (this.options.uploadMultiple) {\n        return this.processFiles(queuedFiles.slice(0, parallelUploads - processingLength));\n      } else {\n        while (i < parallelUploads) {\n          if (!queuedFiles.length) {\n            return;\n          }\n          this.processFile(queuedFiles.shift());\n          i++;\n        }\n      }\n    };\n\n    Dropzone.prototype.processFile = function(file) {\n      return this.processFiles([file]);\n    };\n\n    Dropzone.prototype.processFiles = function(files) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.processing = true;\n        file.status = Dropzone.UPLOADING;\n        this.emit(\"processing\", file);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"processingmultiple\", files);\n      }\n      return this.uploadFiles(files);\n    };\n\n    Dropzone.prototype._getFilesWithXhr = function(xhr) {\n      var file, files;\n      return files = (function() {\n        var _i, _len, _ref, _results;\n        _ref = this.files;\n        _results = [];\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          file = _ref[_i];\n          if (file.xhr === xhr) {\n            _results.push(file);\n          }\n        }\n        return _results;\n      }).call(this);\n    };\n\n    Dropzone.prototype.cancelUpload = function(file) {\n      var groupedFile, groupedFiles, _i, _j, _len, _len1, _ref;\n      if (file.status === Dropzone.UPLOADING) {\n        groupedFiles = this._getFilesWithXhr(file.xhr);\n        for (_i = 0, _len = groupedFiles.length; _i < _len; _i++) {\n          groupedFile = groupedFiles[_i];\n          groupedFile.status = Dropzone.CANCELED;\n        }\n        file.xhr.abort();\n        for (_j = 0, _len1 = groupedFiles.length; _j < _len1; _j++) {\n          groupedFile = groupedFiles[_j];\n          this.emit(\"canceled\", groupedFile);\n        }\n        if (this.options.uploadMultiple) {\n          this.emit(\"canceledmultiple\", groupedFiles);\n        }\n      } else if ((_ref = file.status) === Dropzone.ADDED || _ref === Dropzone.QUEUED) {\n        file.status = Dropzone.CANCELED;\n        this.emit(\"canceled\", file);\n        if (this.options.uploadMultiple) {\n          this.emit(\"canceledmultiple\", [file]);\n        }\n      }\n      if (this.options.autoProcessQueue) {\n        return this.processQueue();\n      }\n    };\n\n    resolveOption = function() {\n      var args, option;\n      option = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];\n      if (typeof option === 'function') {\n        return option.apply(this, args);\n      }\n      return option;\n    };\n\n    Dropzone.prototype.uploadFile = function(file) {\n      return this.uploadFiles([file]);\n    };\n\n    Dropzone.prototype.uploadFiles = function(files) {\n      var file, formData, handleError, headerName, headerValue, headers, i, input, inputName, inputType, key, method, option, progressObj, response, updateProgress, url, value, xhr, _i, _j, _k, _l, _len, _len1, _len2, _len3, _m, _ref, _ref1, _ref2, _ref3, _ref4, _ref5;\n      xhr = new XMLHttpRequest();\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.xhr = xhr;\n      }\n      method = resolveOption(this.options.method, files);\n      url = resolveOption(this.options.url, files);\n      xhr.open(method, url, true);\n      xhr.withCredentials = !!this.options.withCredentials;\n      response = null;\n      handleError = (function(_this) {\n        return function() {\n          var _j, _len1, _results;\n          _results = [];\n          for (_j = 0, _len1 = files.length; _j < _len1; _j++) {\n            file = files[_j];\n            _results.push(_this._errorProcessing(files, response || _this.options.dictResponseError.replace(\"{{statusCode}}\", xhr.status), xhr));\n          }\n          return _results;\n        };\n      })(this);\n      updateProgress = (function(_this) {\n        return function(e) {\n          var allFilesFinished, progress, _j, _k, _l, _len1, _len2, _len3, _results;\n          if (e != null) {\n            progress = 100 * e.loaded / e.total;\n            for (_j = 0, _len1 = files.length; _j < _len1; _j++) {\n              file = files[_j];\n              file.upload = {\n                progress: progress,\n                total: e.total,\n                bytesSent: e.loaded\n              };\n            }\n          } else {\n            allFilesFinished = true;\n            progress = 100;\n            for (_k = 0, _len2 = files.length; _k < _len2; _k++) {\n              file = files[_k];\n              if (!(file.upload.progress === 100 && file.upload.bytesSent === file.upload.total)) {\n                allFilesFinished = false;\n              }\n              file.upload.progress = progress;\n              file.upload.bytesSent = file.upload.total;\n            }\n            if (allFilesFinished) {\n              return;\n            }\n          }\n          _results = [];\n          for (_l = 0, _len3 = files.length; _l < _len3; _l++) {\n            file = files[_l];\n            _results.push(_this.emit(\"uploadprogress\", file, progress, file.upload.bytesSent));\n          }\n          return _results;\n        };\n      })(this);\n      xhr.onload = (function(_this) {\n        return function(e) {\n          var _ref;\n          if (files[0].status === Dropzone.CANCELED) {\n            return;\n          }\n          if (xhr.readyState !== 4) {\n            return;\n          }\n          response = xhr.responseText;\n          if (xhr.getResponseHeader(\"content-type\") && ~xhr.getResponseHeader(\"content-type\").indexOf(\"application/json\")) {\n            try {\n              response = JSON.parse(response);\n            } catch (_error) {\n              e = _error;\n              response = \"Invalid JSON response from server.\";\n            }\n          }\n          updateProgress();\n          if (!((200 <= (_ref = xhr.status) && _ref < 300))) {\n            return handleError();\n          } else {\n            return _this._finished(files, response, e);\n          }\n        };\n      })(this);\n      xhr.onerror = (function(_this) {\n        return function() {\n          if (files[0].status === Dropzone.CANCELED) {\n            return;\n          }\n          return handleError();\n        };\n      })(this);\n      progressObj = (_ref = xhr.upload) != null ? _ref : xhr;\n      progressObj.onprogress = updateProgress;\n      headers = {\n        \"Accept\": \"application/json\",\n        \"Cache-Control\": \"no-cache\",\n        \"X-Requested-With\": \"XMLHttpRequest\"\n      };\n      if (this.options.headers) {\n        extend(headers, this.options.headers);\n      }\n      for (headerName in headers) {\n        headerValue = headers[headerName];\n        if (headerValue) {\n          xhr.setRequestHeader(headerName, headerValue);\n        }\n      }\n      formData = new FormData();\n      if (this.options.params) {\n        _ref1 = this.options.params;\n        for (key in _ref1) {\n          value = _ref1[key];\n          formData.append(key, value);\n        }\n      }\n      for (_j = 0, _len1 = files.length; _j < _len1; _j++) {\n        file = files[_j];\n        this.emit(\"sending\", file, xhr, formData);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"sendingmultiple\", files, xhr, formData);\n      }\n      if (this.element.tagName === \"FORM\") {\n        _ref2 = this.element.querySelectorAll(\"input, textarea, select, button\");\n        for (_k = 0, _len2 = _ref2.length; _k < _len2; _k++) {\n          input = _ref2[_k];\n          inputName = input.getAttribute(\"name\");\n          inputType = input.getAttribute(\"type\");\n          if (input.tagName === \"SELECT\" && input.hasAttribute(\"multiple\")) {\n            _ref3 = input.options;\n            for (_l = 0, _len3 = _ref3.length; _l < _len3; _l++) {\n              option = _ref3[_l];\n              if (option.selected) {\n                formData.append(inputName, option.value);\n              }\n            }\n          } else if (!inputType || ((_ref4 = inputType.toLowerCase()) !== \"checkbox\" && _ref4 !== \"radio\") || input.checked) {\n            formData.append(inputName, input.value);\n          }\n        }\n      }\n      for (i = _m = 0, _ref5 = files.length - 1; 0 <= _ref5 ? _m <= _ref5 : _m >= _ref5; i = 0 <= _ref5 ? ++_m : --_m) {\n        formData.append(this._getParamName(i), files[i], this._renameFilename(files[i].name));\n      }\n      return this.submitRequest(xhr, formData, files);\n    };\n\n    Dropzone.prototype.submitRequest = function(xhr, formData, files) {\n      return xhr.send(formData);\n    };\n\n    Dropzone.prototype._finished = function(files, responseText, e) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.status = Dropzone.SUCCESS;\n        this.emit(\"success\", file, responseText, e);\n        this.emit(\"complete\", file);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"successmultiple\", files, responseText, e);\n        this.emit(\"completemultiple\", files);\n      }\n      if (this.options.autoProcessQueue) {\n        return this.processQueue();\n      }\n    };\n\n    Dropzone.prototype._errorProcessing = function(files, message, xhr) {\n      var file, _i, _len;\n      for (_i = 0, _len = files.length; _i < _len; _i++) {\n        file = files[_i];\n        file.status = Dropzone.ERROR;\n        this.emit(\"error\", file, message, xhr);\n        this.emit(\"complete\", file);\n      }\n      if (this.options.uploadMultiple) {\n        this.emit(\"errormultiple\", files, message, xhr);\n        this.emit(\"completemultiple\", files);\n      }\n      if (this.options.autoProcessQueue) {\n        return this.processQueue();\n      }\n    };\n\n    return Dropzone;\n\n  })(Emitter);\n\n  Dropzone.version = \"4.3.0\";\n\n  Dropzone.options = {};\n\n  Dropzone.optionsForElement = function(element) {\n    if (element.getAttribute(\"id\")) {\n      return Dropzone.options[camelize(element.getAttribute(\"id\"))];\n    } else {\n      return void 0;\n    }\n  };\n\n  Dropzone.instances = [];\n\n  Dropzone.forElement = function(element) {\n    if (typeof element === \"string\") {\n      element = document.querySelector(element);\n    }\n    if ((element != null ? element.dropzone : void 0) == null) {\n      throw new Error(\"No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.\");\n    }\n    return element.dropzone;\n  };\n\n  Dropzone.autoDiscover = true;\n\n  Dropzone.discover = function() {\n    var checkElements, dropzone, dropzones, _i, _len, _results;\n    if (document.querySelectorAll) {\n      dropzones = document.querySelectorAll(\".dropzone\");\n    } else {\n      dropzones = [];\n      checkElements = function(elements) {\n        var el, _i, _len, _results;\n        _results = [];\n        for (_i = 0, _len = elements.length; _i < _len; _i++) {\n          el = elements[_i];\n          if (/(^| )dropzone($| )/.test(el.className)) {\n            _results.push(dropzones.push(el));\n          } else {\n            _results.push(void 0);\n          }\n        }\n        return _results;\n      };\n      checkElements(document.getElementsByTagName(\"div\"));\n      checkElements(document.getElementsByTagName(\"form\"));\n    }\n    _results = [];\n    for (_i = 0, _len = dropzones.length; _i < _len; _i++) {\n      dropzone = dropzones[_i];\n      if (Dropzone.optionsForElement(dropzone) !== false) {\n        _results.push(new Dropzone(dropzone));\n      } else {\n        _results.push(void 0);\n      }\n    }\n    return _results;\n  };\n\n  Dropzone.blacklistedBrowsers = [/opera.*Macintosh.*version\\/12/i];\n\n  Dropzone.isBrowserSupported = function() {\n    var capableBrowser, regex, _i, _len, _ref;\n    capableBrowser = true;\n    if (window.File && window.FileReader && window.FileList && window.Blob && window.FormData && document.querySelector) {\n      if (!(\"classList\" in document.createElement(\"a\"))) {\n        capableBrowser = false;\n      } else {\n        _ref = Dropzone.blacklistedBrowsers;\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          regex = _ref[_i];\n          if (regex.test(navigator.userAgent)) {\n            capableBrowser = false;\n            continue;\n          }\n        }\n      }\n    } else {\n      capableBrowser = false;\n    }\n    return capableBrowser;\n  };\n\n  without = function(list, rejectedItem) {\n    var item, _i, _len, _results;\n    _results = [];\n    for (_i = 0, _len = list.length; _i < _len; _i++) {\n      item = list[_i];\n      if (item !== rejectedItem) {\n        _results.push(item);\n      }\n    }\n    return _results;\n  };\n\n  camelize = function(str) {\n    return str.replace(/[\\-_](\\w)/g, function(match) {\n      return match.charAt(1).toUpperCase();\n    });\n  };\n\n  Dropzone.createElement = function(string) {\n    var div;\n    div = document.createElement(\"div\");\n    div.innerHTML = string;\n    return div.childNodes[0];\n  };\n\n  Dropzone.elementInside = function(element, container) {\n    if (element === container) {\n      return true;\n    }\n    while (element = element.parentNode) {\n      if (element === container) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  Dropzone.getElement = function(el, name) {\n    var element;\n    if (typeof el === \"string\") {\n      element = document.querySelector(el);\n    } else if (el.nodeType != null) {\n      element = el;\n    }\n    if (element == null) {\n      throw new Error(\"Invalid `\" + name + \"` option provided. Please provide a CSS selector or a plain HTML element.\");\n    }\n    return element;\n  };\n\n  Dropzone.getElements = function(els, name) {\n    var e, el, elements, _i, _j, _len, _len1, _ref;\n    if (els instanceof Array) {\n      elements = [];\n      try {\n        for (_i = 0, _len = els.length; _i < _len; _i++) {\n          el = els[_i];\n          elements.push(this.getElement(el, name));\n        }\n      } catch (_error) {\n        e = _error;\n        elements = null;\n      }\n    } else if (typeof els === \"string\") {\n      elements = [];\n      _ref = document.querySelectorAll(els);\n      for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {\n        el = _ref[_j];\n        elements.push(el);\n      }\n    } else if (els.nodeType != null) {\n      elements = [els];\n    }\n    if (!((elements != null) && elements.length)) {\n      throw new Error(\"Invalid `\" + name + \"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.\");\n    }\n    return elements;\n  };\n\n  Dropzone.confirm = function(question, accepted, rejected) {\n    if (window.confirm(question)) {\n      return accepted();\n    } else if (rejected != null) {\n      return rejected();\n    }\n  };\n\n  Dropzone.isValidFile = function(file, acceptedFiles) {\n    var baseMimeType, mimeType, validType, _i, _len;\n    if (!acceptedFiles) {\n      return true;\n    }\n    acceptedFiles = acceptedFiles.split(\",\");\n    mimeType = file.type;\n    baseMimeType = mimeType.replace(/\\/.*$/, \"\");\n    for (_i = 0, _len = acceptedFiles.length; _i < _len; _i++) {\n      validType = acceptedFiles[_i];\n      validType = validType.trim();\n      if (validType.charAt(0) === \".\") {\n        if (file.name.toLowerCase().indexOf(validType.toLowerCase(), file.name.length - validType.length) !== -1) {\n          return true;\n        }\n      } else if (/\\/\\*$/.test(validType)) {\n        if (baseMimeType === validType.replace(/\\/.*$/, \"\")) {\n          return true;\n        }\n      } else {\n        if (mimeType === validType) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n\n  if (typeof jQuery !== \"undefined\" && jQuery !== null) {\n    jQuery.fn.dropzone = function(options) {\n      return this.each(function() {\n        return new Dropzone(this, options);\n      });\n    };\n  }\n\n  if (typeof module !== \"undefined\" && module !== null) {\n    module.exports = Dropzone;\n  } else {\n    window.Dropzone = Dropzone;\n  }\n\n  Dropzone.ADDED = \"added\";\n\n  Dropzone.QUEUED = \"queued\";\n\n  Dropzone.ACCEPTED = Dropzone.QUEUED;\n\n  Dropzone.UPLOADING = \"uploading\";\n\n  Dropzone.PROCESSING = Dropzone.UPLOADING;\n\n  Dropzone.CANCELED = \"canceled\";\n\n  Dropzone.ERROR = \"error\";\n\n  Dropzone.SUCCESS = \"success\";\n\n\n  /*\n  \n  Bugfix for iOS 6 and 7\n  Source: http://stackoverflow.com/questions/11929099/html5-canvas-drawimage-ratio-bug-ios\n  based on the work of https://github.com/stomita/ios-imagefile-megapixel\n   */\n\n  detectVerticalSquash = function(img) {\n    var alpha, canvas, ctx, data, ey, ih, iw, py, ratio, sy;\n    iw = img.naturalWidth;\n    ih = img.naturalHeight;\n    canvas = document.createElement(\"canvas\");\n    canvas.width = 1;\n    canvas.height = ih;\n    ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(img, 0, 0);\n    data = ctx.getImageData(0, 0, 1, ih).data;\n    sy = 0;\n    ey = ih;\n    py = ih;\n    while (py > sy) {\n      alpha = data[(py - 1) * 4 + 3];\n      if (alpha === 0) {\n        ey = py;\n      } else {\n        sy = py;\n      }\n      py = (ey + sy) >> 1;\n    }\n    ratio = py / ih;\n    if (ratio === 0) {\n      return 1;\n    } else {\n      return ratio;\n    }\n  };\n\n  drawImageIOSFix = function(ctx, img, sx, sy, sw, sh, dx, dy, dw, dh) {\n    var vertSquashRatio;\n    vertSquashRatio = detectVerticalSquash(img);\n    return ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh / vertSquashRatio);\n  };\n\n\n  /*\n   * contentloaded.js\n   *\n   * Author: Diego Perini (diego.perini at gmail.com)\n   * Summary: cross-browser wrapper for DOMContentLoaded\n   * Updated: 20101020\n   * License: MIT\n   * Version: 1.2\n   *\n   * URL:\n   * http://javascript.nwbox.com/ContentLoaded/\n   * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE\n   */\n\n  contentLoaded = function(win, fn) {\n    var add, doc, done, init, poll, pre, rem, root, top;\n    done = false;\n    top = true;\n    doc = win.document;\n    root = doc.documentElement;\n    add = (doc.addEventListener ? \"addEventListener\" : \"attachEvent\");\n    rem = (doc.addEventListener ? \"removeEventListener\" : \"detachEvent\");\n    pre = (doc.addEventListener ? \"\" : \"on\");\n    init = function(e) {\n      if (e.type === \"readystatechange\" && doc.readyState !== \"complete\") {\n        return;\n      }\n      (e.type === \"load\" ? win : doc)[rem](pre + e.type, init, false);\n      if (!done && (done = true)) {\n        return fn.call(win, e.type || e);\n      }\n    };\n    poll = function() {\n      var e;\n      try {\n        root.doScroll(\"left\");\n      } catch (_error) {\n        e = _error;\n        setTimeout(poll, 50);\n        return;\n      }\n      return init(\"poll\");\n    };\n    if (doc.readyState !== \"complete\") {\n      if (doc.createEventObject && root.doScroll) {\n        try {\n          top = !win.frameElement;\n        } catch (_error) {}\n        if (top) {\n          poll();\n        }\n      }\n      doc[add](pre + \"DOMContentLoaded\", init, false);\n      doc[add](pre + \"readystatechange\", init, false);\n      return win[add](pre + \"load\", init, false);\n    }\n  };\n\n  Dropzone._autoDiscoverFunction = function() {\n    if (Dropzone.autoDiscover) {\n      return Dropzone.discover();\n    }\n  };\n\n  contentLoaded(window, Dropzone._autoDiscoverFunction);\n\n}).call(this);","output":"str","x":630,"y":1300,"wires":[["631bcda9.4967e4"]]},{"id":"d8fadeb.346242","type":"template","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"html","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<script>\n    {{{dropzonejs}}}\n</script>\n<style>\n    {{{css}}}\n</style>\n\n<script>\n    // \"myAwesomeDropzone\" is the camelized version of the HTML element's ID\n    Dropzone.options.myDropzone = {\n      paramName: \"myFile\", // The name that will be used to transfer the file\n      maxFilesize: 2, // MB\n      accept: function(file, done) {\n        if (file.name == \"justinbieber.jpg\") {\n          done(\"Naha, you don't.\");\n        }\n        else { done(); }\n      }\n    };\n</script>\n\n<form action=\"/inspect\" class=\"dropzone\" method=\"post\" enctype=\"multipart/form-data\" id=\"my-dropzone\">\n  <div class=\"fallback\">\n    <input name=\"myFile\" type=\"file\" />\n    <input type=\"submit\" value=\"Submit\">\n  </div>\n</form>","output":"str","x":910,"y":1300,"wires":[["e613ab7c.a61c88"]]},{"id":"631bcda9.4967e4","type":"template","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","name":"","field":"css","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"/*\n * The MIT License\n * Copyright (c) 2012 Matias Meno <m@tias.me>\n */\n@-webkit-keyframes passing-through {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30%, 70% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); }\n  100% {\n    opacity: 0;\n    -webkit-transform: translateY(-40px);\n    -moz-transform: translateY(-40px);\n    -ms-transform: translateY(-40px);\n    -o-transform: translateY(-40px);\n    transform: translateY(-40px); } }\n@-moz-keyframes passing-through {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30%, 70% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); }\n  100% {\n    opacity: 0;\n    -webkit-transform: translateY(-40px);\n    -moz-transform: translateY(-40px);\n    -ms-transform: translateY(-40px);\n    -o-transform: translateY(-40px);\n    transform: translateY(-40px); } }\n@keyframes passing-through {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30%, 70% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); }\n  100% {\n    opacity: 0;\n    -webkit-transform: translateY(-40px);\n    -moz-transform: translateY(-40px);\n    -ms-transform: translateY(-40px);\n    -o-transform: translateY(-40px);\n    transform: translateY(-40px); } }\n@-webkit-keyframes slide-in {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); } }\n@-moz-keyframes slide-in {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); } }\n@keyframes slide-in {\n  0% {\n    opacity: 0;\n    -webkit-transform: translateY(40px);\n    -moz-transform: translateY(40px);\n    -ms-transform: translateY(40px);\n    -o-transform: translateY(40px);\n    transform: translateY(40px); }\n  30% {\n    opacity: 1;\n    -webkit-transform: translateY(0px);\n    -moz-transform: translateY(0px);\n    -ms-transform: translateY(0px);\n    -o-transform: translateY(0px);\n    transform: translateY(0px); } }\n@-webkit-keyframes pulse {\n  0% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); }\n  10% {\n    -webkit-transform: scale(1.1);\n    -moz-transform: scale(1.1);\n    -ms-transform: scale(1.1);\n    -o-transform: scale(1.1);\n    transform: scale(1.1); }\n  20% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); } }\n@-moz-keyframes pulse {\n  0% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); }\n  10% {\n    -webkit-transform: scale(1.1);\n    -moz-transform: scale(1.1);\n    -ms-transform: scale(1.1);\n    -o-transform: scale(1.1);\n    transform: scale(1.1); }\n  20% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); } }\n@keyframes pulse {\n  0% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); }\n  10% {\n    -webkit-transform: scale(1.1);\n    -moz-transform: scale(1.1);\n    -ms-transform: scale(1.1);\n    -o-transform: scale(1.1);\n    transform: scale(1.1); }\n  20% {\n    -webkit-transform: scale(1);\n    -moz-transform: scale(1);\n    -ms-transform: scale(1);\n    -o-transform: scale(1);\n    transform: scale(1); } }\n.dropzone, .dropzone * {\n  box-sizing: border-box; }\n\n.dropzone {\n  min-height: 150px;\n  border: 2px solid rgba(0, 0, 0, 0.3);\n  background: white;\n  padding: 20px 20px; }\n  .dropzone.dz-clickable {\n    cursor: pointer; }\n    .dropzone.dz-clickable * {\n      cursor: default; }\n    .dropzone.dz-clickable .dz-message, .dropzone.dz-clickable .dz-message * {\n      cursor: pointer; }\n  .dropzone.dz-started .dz-message {\n    display: none; }\n  .dropzone.dz-drag-hover {\n    border-style: solid; }\n    .dropzone.dz-drag-hover .dz-message {\n      opacity: 0.5; }\n  .dropzone .dz-message {\n    text-align: center;\n    margin: 2em 0; }\n  .dropzone .dz-preview {\n    position: relative;\n    display: inline-block;\n    vertical-align: top;\n    margin: 16px;\n    min-height: 100px; }\n    .dropzone .dz-preview:hover {\n      z-index: 1000; }\n      .dropzone .dz-preview:hover .dz-details {\n        opacity: 1; }\n    .dropzone .dz-preview.dz-file-preview .dz-image {\n      border-radius: 20px;\n      background: #999;\n      background: linear-gradient(to bottom, #eee, #ddd); }\n    .dropzone .dz-preview.dz-file-preview .dz-details {\n      opacity: 1; }\n    .dropzone .dz-preview.dz-image-preview {\n      background: white; }\n      .dropzone .dz-preview.dz-image-preview .dz-details {\n        -webkit-transition: opacity 0.2s linear;\n        -moz-transition: opacity 0.2s linear;\n        -ms-transition: opacity 0.2s linear;\n        -o-transition: opacity 0.2s linear;\n        transition: opacity 0.2s linear; }\n    .dropzone .dz-preview .dz-remove {\n      font-size: 14px;\n      text-align: center;\n      display: block;\n      cursor: pointer;\n      border: none; }\n      .dropzone .dz-preview .dz-remove:hover {\n        text-decoration: underline; }\n    .dropzone .dz-preview:hover .dz-details {\n      opacity: 1; }\n    .dropzone .dz-preview .dz-details {\n      z-index: 20;\n      position: absolute;\n      top: 0;\n      left: 0;\n      opacity: 0;\n      font-size: 13px;\n      min-width: 100%;\n      max-width: 100%;\n      padding: 2em 1em;\n      text-align: center;\n      color: rgba(0, 0, 0, 0.9);\n      line-height: 150%; }\n      .dropzone .dz-preview .dz-details .dz-size {\n        margin-bottom: 1em;\n        font-size: 16px; }\n      .dropzone .dz-preview .dz-details .dz-filename {\n        white-space: nowrap; }\n        .dropzone .dz-preview .dz-details .dz-filename:hover span {\n          border: 1px solid rgba(200, 200, 200, 0.8);\n          background-color: rgba(255, 255, 255, 0.8); }\n        .dropzone .dz-preview .dz-details .dz-filename:not(:hover) {\n          overflow: hidden;\n          text-overflow: ellipsis; }\n          .dropzone .dz-preview .dz-details .dz-filename:not(:hover) span {\n            border: 1px solid transparent; }\n      .dropzone .dz-preview .dz-details .dz-filename span, .dropzone .dz-preview .dz-details .dz-size span {\n        background-color: rgba(255, 255, 255, 0.4);\n        padding: 0 0.4em;\n        border-radius: 3px; }\n    .dropzone .dz-preview:hover .dz-image img {\n      -webkit-transform: scale(1.05, 1.05);\n      -moz-transform: scale(1.05, 1.05);\n      -ms-transform: scale(1.05, 1.05);\n      -o-transform: scale(1.05, 1.05);\n      transform: scale(1.05, 1.05);\n      -webkit-filter: blur(8px);\n      filter: blur(8px); }\n    .dropzone .dz-preview .dz-image {\n      border-radius: 20px;\n      overflow: hidden;\n      width: 120px;\n      height: 120px;\n      position: relative;\n      display: block;\n      z-index: 10; }\n      .dropzone .dz-preview .dz-image img {\n        display: block; }\n    .dropzone .dz-preview.dz-success .dz-success-mark {\n      -webkit-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -moz-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -ms-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -o-animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1);\n      animation: passing-through 3s cubic-bezier(0.77, 0, 0.175, 1); }\n    .dropzone .dz-preview.dz-error .dz-error-mark {\n      opacity: 1;\n      -webkit-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -moz-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -ms-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      -o-animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1);\n      animation: slide-in 3s cubic-bezier(0.77, 0, 0.175, 1); }\n    .dropzone .dz-preview .dz-success-mark, .dropzone .dz-preview .dz-error-mark {\n      pointer-events: none;\n      opacity: 0;\n      z-index: 500;\n      position: absolute;\n      display: block;\n      top: 50%;\n      left: 50%;\n      margin-left: -27px;\n      margin-top: -27px; }\n      .dropzone .dz-preview .dz-success-mark svg, .dropzone .dz-preview .dz-error-mark svg {\n        display: block;\n        width: 54px;\n        height: 54px; }\n    .dropzone .dz-preview.dz-processing .dz-progress {\n      opacity: 1;\n      -webkit-transition: all 0.2s linear;\n      -moz-transition: all 0.2s linear;\n      -ms-transition: all 0.2s linear;\n      -o-transition: all 0.2s linear;\n      transition: all 0.2s linear; }\n    .dropzone .dz-preview.dz-complete .dz-progress {\n      opacity: 0;\n      -webkit-transition: opacity 0.4s ease-in;\n      -moz-transition: opacity 0.4s ease-in;\n      -ms-transition: opacity 0.4s ease-in;\n      -o-transition: opacity 0.4s ease-in;\n      transition: opacity 0.4s ease-in; }\n    .dropzone .dz-preview:not(.dz-processing) .dz-progress {\n      -webkit-animation: pulse 6s ease infinite;\n      -moz-animation: pulse 6s ease infinite;\n      -ms-animation: pulse 6s ease infinite;\n      -o-animation: pulse 6s ease infinite;\n      animation: pulse 6s ease infinite; }\n    .dropzone .dz-preview .dz-progress {\n      opacity: 1;\n      z-index: 1000;\n      pointer-events: none;\n      position: absolute;\n      height: 16px;\n      left: 50%;\n      top: 50%;\n      margin-top: -8px;\n      width: 80px;\n      margin-left: -40px;\n      background: rgba(255, 255, 255, 0.9);\n      -webkit-transform: scale(1);\n      border-radius: 8px;\n      overflow: hidden; }\n      .dropzone .dz-preview .dz-progress .dz-upload {\n        background: #333;\n        background: linear-gradient(to bottom, #666, #444);\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        width: 0;\n        -webkit-transition: width 300ms ease-in-out;\n        -moz-transition: width 300ms ease-in-out;\n        -ms-transition: width 300ms ease-in-out;\n        -o-transition: width 300ms ease-in-out;\n        transition: width 300ms ease-in-out; }\n    .dropzone .dz-preview.dz-error .dz-error-message {\n      display: block; }\n    .dropzone .dz-preview.dz-error:hover .dz-error-message {\n      opacity: 1;\n      pointer-events: auto; }\n    .dropzone .dz-preview .dz-error-message {\n      pointer-events: none;\n      z-index: 1000;\n      position: absolute;\n      display: block;\n      display: none;\n      opacity: 0;\n      -webkit-transition: opacity 0.3s ease;\n      -moz-transition: opacity 0.3s ease;\n      -ms-transition: opacity 0.3s ease;\n      -o-transition: opacity 0.3s ease;\n      transition: opacity 0.3s ease;\n      border-radius: 8px;\n      font-size: 13px;\n      top: 130px;\n      left: -10px;\n      width: 140px;\n      background: #be2626;\n      background: linear-gradient(to bottom, #be2626, #a92222);\n      padding: 0.5em 1.2em;\n      color: white; }\n      .dropzone .dz-preview .dz-error-message:after {\n        content: '';\n        position: absolute;\n        top: -6px;\n        left: 64px;\n        width: 0;\n        height: 0;\n        border-left: 6px solid transparent;\n        border-right: 6px solid transparent;\n        border-bottom: 6px solid #be2626; }","output":"str","x":780,"y":1300,"wires":[["d8fadeb.346242"]]},{"id":"2150cbce.eb2c6c","type":"exec","z":"cb4dbdca.4ada08","command":"openssl","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":680,"y":80,"wires":[[],[],["7ebce2f8.7f3c54"]]},{"id":"72984aee.bfdbd4","type":"function","z":"cb4dbdca.4ada08","name":"Validate input","func":"if(!msg.hasOwnProperty(\"uid\") || !msg.hasOwnProperty(\"key\") || !msg.hasOwnProperty(\"cn\") ) {\n    msg.payload = {\n        error: \"Invalid input\"\n    }\n    node.send([null,msg]);\n    return;\n}\n\nnode.send([msg,null]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":200,"y":80,"wires":[["535c5ee0.30c368"],[]]},{"id":"d5352873.6d44d","type":"function","z":"f582f9d1.fd1e8","name":"Make P12","func":"msg.payload = \"pkcs12 -export -out /data/openssl/\" + msg.uid + \".p12 -inkey \" + msg.key + \" -in \" + msg.crt + \" -passin pass:\" + msg.password + \" -passout pass:\"+msg.password;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":100,"wires":[["715ffb01.84c0b4"]]},{"id":"715ffb01.84c0b4","type":"exec","z":"f582f9d1.fd1e8","command":"openssl","addpay":"payload","append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"","x":660,"y":100,"wires":[[],[],["e98415a6.c1f85"]]},{"id":"7ebce2f8.7f3c54","type":"switch","z":"cb4dbdca.4ada08","name":"OK?","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":80,"wires":[["c82859d5.59537"],["6ab79ce2.e29d74"]]},{"id":"6ab79ce2.e29d74","type":"function","z":"cb4dbdca.4ada08","name":"Error","func":"if(msg.payload.code === 0)\n    return;\nmsg.payload = {\n    error: \"Unable to generate CSR\"\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":120,"wires":[[]]},{"id":"6dda127.b8fabec","type":"function","z":"b440cd08.e1ad9","name":"Sign Certificate","func":"msg.payload = ' ca -notext -batch -notext -md sha256'\n\nif( msg.request.hasOwnProperty(\"days\") )\n    msg.payload += ' -days ' + msg.request.days;\nelse\n    msg.payload += ' -days 365';\n    \nmsg.payload += ' -config /data/openssl/openssl.conf'\n\nif( msg.type === \"client\")\n    msg.payload += ' -extensions client_cert';\nelse\n    msg.payload += ' -extensions server_cert'\n    \nmsg.payload += ' -in /data/openssl/' + msg.uid + \".csr\";\nmsg.payload += ' -out /data/openssl/' + msg.uid + \".crt\";\nif( msg.passphrase && msg.passphrase.length )\n    msg.payload += ' -passin pass:' + msg.passphrase\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":80,"wires":[["430fe72a.b04d58"]]},{"id":"430fe72a.b04d58","type":"exec","z":"b440cd08.e1ad9","command":"openssl","addpay":true,"append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"","x":700,"y":80,"wires":[[],[],["32c4f8f.67bfe88"]]},{"id":"c82859d5.59537","type":"function","z":"cb4dbdca.4ada08","name":"","func":"msg.csr = '/data/openssl/' + msg.uid + '.csr';\nmsg.payload = msg.csr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":960,"y":80,"wires":[[]]},{"id":"e69a9d46.6306c","type":"exec","z":"475018df.6c4cb","command":"openssl","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":600,"y":80,"wires":[[],[],["ea6bc00f.d6b608"]]},{"id":"400cd8da.b3fae","type":"function","z":"475018df.6c4cb","name":"Generate CSR","func":"msg.payload = ' req -new -config /data/openssl/openssl.conf -extensions server_cert'\nmsg.payload += ' -addext \"subjectAltName = DNS:' + msg.request.cn + '\"';\nmsg.payload += ' -key /data/openssl/' + msg.uid + \".key\";\nmsg.payload += ' -out /data/openssl/' + msg.uid + \".csr\";\nmsg.payload += ' -subj \"/CN=' + msg.request.cn + '\"';\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":80,"wires":[["e69a9d46.6306c"]]},{"id":"ea6bc00f.d6b608","type":"switch","z":"475018df.6c4cb","name":"OK?","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":80,"wires":[["e0c307ce.343fd"],["c4446ed0.b6a"]]},{"id":"c4446ed0.b6a","type":"function","z":"475018df.6c4cb","name":"Error","func":"if(msg.payload.code === 0)\n    return;\nmsg.payload = {\n    error: \"Unable to generate CSR\"\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":120,"wires":[[]]},{"id":"e0c307ce.343fd","type":"function","z":"475018df.6c4cb","name":"","func":"msg.payload = {\n    key: '/data/openssl/' + msg.uid + '.key',\n    csr: '/data/openssl/' + msg.uid + '.csr'\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1000,"y":80,"wires":[[]]},{"id":"463fa04.2662e6","type":"subflow:475018df.6c4cb","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","env":[],"x":750,"y":880,"wires":[["5e432832.e8bf8"],["435cc217.8c169c"],[]]},{"id":"32c4f8f.67bfe88","type":"switch","z":"b440cd08.e1ad9","name":"OK?","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":80,"wires":[["e1841280.2a112"],["8d6702db.fcbf78"]]},{"id":"8d6702db.fcbf78","type":"function","z":"b440cd08.e1ad9","name":"Error","func":"if(msg.payload.code === 0)\n    return;\nmsg.payload = {\n    error: \"Unable to Sign CSR\"\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1010,"y":140,"wires":[[]]},{"id":"e98415a6.c1f85","type":"switch","z":"f582f9d1.fd1e8","name":"OK?","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":830,"y":100,"wires":[["7dfb1f3c.b19b7"],["bd02d6a0.b2c26"]]},{"id":"bd02d6a0.b2c26","type":"function","z":"f582f9d1.fd1e8","name":"Error","func":"msg.payload = {\n    error: \"Unable to generate P12\"\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":160,"wires":[[]]},{"id":"7dfb1f3c.b19b7","type":"function","z":"f582f9d1.fd1e8","name":"OK","func":"msg.p12 = '/data/openssl/' + msg.uid + '.p12';\nmsg.payload = msg.p12;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":100,"wires":[[]]},{"id":"22729399.2b7b6c","type":"exec","z":"d3b910d5.d5f0c","command":"openssl","addpay":"payload","append":"","useSpawn":"false","timer":"15","oldrc":false,"name":"","x":720,"y":80,"wires":[[],[],["a1fefd87.5fcda"]]},{"id":"cf8ac8de.04237","type":"function","z":"d3b910d5.d5f0c","name":"Generate Key","func":"msg.request = msg.payload;\nmsg.payload = 'genrsa -out /data/openssl/' + msg.uid + \".key 2048\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":80,"wires":[["22729399.2b7b6c"]]},{"id":"d07eee8f.53d5e8","type":"function","z":"d3b910d5.d5f0c","name":"Error","func":"msg.payload = {\n    error: \"Unable to generate private key\"\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1010,"y":120,"wires":[[]]},{"id":"a1fefd87.5fcda","type":"switch","z":"d3b910d5.d5f0c","name":"OK?","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":80,"wires":[["e21f76a.7edbf08"],["d07eee8f.53d5e8"]]},{"id":"e21f76a.7edbf08","type":"function","z":"d3b910d5.d5f0c","name":"Key file","func":"msg.key = '/data/openssl/' + msg.uid + '.key'; \nmsg.payload = msg.key;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1020,"y":80,"wires":[[]]},{"id":"b45f250e.c9b098","type":"function","z":"475018df.6c4cb","name":"Validate Input","func":"if(!msg.hasOwnProperty(\"uid\") || !msg.hasOwnProperty(\"key\") || !msg.hasOwnProperty(\"cn\") ) {\n    msg.payload = {\n        error: \"Invalid input\"\n    }\n    node.send([null,msg]);\n    return;\n}\n\nnode.send([msg,null]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":200,"y":80,"wires":[["400cd8da.b3fae"],[]]},{"id":"535c5ee0.30c368","type":"function","z":"cb4dbdca.4ada08","name":"Generate client cert","func":"msg.payload = ' req -new -config /data/openssl/openssl.conf -extensions client_cert'\nmsg.payload += ' -key ' + msg.key;\nmsg.payload += ' -out /data/openssl/' + msg.uid + \".csr\";\nmsg.payload += ' -subj \"/CN=' + msg.request.cn + '\"';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":80,"wires":[["2150cbce.eb2c6c"]]},{"id":"2774a13.8bf5ede","type":"function","z":"d3b910d5.d5f0c","name":"Validate input","func":"if(!msg.hasOwnProperty(\"uid\") ) {\n    msg.payload = {\n        error: \"Invalid input\"\n    }\n    node.send([null,msg]);\n    return;\n}\n\nnode.send([msg,null]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":80,"wires":[["cf8ac8de.04237"],[]]},{"id":"4ffb450b.299974","type":"catch","z":"aa7daa87.f23d38","name":"","scope":["9e5ccfb2.19c098","be23ef2b.be374","ab09a480.b77f9","f0742953.d6ec7"],"uncaught":false,"x":150,"y":420,"wires":[["5d98374f.0abe38"]]},{"id":"5d98374f.0abe38","type":"http response","z":"aa7daa87.f23d38","name":"","statusCode":"500","headers":{},"x":320,"y":420,"wires":[]},{"id":"836fe412.ed356","type":"function","z":"b440cd08.e1ad9","name":"Validate input","func":"if(!msg.hasOwnProperty(\"uid\") || !msg.hasOwnProperty(\"key\") || !msg.hasOwnProperty(\"cn\") || !msg.hasOwnProperty(\"type\") ) {\n    msg.payload = {\n        error: \"Invalid input\"\n    }\n    node.send([null,msg]);\n    return;\n}\n\nnode.send([msg,null]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":240,"y":80,"wires":[["6dda127.b8fabec"],[]]},{"id":"e1841280.2a112","type":"function","z":"b440cd08.e1ad9","name":"OK","func":"msg.crt = '/data/openssl/' + msg.uid + '.crt';\nmsg.payload = msg.crt;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1010,"y":80,"wires":[[]]},{"id":"cb71dc41.e28f4","type":"function","z":"f582f9d1.fd1e8","name":"Validate input","func":"if(!msg.hasOwnProperty(\"uid\") || !msg.hasOwnProperty(\"key\") || !msg.hasOwnProperty(\"crt\") || !msg.hasOwnProperty(\"password\")  ) {\n    msg.payload = {\n        error: \"Invalid input\"\n    }\n    node.send([null,msg]);\n    return;\n}\n\nnode.send([msg,null]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":200,"y":100,"wires":[["d5352873.6d44d"],[]]},{"id":"91e50c0a.1e4658","type":"comment","z":"f582f9d1.fd1e8","name":"OK","info":"","x":1210,"y":100,"wires":[]},{"id":"1c2504e7.c58583","type":"comment","z":"f582f9d1.fd1e8","name":"Error","info":"","x":1210,"y":240,"wires":[]},{"id":"83062330.b6ae6","type":"comment","z":"f582f9d1.fd1e8","name":"Debug","info":"","x":1210,"y":300,"wires":[]},{"id":"71eb3b61.7af06c","type":"function","z":"8e3aead0.242ca8","name":"Remove all files","func":"msg.payload = \"/data/openssl/\" + msg.uid + \".*\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":100,"wires":[["79a0aa48.0f5234"]]},{"id":"79a0aa48.0f5234","type":"exec","z":"8e3aead0.242ca8","command":"rm -R","addpay":"payload","append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"","x":810,"y":100,"wires":[[],[],[]]},{"id":"f528b57c.82f12","type":"function","z":"8e3aead0.242ca8","name":"Validate input","func":"if(!msg.hasOwnProperty(\"uid\")  ) {\n    msg.payload = {\n        error: \"Invalid input\"\n    }\n    node.send([null,msg]);\n    return;\n}\nnode.send([msg,null]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":100,"wires":[["71eb3b61.7af06c"],[]]},{"id":"33f56c99.3ea84c","type":"http in","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","url":"/cert/server","method":"get","upload":false,"swaggerDoc":"","x":200,"y":880,"wires":[["2a89df2f.24f228"]]},{"id":"435cc217.8c169c","type":"http response","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","statusCode":"500","headers":{},"x":920,"y":940,"wires":[]},{"id":"5e432832.e8bf8","type":"subflow:b440cd08.e1ad9","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","env":[],"x":920,"y":880,"wires":[["472f07cb.5ef28"],["e43b8b6.750b378"],[]]},{"id":"e43b8b6.750b378","type":"http response","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","statusCode":"500","headers":{},"x":1080,"y":920,"wires":[]},{"id":"2a89df2f.24f228","type":"function","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"Validate input","func":"if( !msg.payload.hasOwnProperty(\"cn\") || typeof msg.payload.cn !== \"string\" || typeof msg.payload.cn.length < 3 )  {\n    msg.statusCode = 400;\n    msg.payload = {\n        error:\"Missing or invalid cn (Common Name)\"\n    }\n    node.send([null,msg]);\n    return;\n}\nmsg.cn = msg.payload.cn;\n\nif( msg.payload.hasOwnProperty(\"passphrase\") )\n    msg.passphrase = msg.payload.passphrase;\nelse\n    msg.passphrase = null;\n\nmsg.uid = new Date().getTime();\nmsg.type = \"server\";\n\nnode.send([msg,null]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":880,"wires":[["a17041b7.3f2fa"],["371ed654.d3965a"]]},{"id":"371ed654.d3965a","type":"http response","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","statusCode":"400","headers":{},"x":580,"y":940,"wires":[]},{"id":"a17041b7.3f2fa","type":"subflow:d3b910d5.d5f0c","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","env":[],"x":580,"y":880,"wires":[["463fa04.2662e6"],["95cbb01b.d7a1e"],[]]},{"id":"95cbb01b.d7a1e","type":"http response","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","statusCode":"400","headers":{},"x":740,"y":940,"wires":[]},{"id":"472f07cb.5ef28","type":"change","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"Key file","rules":[{"t":"set","p":"filename","pt":"msg","to":"key","tot":"msg"},{"t":"set","p":"zip","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":880,"wires":[["9e5ccfb2.19c098"]]},{"id":"9e5ccfb2.19c098","type":"file in","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":1390,"y":880,"wires":[["f75c5d31.f8f4d8"]]},{"id":"2f77af65.904188","type":"http response","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","statusCode":"200","headers":{},"x":1560,"y":1060,"wires":[]},{"id":"39a13919.625a56","type":"subflow:8e3aead0.242ca8","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","env":[],"x":1760,"y":1000,"wires":[[]]},{"id":"f75c5d31.f8f4d8","type":"function","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"Add to ZIP","func":"msg.zip.push({\n        filename: msg.request.cn + \".key\",\n        payload: msg.payload\n});\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1540,"y":880,"wires":[["67f86e70761b4f06"]]},{"id":"be23ef2b.be374","type":"file in","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":1390,"y":940,"wires":[["1ae7f992.0fe28e"]]},{"id":"1ae7f992.0fe28e","type":"function","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"Add to ZIP","func":"msg.zip.push({\n        filename: msg.request.cn + \".crt\",\n        payload: msg.payload\n});\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1540,"y":940,"wires":[["56ac6aef76929a33"]]},{"id":"996fbb93.cbfa2","type":"function","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"Headers","func":"msg.headers = {};\nmsg.headers['Content-Description'] = 'File Transfer';\nmsg.headers['Content-Transfer-Encoding'] = 'binary';\nmsg.headers[\"Content-Type\"] = \"application/x-compressed\",\nmsg.headers['Content-Disposition'] = \"attachment; filename=\" + msg.request.cn + \".zip\";\nmsg.headers[\"Content-Length\"] = msg.payload.length;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1400,"y":1060,"wires":[["2f77af65.904188"]]},{"id":"1fce3c23.7eae24","type":"function","z":"ff4de0da.c8d7d","g":"ad383299.8831c","name":"Build URL","func":"msg.url = \"/cert/server?\";\nmsg.payload = \"Common Name\"\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":420,"wires":[["70753fd1.8973a"]]},{"id":"48aaab65.59ed64","type":"function","z":"ff4de0da.c8d7d","g":"ad383299.8831c","name":"Build URL","func":"if( msg.payload === \"Cancel\" )\n    return;\n\nif(msg.payload.length < 2 )\n    return;\n    \nmsg.url += \"cn=\"+msg.payload;\nmsg.payload = \"CA Passprase\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":870,"y":420,"wires":[["c198279b.0b83b"]]},{"id":"8a6fc4ca.205ad","type":"function","z":"ff4de0da.c8d7d","g":"ad383299.8831c","name":"Build URL","func":"if( msg.payload === \"Cancel\" )\n    return;\nif( msg.payload.length > 0 )\n    msg.url += \"&passphrase=\"+msg.payload;\nmsg.payload = '<a style=\"color:white;\" href=\"' + msg.url + '\">Download link (ZIP)</a>';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":870,"y":480,"wires":[["60dbfc46.565ca4"]]},{"id":"a84c07a8.d94308","type":"comment","z":"d3b910d5.d5f0c","name":"Debug","info":"","x":1240,"y":300,"wires":[]},{"id":"5f7ea2a1.f2ec3c","type":"comment","z":"8e3aead0.242ca8","name":"Debug","info":"","x":1070,"y":180,"wires":[]},{"id":"799340a9.cd055","type":"function","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"Validate input","func":"if( !msg.payload.hasOwnProperty(\"csr\") || typeof msg.payload.csr !== \"string\" )  {\n    msg.payload = {\n        error:'Missing property csr'\n    }\n    node.send([null,msg]);\n    return;\n}\n\nif( typeof msg.payload.csr !== \"string\" )  {\n    msg.payload = {\n        error:'Invalid CSR Format'\n    }\n    node.send([null,msg]);\n    return;\n}\n\n\nif( msg.payload.csr.search('-----BEGIN CERTIFICATE REQUEST-----') < 0 )  {\n    msg.payload = {\n        error:'Invalid CSR format'\n    }\n    node.send([null,msg]);\n    return;\n}\n\nif( msg.payload.csr.search('-----END CERTIFICATE REQUEST-----') < 0 )  {\n    msg.payload = {\n        error:'Invalid CSR format'\n    }\n    node.send([null,msg]);\n    return;\n}\n\n\nif( msg.payload.hasOwnProperty(\"passphrase\") )\n    msg.passphrase = msg.payload.passphrase;\nelse\n    msg.passphrase = null;\n\n\nif( !msg.payload.hasOwnProperty(\"type\") || typeof msg.payload.type !== \"string\" || typeof msg.payload.type.length < 3 )  {\n    msg.statusCode = 400;\n    msg.payload = {\n        error:\"Missing or invalid type\"\n    }\n    node.send([null,msg]);\n    return;\n}\nmsg.type = msg.payload.type;\nif( msg.type !== \"server\" || msg.type !== \"server\") {\n    msg.statusCode = 400;\n    msg.payload = {\n        error:\"Type must be server or client\"\n    }\n    node.send([null,msg]);\n    return;\n}\n\nmsg.uid = new Date().getTime();\nmsg.filename = '/data/openssl/' + msg.uid + \".csr\"\nnode.send([msg,null]);","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":1180,"wires":[["d18eeabb.74f5e"],["95df5177.2a3ba"]]},{"id":"71b84b.52dec7b4","type":"http in","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"","url":"/sign","method":"post","upload":true,"swaggerDoc":"","x":180,"y":1180,"wires":[["799340a9.cd055"]]},{"id":"95df5177.2a3ba","type":"http response","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"","statusCode":"400","headers":{},"x":550,"y":1220,"wires":[]},{"id":"e979afd7.e6c83","type":"subflow:b440cd08.e1ad9","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"","env":[],"x":870,"y":1180,"wires":[["9e770f62.36b8a8"],["81420aad.8b1ce"],[]]},{"id":"81420aad.8b1ce","type":"http response","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"","statusCode":"500","headers":{},"x":1070,"y":1220,"wires":[]},{"id":"9e770f62.36b8a8","type":"change","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"filename","rules":[{"t":"set","p":"filename","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":1180,"wires":[["ab09a480.b77f9"]]},{"id":"d18eeabb.74f5e","type":"function","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"Store CSR","func":"msg.filename = \"/data/openssl/\" + msg.uid + \".csr\";\nmsg.payload = msg.payload.csr;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":1180,"wires":[["9c178499.cde37"]]},{"id":"9c178499.cde37","type":"file","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"true","encoding":"none","x":720,"y":1180,"wires":[["e979afd7.e6c83"]]},{"id":"ab09a480.b77f9","type":"file in","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"CertFile","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":1230,"y":1180,"wires":[["e6d0a0b0.c0f0a8","f334c172.2a687"]]},{"id":"e6d0a0b0.c0f0a8","type":"http response","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"","statusCode":"200","headers":{},"x":1410,"y":1180,"wires":[]},{"id":"f334c172.2a687","type":"subflow:8e3aead0.242ca8","z":"aa7daa87.f23d38","g":"8a14ff03.e2db8","name":"","env":[],"x":1420,"y":1220,"wires":[[]]},{"id":"0c0690210ab0fd5b","type":"file in","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":1390,"y":580,"wires":[["58a821cdd46a2390"]]},{"id":"58a821cdd46a2390","type":"function","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"Add to ZIP","func":"msg.zip.push({\n        filename: msg.request.cn + \".crt\",\n        payload: msg.payload\n});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1560,"y":580,"wires":[["43167ca43a9951a1"]]},{"id":"ffd9dca1.691da","type":"http in","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","url":"/cert/client","method":"get","upload":false,"swaggerDoc":"","x":200,"y":520,"wires":[["403f4f60.449728"]]},{"id":"9205a13d.38d388","type":"subflow:cb4dbdca.4ada08","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","env":[],"x":740,"y":520,"wires":[["4aa6ee81.a28cd8"],["ca2ad37e.46e378"],[]]},{"id":"ca2ad37e.46e378","type":"http response","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","statusCode":"500","headers":{},"x":910,"y":580,"wires":[]},{"id":"4aa6ee81.a28cd8","type":"subflow:b440cd08.e1ad9","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","env":[],"x":910,"y":520,"wires":[["aeb5f2b85ac371b0"],["6456c0dd.7ce0a8"],[]]},{"id":"6456c0dd.7ce0a8","type":"http response","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","statusCode":"500","headers":{},"x":1060,"y":540,"wires":[]},{"id":"802111da.e11618","type":"subflow:f582f9d1.fd1e8","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","env":[],"x":850,"y":700,"wires":[["64f4a277.350c64"],["46e1e06d.fb8518"],[]]},{"id":"403f4f60.449728","type":"function","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"Validate input","func":"if( !msg.payload.hasOwnProperty(\"cn\") || typeof msg.payload.cn !== \"string\" || typeof msg.payload.cn.length < 3 )  {\n    msg.statusCode = 400;\n    msg.payload = {\n        error:\"Missing or invalid cn (Common Name)\"\n    }\n    node.send([null,msg]);\n    return;\n}\nmsg.cn = msg.payload.cn;\n\nif( msg.payload.hasOwnProperty(\"passphrase\") )\n    msg.passphrase = msg.payload.passphrase;\nelse\n    msg.passphrase = null;\n\nif( !msg.payload.hasOwnProperty(\"password\") || typeof msg.payload.password !== \"string\" || typeof msg.payload.password.length < 8 )  {\n    msg.statusCode = 400;\n    msg.payload = {\n        error:\"Missing or invalid password\"\n    }\n    node.send([null,msg]);\n    return;\n}\nmsg.password = msg.payload.password;\nmsg.uid = new Date().getTime();\nmsg.type = \"client\";\n\nnode.send([msg,null]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":520,"wires":[["25a1916f.2b8ba6"],["f15bad68.c119a8"]]},{"id":"f15bad68.c119a8","type":"http response","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","statusCode":"400","headers":{},"x":570,"y":580,"wires":[]},{"id":"25a1916f.2b8ba6","type":"subflow:d3b910d5.d5f0c","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","env":[],"x":570,"y":520,"wires":[["9205a13d.38d388"],["5a44a275.d96914"],[]]},{"id":"5a44a275.d96914","type":"http response","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","statusCode":"400","headers":{},"x":730,"y":580,"wires":[]},{"id":"64f4a277.350c64","type":"change","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"filename","rules":[{"t":"set","p":"filename","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":700,"wires":[["f0742953.d6ec7"]]},{"id":"f0742953.d6ec7","type":"file in","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"P12 File","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":1400,"y":700,"wires":[["a9ab631ca61e4d2f"]]},{"id":"c6f6538c.c1d0c8","type":"http response","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","statusCode":"200","headers":{},"x":1580,"y":760,"wires":[]},{"id":"46e1e06d.fb8518","type":"http response","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","statusCode":"500","headers":{},"x":1020,"y":720,"wires":[]},{"id":"509cf9ac.f3fdb","type":"subflow:8e3aead0.242ca8","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","env":[],"x":1760,"y":700,"wires":[[]]},{"id":"aeb5f2b85ac371b0","type":"change","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"Key file","rules":[{"t":"set","p":"filename","pt":"msg","to":"key","tot":"msg"},{"t":"set","p":"zip","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":520,"wires":[["ab8854a5a2973bfd"]]},{"id":"ab8854a5a2973bfd","type":"file in","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":1390,"y":520,"wires":[["1bafacb0793e06d3"]]},{"id":"1bafacb0793e06d3","type":"function","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"Add to ZIP","func":"msg.zip.push({\n        filename: msg.request.cn + \".key\",\n        payload: msg.payload\n});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1560,"y":520,"wires":[["1d415502c0eff8f1"]]},{"id":"a9ab631ca61e4d2f","type":"function","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"Add to ZIP","func":"msg.zip.push({\n    filename: msg.request.cn + \".p12\",\n    payload: msg.payload\n});\nmsg.payload = msg.zip;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1580,"y":700,"wires":[["84f2a8e188a58c28","509cf9ac.f3fdb"]]},{"id":"e31c659d9f025fb9","type":"function","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"Headers","func":"msg.headers = {};\nmsg.headers['Content-Description'] = 'File Transfer';\nmsg.headers['Content-Transfer-Encoding'] = 'binary';\nmsg.headers[\"Content-Type\"] = \"application/x-compressed\",\nmsg.headers['Content-Disposition'] = \"attachment; filename=\" + msg.request.cn + \".zip\";\nmsg.headers[\"Content-Length\"] = msg.payload.length;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1400,"y":760,"wires":[["c6f6538c.c1d0c8"]]},{"id":"cc643a42c4742946","type":"function","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Generate Private Key","func":"msg.payload = ' genrsa ';\nmsg.payload += ' -out /data/openssl/root.key';\nif( msg.passphrase && msg.passphrase.length )\n    msg.payload += ' -aes256 -passout pass:' + msg.passphrase;\nmsg.payload += '  4096';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":220,"wires":[["f23bd66ba634570b"]]},{"id":"f23bd66ba634570b","type":"exec","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","command":"openssl","addpay":"payload","append":"","useSpawn":"false","timer":"60","winHide":false,"oldrc":false,"name":"","x":680,"y":220,"wires":[[],[],["4ad2632439f4acde","3e96719861d5510d"]]},{"id":"22dc0b8e9f5d8950","type":"function","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Generate Root Certificate","func":"msg.payload = ' req -x509 -new -nodes -days 3650'\nmsg.payload += ' -key /data/openssl/root.key'\nmsg.payload += ' -out /data/openssl/root.crt'\nif( msg.passphrase && msg.passphrase.length )\n    msg.payload += ' -passin pass:' + msg.passphrase\nmsg.payload += ' -subj \"/O=' + msg.org + '/CN=' + msg.commonName +'\"';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":470,"y":320,"wires":[["e80dea3a51bf8b49"]]},{"id":"e80dea3a51bf8b49","type":"exec","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","command":"openssl","addpay":true,"append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"","x":680,"y":320,"wires":[[],[],["4f081d53b54e5d2c","5826abfe25abecac"]]},{"id":"4ad2632439f4acde","type":"function","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"OK","func":"if(msg.payload.code === 0)\n    return msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":240,"wires":[["22dc0b8e9f5d8950"]]},{"id":"3e96719861d5510d","type":"function","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Error","func":"if(msg.payload.code === 0)\n    return;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":200,"wires":[["d3bcdb93213ca90b"]]},{"id":"4f081d53b54e5d2c","type":"function","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Error","func":"if(msg.payload.code === 0)\n    return;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":320,"wires":[["913e0af566da68f5"]]},{"id":"392047c5814e5a13","type":"inject","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Initialize CA","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":230,"y":120,"wires":[["a2c8629b835d2f77"]]},{"id":"a2c8629b835d2f77","type":"change","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Double click and set your CA settings here","rules":[{"t":"set","p":"org","pt":"msg","to":"Acme Inc","tot":"str"},{"t":"set","p":"commonName","pt":"msg","to":"Acme CA","tot":"str"},{"t":"set","p":"passphrase","pt":"msg","to":"demo","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":120,"wires":[["175908e83609a23d"]]},{"id":"d3bcdb93213ca90b","type":"debug","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"Error","targetType":"msg","statusVal":"","statusType":"auto","x":1180,"y":200,"wires":[]},{"id":"913e0af566da68f5","type":"debug","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1190,"y":320,"wires":[]},{"id":"175908e83609a23d","type":"subflow:39dca28.bd9835e","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"","env":[],"x":810,"y":120,"wires":[["04eee688ac936b74"]]},{"id":"5826abfe25abecac","type":"function","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"OK","func":"if(msg.payload.code === 0) {\n    msg.payload = \"CA is ready\";\n    return msg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":360,"wires":[["4c43a7be2ec76a85"]]},{"id":"4c43a7be2ec76a85","type":"function","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Generate CRL","func":"msg.payload = 'ca -notext -config /data/openssl/openssl.conf -gencrl -out /data/openssl/crl/crl.pem';\nif( msg.passphrase && msg.passphrase.length )\n    msg.payload += ' -passin pass:' + msg.passphrase\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":440,"wires":[["25057281122106d1"]]},{"id":"25057281122106d1","type":"exec","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","command":"openssl","addpay":"payload","append":"","useSpawn":"false","timer":"60","winHide":false,"oldrc":false,"name":"","x":680,"y":440,"wires":[[],[],["889f8c15c3454c10","4327e77f54b2b844"]]},{"id":"889f8c15c3454c10","type":"function","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Error","func":"if(msg.payload.code === 0)\n    return;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":420,"wires":[["f47af38f8f7622e6"]]},{"id":"f47af38f8f7622e6","type":"debug","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1190,"y":420,"wires":[]},{"id":"4327e77f54b2b844","type":"function","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"OK","func":"if(msg.payload.code === 0) {\n    msg.payload = \"CA is ready\";\n    return msg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":460,"wires":[["7263d63a43c61768"]]},{"id":"7263d63a43c61768","type":"debug","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1160,"y":460,"wires":[]},{"id":"dc570bb213923dd5","type":"function","z":"aa7daa87.f23d38","g":"e4bc446fc30ed565","name":"Revoke Cert","func":"//msg.payload = 'crl -in /data/openssl/crl/crl.pem -noout -text'\nmsg.payload = 'ca -notext -config /data/openssl/openssl.conf -revoke /data/openssl/newcerts/' + msg.payload.serial + '.pem';\nif( msg.payload.passphrase && msg.payload.passphrase.length > 0 ) \n    msg.payload +=  ' -passin pass:frasseramera'\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":570,"y":1360,"wires":[["f3deae11855b12e1"]]},{"id":"f3deae11855b12e1","type":"exec","z":"aa7daa87.f23d38","g":"e4bc446fc30ed565","command":"openssl","addpay":"payload","append":"","useSpawn":"false","timer":"60","winHide":false,"oldrc":false,"name":"","x":760,"y":1360,"wires":[[],[],["6af15129bfa6b964","c5b01886ac659660"]]},{"id":"599c5a507439722b","type":"http in","z":"aa7daa87.f23d38","g":"e4bc446fc30ed565","name":"","url":"/revoke","method":"post","upload":false,"swaggerDoc":"","x":190,"y":1360,"wires":[["0cc290d7ae2fe6e7"]]},{"id":"0cc290d7ae2fe6e7","type":"function","z":"aa7daa87.f23d38","g":"e4bc446fc30ed565","name":"Validate input","func":"if( !msg.payload.hasOwnProperty(\"serial\") ) {\n    msg.payload = \"serial is required\";\n    node.send([null,msg]);\n}\nnode.send([msg,null]);","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":1360,"wires":[["dc570bb213923dd5"],["344b59c6d0b6f990"]]},{"id":"344b59c6d0b6f990","type":"http response","z":"aa7daa87.f23d38","g":"e4bc446fc30ed565","name":"","statusCode":"400","headers":{},"x":560,"y":1400,"wires":[]},{"id":"c5b01886ac659660","type":"function","z":"aa7daa87.f23d38","g":"e4bc446fc30ed565","name":"Error","func":"if(msg.payload.code === 0)\n    return;\nmsg.payload = \"Certificate revoked\";\nmsg.statusCode = 400;\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":1380,"wires":[["887fc545a407d4eb"]]},{"id":"6af15129bfa6b964","type":"function","z":"aa7daa87.f23d38","g":"e4bc446fc30ed565","name":"OK","func":"if(msg.payload.code === 1)\n    return;\n\nmsg.payload = \"Certificate revoked\";\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":1340,"wires":[["887fc545a407d4eb"]]},{"id":"887fc545a407d4eb","type":"http response","z":"aa7daa87.f23d38","g":"e4bc446fc30ed565","name":"","statusCode":"","headers":{},"x":1130,"y":1360,"wires":[]},{"id":"f8121681.caf688","type":"ui_text_input","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"Passphrase","label":"CA passphrase (if required)","tooltip":"If your CA is protected with a passhprase","group":"788715bd.13bec4","order":3,"width":"4","height":"1","passthru":true,"mode":"password","delay":300,"topic":"","topicType":"str","x":470,"y":940,"wires":[["6a8cf616.b536a8"]]},{"id":"f306e720.0694d8","type":"ui_dropdown","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","label":"Type","tooltip":"","place":"Select option","group":"788715bd.13bec4","order":4,"width":"4","height":"1","passthru":true,"multiple":false,"options":[{"label":"Server Cert","value":"server","type":"str"},{"label":"Client Cert","value":"client","type":"str"}],"payload":"","topic":"","topicType":"str","x":310,"y":820,"wires":[["b0a17bd7.9a86c8"]]},{"id":"a8022545.2ac148","type":"ui_dropdown","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","label":"Valid","tooltip":"","place":"Select option","group":"788715bd.13bec4","order":4,"width":"4","height":"1","passthru":true,"multiple":false,"options":[{"label":"One Week","value":7,"type":"num"},{"label":"One month","value":31,"type":"num"},{"label":"6 months","value":"200","type":"str"},{"label":"1 year","value":"366","type":"str"},{"label":"2 years","value":"731","type":"str"}],"payload":"","topic":"","topicType":"str","x":310,"y":860,"wires":[["dcfef388.de43d"]]},{"id":"e0f2f004.19084","type":"ui_button","z":"ff4de0da.c8d7d","g":"405924b7.935dbc","name":"","group":"a4dc3656.5518a","order":1,"width":"3","height":"1","passthru":false,"label":"Refresh","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","topicType":"str","x":160,"y":60,"wires":[["805196d5.3bc168"]]},{"id":"e4c609a6.0c9f48","type":"ui_button","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","name":"","group":"788715bd.13bec4","order":5,"width":0,"height":0,"passthru":false,"label":"Request Signed Certificate","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"save","topicType":"str","x":360,"y":740,"wires":[["7dde5a39.88bb24"]]},{"id":"7a39ee73.8854f8","type":"ui_button","z":"ff4de0da.c8d7d","g":"ad383299.8831c","name":"","group":"a4dc3656.5518a","order":7,"width":"4","height":"1","passthru":false,"label":"Request Server certificate","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","topicType":"str","x":210,"y":420,"wires":[["1fce3c23.7eae24"]]},{"id":"70753fd1.8973a","type":"ui_toast","z":"ff4de0da.c8d7d","g":"ad383299.8831c","position":"prompt","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Cancel","raw":true,"topic":"","name":"Commion Name","x":670,"y":420,"wires":[["48aaab65.59ed64"]]},{"id":"60dbfc46.565ca4","type":"ui_toast","z":"ff4de0da.c8d7d","g":"ad383299.8831c","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"Close ","cancel":"","raw":true,"topic":"Certificate will be generated when clicking link","name":"","x":1050,"y":480,"wires":[[]]},{"id":"c198279b.0b83b","type":"ui_toast","z":"ff4de0da.c8d7d","g":"ad383299.8831c","position":"prompt","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Cancel","raw":true,"topic":"","name":"CA Passphrase","x":660,"y":480,"wires":[["8a6fc4ca.205ad"]]},{"id":"e8c06901.d3a7c8","type":"ui_template","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","group":"788715bd.13bec4","name":"Drop zone: CSR","order":1,"width":"12","height":"4","format":"<iframe src=\"/dropzone/sign\" width=\"620px\" height=\"350px\"></iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":180,"y":600,"wires":[[]]},{"id":"4be0fa31.bd8d44","type":"ui_template","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","group":"4aff7dde.b12e74","name":"Signed Certificate","order":0,"width":"12","height":"11","format":"<style>\ntextarea {\n  font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace;\n}    \n</style>\n\n<textarea rows=\"30\" cols=\"150\">{{msg.payload}}</textarea>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1290,"y":700,"wires":[[]]},{"id":"7dde5a39.88bb24","type":"ui_template","z":"ff4de0da.c8d7d","g":"e56328a8.640fa8","group":"788715bd.13bec4","name":"Signing Request","order":2,"width":"12","height":"10","format":"<style>\ntextarea {\n  font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace;\n}    \n</style>\n<p>Or paste your CSR PEM here:</p>\n<textarea id=\"{{'csr_'+$id}}\" rows=\"30\" cols=\"150\"></textarea>\n\n<script>\n(function(scope) {\n  scope.$watch('msg', function(msg) {\n    if (!msg)\n        return;\n    if( msg.topic === \"csr\" ) {\n      $(\"#csr_\"+scope.$id).val(msg.payload);\n      return;\n    }\n    if( msg.topic === \"save\" ) {\n        console.log(msg.topic);\n        var data = $(\"#csr_\"+scope.$id).val();\n        msg.topic === \"saved\";\n        msg.payload = data;\n        if(data.search(\"-----BEGIN CERTIFICATE REQUEST-----\") >= 0 && data.search(\"-----END CERTIFICATE REQUEST-----\") >= 0 )\n            scope.send({topic:\"saved\",payload:data});\n        return;\n    }    \n  });\n})(scope);\n</script>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":610,"y":700,"wires":[["9ba22a05.d8c828"]]},{"id":"84190c5c.5c9fc","type":"ui_template","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","group":"5781adce.06a5d4","name":"","order":0,"width":"16","height":"11","format":"<style>\ntextarea {\n  font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace;\n}    \n</style>\n\n<textarea rows=\"30\" cols=\"150\">{{msg.payload}}</textarea>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1060,"y":1200,"wires":[[]]},{"id":"426d5355.2159ac","type":"ui_template","z":"ff4de0da.c8d7d","g":"2690e83f.0acfd8","group":"cefd5b5f.924ec","name":"Drop zone: Inspect","order":5,"width":"4","height":"12","format":"<iframe src=\"/dropzone/inspect\" width=\"200px\" height=\"600px\"></iframe>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":200,"y":1300,"wires":[[]]},{"id":"d5d0dec2.e9928","type":"ui_table","z":"ff4de0da.c8d7d","g":"405924b7.935dbc","group":"a4dc3656.5518a","name":"Issued certificates","order":0,"width":"12","height":"10","columns":[{"field":"link","title":"Common Name","width":"","align":"left","formatter":"html","formatterParams":{"target":"_blank"}},{"field":"expiration","title":"Expiration","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"id","title":"ID","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"status","title":"Status","width":"","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":760,"y":60,"wires":[]},{"id":"2d7e761cac43c783","type":"fs-ops-mkdir","z":"39dca28.bd9835e","name":"mkdir openssl","path":"/data","pathType":"str","dirname":"openssl","dirnameType":"str","recursive":false,"mode":"777","fullpath":"directory","fullpathType":"msg","x":220,"y":80,"wires":[["6932a023d3f581e7"]]},{"id":"6932a023d3f581e7","type":"fs-ops-mkdir","z":"39dca28.bd9835e","name":"mkdir crl","path":"/data/openssl","pathType":"str","dirname":"crl","dirnameType":"str","recursive":false,"mode":"777","fullpath":"directory","fullpathType":"msg","x":400,"y":80,"wires":[["898ff4ce3c9d5019"]]},{"id":"898ff4ce3c9d5019","type":"fs-ops-mkdir","z":"39dca28.bd9835e","name":"newcerts","path":"/data/openssl","pathType":"str","dirname":"newcerts","dirnameType":"str","recursive":false,"mode":"777","fullpath":"directory","fullpathType":"msg","x":560,"y":80,"wires":[["78300e7ed8c65185"]]},{"id":"78300e7ed8c65185","type":"fs-ops-mkdir","z":"39dca28.bd9835e","name":"certs","path":"/data/openssl","pathType":"str","dirname":"certs","dirnameType":"str","recursive":false,"mode":"777","fullpath":"directory","fullpathType":"msg","x":710,"y":80,"wires":[["ff5955a965fcb2a0"]]},{"id":"ff5955a965fcb2a0","type":"fs-ops-access","z":"39dca28.bd9835e","name":"openssl.conf exists?","path":"/data/openssl","pathType":"str","filename":"openssl.conf","filenameType":"str","read":true,"write":true,"throwerror":false,"x":240,"y":140,"wires":[["41f3d2d8c57ce6fc"],["92e30b3d.582da8"]]},{"id":"41f3d2d8c57ce6fc","type":"fs-ops-access","z":"39dca28.bd9835e","name":"index.txt exists?","path":"/data/openssl","pathType":"str","filename":"indext.xt","filenameType":"str","read":true,"write":true,"throwerror":false,"x":220,"y":200,"wires":[["b2be335889a9bdc5"],["48fef2aa.0c920c"]]},{"id":"b2be335889a9bdc5","type":"fs-ops-access","z":"39dca28.bd9835e","name":"serial exists?","path":"/data/openssl","pathType":"str","filename":"serial","filenameType":"str","read":true,"write":true,"throwerror":false,"x":210,"y":260,"wires":[["52ea51c4e33b735c"],["2279910c.e4dc2e"]]},{"id":"52ea51c4e33b735c","type":"fs-ops-access","z":"39dca28.bd9835e","name":"crlnumber exists?","path":"/data/openssl","pathType":"str","filename":"crlnumber","filenameType":"str","read":true,"write":true,"throwerror":false,"x":230,"y":320,"wires":[["501ec58a.4441fc"],["40a874bd.a0907c"]]},{"id":"04eee688ac936b74","type":"fs-ops-access","z":"b8bbfb03.fd1c08","g":"b3c6283f7ba82db4","name":"Continue id root.key does not exist","path":"/data/openssl","pathType":"str","filename":"root.key","filenameType":"str","read":true,"write":true,"throwerror":false,"x":1090,"y":120,"wires":[[],["cc643a42c4742946"]]},{"id":"0ca9e5934ba74b82","type":"zip","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","mode":"compress","filename":"","compressionlevel":6,"outasstring":false,"x":1240,"y":1060,"wires":[["996fbb93.cbfa2"]]},{"id":"84f2a8e188a58c28","type":"zip","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","mode":"compress","filename":"","compressionlevel":6,"outasstring":false,"x":1240,"y":760,"wires":[["e31c659d9f025fb9"]]},{"id":"1d415502c0eff8f1","type":"change","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"Cert File","rules":[{"t":"set","p":"filename","pt":"msg","to":"crt","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":580,"wires":[["0c0690210ab0fd5b"]]},{"id":"43167ca43a9951a1","type":"change","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"CA","rules":[{"t":"set","p":"filename","pt":"msg","to":"/data/openssl/root.crt","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1230,"y":640,"wires":[["d4cd9d43a08877dd"]]},{"id":"d4cd9d43a08877dd","type":"file in","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":1390,"y":640,"wires":[["c529bd4c5834149f"]]},{"id":"c529bd4c5834149f","type":"function","z":"aa7daa87.f23d38","g":"de58220e46cf4265","name":"Add to ZIP","func":"msg.zip.push({\n        filename: \"ca-certificate.crt\",\n        payload: msg.payload\n});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1560,"y":640,"wires":[["802111da.e11618"]]},{"id":"67f86e70761b4f06","type":"change","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"Cert File","rules":[{"t":"set","p":"filename","pt":"msg","to":"crt","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":940,"wires":[["be23ef2b.be374"]]},{"id":"56ac6aef76929a33","type":"change","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"CA","rules":[{"t":"set","p":"filename","pt":"msg","to":"/data/openssl/root.crt","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1230,"y":1000,"wires":[["b4eeaea64e9293e3"]]},{"id":"b4eeaea64e9293e3","type":"file in","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":1390,"y":1000,"wires":[["d9d58e4a5ceb4e03"]]},{"id":"d9d58e4a5ceb4e03","type":"function","z":"aa7daa87.f23d38","g":"a8d6de16ed6cade1","name":"Add to ZIP","func":"msg.zip.push({\n        filename: \"ca-certificate.crt\",\n        payload: msg.payload\n});\nmsg.payload = msg.zip;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1540,"y":1000,"wires":[["39a13919.625a56","0ca9e5934ba74b82"]]},{"id":"a0f0ff4.558c78","type":"ui_button","z":"ff4de0da.c8d7d","g":"4998ef70.b87a68","name":"","group":"a4dc3656.5518a","order":7,"width":"4","height":"1","passthru":false,"label":"Request Client certificate","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","topicType":"str","x":210,"y":180,"wires":[["3c792827.82069"]]},{"id":"3c792827.82069","type":"function","z":"ff4de0da.c8d7d","g":"4998ef70.b87a68","name":"Build URL","func":"msg.url = \"/cert/client?\";\nmsg.payload = \"Common Name\"\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":180,"wires":[["1e29ce86.ac6829"]]},{"id":"1e29ce86.ac6829","type":"ui_toast","z":"ff4de0da.c8d7d","g":"4998ef70.b87a68","position":"prompt","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Cancel","raw":true,"topic":"","name":"Commion Name","x":670,"y":180,"wires":[["ee96bcea.a0c2e"]]},{"id":"a1d4ccf4.ee6f98","type":"ui_toast","z":"ff4de0da.c8d7d","g":"4998ef70.b87a68","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"Close","cancel":"","raw":true,"topic":"Certificate will be generated when clicking link","name":"","x":1050,"y":300,"wires":[[]]},{"id":"ee96bcea.a0c2e","type":"function","z":"ff4de0da.c8d7d","g":"4998ef70.b87a68","name":"Build URL","func":"if(msg.payload.length < 2 )\n    return;\n\nif( msg.payload === \"Cancel\" )\n    return;\n    \nmsg.url += \"cn=\"+msg.payload;\nmsg.payload = \"P12 Password\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":870,"y":180,"wires":[["e6af7825.95bb78"]]},{"id":"e6af7825.95bb78","type":"ui_toast","z":"ff4de0da.c8d7d","g":"4998ef70.b87a68","position":"prompt","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Cancel","raw":true,"topic":"","name":"P12 Password","x":660,"y":240,"wires":[["b7f274d1.0150b8"]]},{"id":"b7f274d1.0150b8","type":"function","z":"ff4de0da.c8d7d","g":"4998ef70.b87a68","name":"Build URL","func":"if(msg.payload.length < 2 )\n    return;\n\nif( msg.payload === \"Cancel\" )\n    return;\n    \nmsg.url += \"&password=\"+msg.payload;\nmsg.payload = \"CA Passphrase\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":870,"y":240,"wires":[["9a22ab97.3798d"]]},{"id":"9a22ab97.3798d","type":"ui_toast","z":"ff4de0da.c8d7d","g":"4998ef70.b87a68","position":"prompt","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"Cancel","raw":true,"topic":"","name":"CA Passphrase","x":660,"y":300,"wires":[["99ce6317.08dc08"]]},{"id":"99ce6317.08dc08","type":"function","z":"ff4de0da.c8d7d","g":"4998ef70.b87a68","name":"Build URL","func":"if( msg.payload === \"Cancel\" )\n    return;\n\nif(msg.payload.length > 0 )\n    msg.url += \"&passphrase=\"+msg.payload;\n    \nmsg.payload = '<a style=\"color:white;\" href=\"' + msg.url + '\">Download link (ZIP)</a>';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":870,"y":300,"wires":[["a1d4ccf4.ee6f98"]]}]